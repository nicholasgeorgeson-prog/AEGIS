<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEGIS - Aerospace Engineering Governance & Inspection System</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!-- v5.4.0: Instant dark mode â€” prevents flash of light mode on load -->
    <!-- Sets both class AND critical CSS variables BEFORE stylesheets parse -->
    <script>
        (function() {
            try {
                var stored = localStorage.getItem('twr_state');
                var theme = 'dark'; // Default to dark
                if (stored) {
                    var state = JSON.parse(stored);
                    theme = (state.ui && state.ui.theme) || 'dark';
                } else {
                    var legacy = localStorage.getItem('twr-theme');
                    if (legacy) theme = legacy;
                }
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark-mode');
                    document.documentElement.setAttribute('data-theme', 'dark');
                    // v5.7.1: Set BOTH inline style properties AND CSS variables.
                    // Inline style.backgroundColor has maximum specificity â€” no stylesheet
                    // can override it, eliminating any possible flash during CSS load.
                    document.documentElement.style.backgroundColor = '#0d1117';
                    document.documentElement.style.color = '#e6edf3';
                    document.documentElement.style.setProperty('--bg-deep', '#0d1117');
                    document.documentElement.style.setProperty('--bg-primary', '#161b22');
                    document.documentElement.style.setProperty('--text-primary', '#e6edf3');
                    document.documentElement.style.setProperty('--bg-secondary', '#1c2128');
                }
            } catch(e) {
                document.documentElement.classList.add('dark-mode');
                document.documentElement.setAttribute('data-theme', 'dark');
                document.documentElement.style.backgroundColor = '#0d1117';
                document.documentElement.style.color = '#e6edf3';
                document.documentElement.style.setProperty('--bg-deep', '#0d1117');
                document.documentElement.style.setProperty('--bg-primary', '#161b22');
                document.documentElement.style.setProperty('--text-primary', '#e6edf3');
            }
        })();
    </script>
    <!-- v5.7.0: Comprehensive inline dark mode CSS to eliminate FOUC completely.
         Must override ALL visually impactful variables BEFORE base.css loads. -->
    <style>
        html.dark-mode,
        html[data-theme="dark"] {
            background-color: #0d1117;
            color: #e6edf3;
            /* Backgrounds */
            --bg-deep: #0d1117;
            --bg-primary: #161b22;
            --bg-secondary: #1c2128;
            --bg-tertiary: #21262d;
            --bg-elevated: #262c36;
            --bg-surface: #30363d;
            --bg-hover: #3c434d;
            --bg-active: #4a5260;
            --bg-selected: rgba(56, 139, 253, 0.15);
            --bg-backdrop: rgba(0, 0, 0, 0.7);
            /* Text */
            --text-primary: #e6edf3;
            --text-secondary: #b1bac4;
            --text-muted: #8b949e;
            --text-disabled: #6e7681;
            --text-link: #58a6ff;
            --text-inverse: #0d1117;
            /* Borders */
            --border-default: #30363d;
            --border-muted: #21262d;
            --border-subtle: rgba(240, 246, 252, 0.1);
            /* Accent */
            --accent: #58a6ff;
            --accent-hover: #79b8ff;
            --accent-subtle: rgba(56, 139, 253, 0.15);
            --accent-fg: #0d1117;
            /* Sidebar */
            --sidebar-bg: #161b22;
            --sidebar-border: #30363d;
            --sidebar-text: #e6edf3;
            --sidebar-hover: #21262d;
        }
        html.dark-mode body,
        html[data-theme="dark"] body {
            background-color: #0d1117;
            color: #e6edf3;
        }
    </style>
    <!-- v5.4.0: Critical CSS loaded synchronously, feature CSS deferred -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/features/landing-page.css">
    <!-- v5.4.0: Feature CSS loaded asynchronously â€” not needed for initial paint -->
    <link rel="stylesheet" href="/static/css/features/portfolio.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/hyperlink-validator.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/hv-cinematic-progress.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/hyperlink-enhanced.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/link-history.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/cinematic-progress.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/batch-progress-dashboard.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/cinematic-loader.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/molten-progress.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/data-explorer.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/mass-statement-review.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/statement-history.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/static/css/features/guide-system.css">
    <link rel="stylesheet" href="/static/css/features/export-suite.css" media="print" onload="this.media='all'">
    <!-- Print stylesheet -->
    <link rel="stylesheet" href="/static/css/print.css" media="print">
    <!-- Vendor libraries: all local (v5.0.1 - no external CDN for air-gapped compliance) -->
    <script src="/static/js/vendor/lucide.min.js"></script>
    <script src="/static/js/vendor/chart.min.js"></script>
    <script src="/static/js/vendor/d3.v7.min.js" defer></script>
    <!-- v3.0.111: SortableJS for Statement Forge drag-and-drop -->
    <script src="/static/js/vendor/Sortable.min.js" defer></script>
    <!-- v3.1.6: Cinematic Progress Animation Libraries (Lottie + GSAP) -->
    <script src="/static/js/vendor/lottie.min.js" defer></script>
    <script src="/static/js/vendor/gsap.min.js" defer></script>
</head>
<body class="landing-active">
<script>
// v5.9.0: Apply dark mode to body IMMEDIATELY on parse.
// The head script set dark-mode on <html>; mirror class + styles to body.
// CRITICAL: body must also have .dark-mode class because landing-page.css
// uses body:not(.dark-mode) to apply light mode overrides â€” without this
// class, the light override fires before JS can add it, causing FOUC.
if (document.documentElement.classList.contains('dark-mode')) {
    document.body.classList.add('dark-mode');
    document.body.setAttribute('data-theme', 'dark');
    // v5.9.18: Set bg on html (not body) so particle canvas behind body is visible
    document.documentElement.style.backgroundColor = '#0d1117';
    document.body.style.color = '#e6edf3';
}
</script>
<!-- v5.9.18: Particle canvas on body â€” always visible as global background behind all UI.
     z-index:0 + pointer-events:none. App containers have opaque backgrounds to cover it. -->
<canvas id="lp-bg-canvas" class="lp-bg-canvas" style="background:transparent"></canvas>
<!-- v4.5.1: Standalone Landing Page -->
<div id="aegis-landing-page" class="lp-page">
    <div class="lp-content">
        <div class="lp-header">
            <div class="lp-logo-block">
                <img src="/static/images/logo.svg" alt="AEGIS" width="48" height="48" style="border-radius: 10px;" onerror="this.style.display='none'">
                <div class="lp-title-block">
                    <h1 class="lp-title">AEGIS</h1>
                    <span class="lp-subtitle">Aerospace Engineering Governance & Inspection System</span>
                </div>
            </div>
            <div class="lp-header-actions">
                <button class="lp-header-btn" id="lp-btn-theme" title="Toggle dark/light mode" aria-label="Toggle dark and light mode"><i data-lucide="sun-moon" aria-hidden="true"></i></button>
                <button class="lp-header-btn" id="lp-btn-help" title="Help & Documentation" aria-label="Open help and documentation"><i data-lucide="book-open" aria-hidden="true"></i></button>
                <button class="lp-header-btn" id="lp-btn-settings" title="Settings" aria-label="Open settings"><i data-lucide="settings" aria-hidden="true"></i></button>
                <span class="lp-version" id="lp-version"></span>
            </div>
        </div>
        <div class="lp-hero" id="lp-hero">
            <div class="lp-hero-icon"><i data-lucide="upload-cloud"></i></div>
            <h2>Drop a document to begin analysis</h2>
            <p>Drag & drop .docx, .doc, or .pdf &mdash; or click to browse</p>
        </div>
        <div class="lp-metrics" id="lp-metrics"></div>
        <!-- Getting Started Card (Guide System v1.0.0) -->
        <div class="getting-started-card" id="lp-getting-started" style="opacity:0; animation: lp-fadeSlideIn 0.6s ease 0.35s forwards; margin: 24px 0; cursor: pointer;" title="Click for a guided tour">
            <div class="gs-card-content">
                <span class="gs-card-icon">ðŸ§­</span>
                <div class="gs-card-text">
                    <h3 class="gs-card-title">New to AEGIS?</h3>
                    <p class="gs-card-subtitle">Take a 2-minute guided tour</p>
                </div>
                <span class="gs-card-arrow">â†’</span>
            </div>
        </div>
        <h3 class="lp-section-title" style="opacity:0; animation: lp-fadeSlideIn 0.6s ease 0.35s forwards;">Tools</h3>
        <div class="lp-tiles" id="lp-tiles"></div>
        <div class="lp-recent" id="lp-recent"></div>
        <div class="lp-footer" id="lp-footer"></div>
    </div>
</div>

<!-- v5.9.30: Aerospace cinematic boot sequence â€” pure CSS + inline JS, zero dependencies -->
<div id="aegis-init-loader" class="ail-overlay">
  <canvas id="ail-canvas"></canvas>
  <div class="ail-vignette"></div>
  <div class="ail-scanline"></div>
  <div class="ail-hex-grid"></div>
  <div class="ail-center">
    <!-- Shield assembly -->
    <div class="ail-shield">
      <div class="ail-shield-outer">
        <svg viewBox="0 0 200 220" class="ail-shield-svg">
          <defs>
            <linearGradient id="ail-gold-g" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#FFE08A"/>
              <stop offset="30%" stop-color="#D6A84A"/>
              <stop offset="70%" stop-color="#B8743A"/>
              <stop offset="100%" stop-color="#8B5E2F"/>
            </linearGradient>
            <linearGradient id="ail-gold-stroke" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#FFE08A"/>
              <stop offset="100%" stop-color="#B8743A"/>
            </linearGradient>
            <filter id="ail-glow">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feComposite in="SourceGraphic" in2="blur" operator="over"/>
            </filter>
            <filter id="ail-glow-strong">
              <feGaussianBlur stdDeviation="6" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <!-- Shield outline â€” draws itself in -->
          <path class="ail-shield-path" d="M100,8 L185,50 L185,120 Q185,180 100,212 Q15,180 15,120 L15,50 Z"
                fill="none" stroke="url(#ail-gold-stroke)" stroke-width="2.5" filter="url(#ail-glow)"
                stroke-dasharray="600" stroke-dashoffset="600"/>
          <!-- Inner detail lines -->
          <path class="ail-shield-inner" d="M100,28 L170,62 L170,118 Q170,168 100,196 Q30,168 30,118 L30,62 Z"
                fill="none" stroke="rgba(214,168,74,0.3)" stroke-width="1" stroke-dasharray="500" stroke-dashoffset="500"/>
          <!-- Crosshair / targeting reticle -->
          <circle class="ail-reticle" cx="100" cy="115" r="35" fill="none" stroke="rgba(214,168,74,0.4)" stroke-width="0.8"
                  stroke-dasharray="220" stroke-dashoffset="220"/>
          <line class="ail-cross-h" x1="55" y1="115" x2="145" y2="115" stroke="rgba(214,168,74,0.25)" stroke-width="0.5"
                stroke-dasharray="90" stroke-dashoffset="90"/>
          <line class="ail-cross-v" x1="100" y1="70" x2="100" y2="160" stroke="rgba(214,168,74,0.25)" stroke-width="0.5"
                stroke-dasharray="90" stroke-dashoffset="90"/>
        </svg>
      </div>
      <!-- AEGIS text reveal -->
      <div class="ail-title">
        <span class="ail-letter" style="--i:0">A</span><span class="ail-letter" style="--i:1">E</span><span class="ail-letter" style="--i:2">G</span><span class="ail-letter" style="--i:3">I</span><span class="ail-letter" style="--i:4">S</span>
      </div>
      <div class="ail-subtitle">AEROSPACE ENGINEERING GOVERNANCE &amp; INSPECTION SYSTEM</div>
    </div>
    <!-- Boot sequence terminal -->
    <div class="ail-terminal" id="ail-terminal"></div>
    <!-- Progress bar -->
    <div class="ail-progress-track">
      <div class="ail-progress-fill" id="ail-progress"></div>
      <div class="ail-progress-glow" id="ail-progress-glow"></div>
    </div>
    <div class="ail-status" id="ail-status">INITIALIZING</div>
  </div>
  <!-- Corner HUD elements -->
  <div class="ail-hud ail-hud-tl"><span class="ail-hud-label">SYS</span><span class="ail-hud-val" id="ail-hud-sys">BOOT</span></div>
  <div class="ail-hud ail-hud-tr"><span class="ail-hud-label">SEC</span><span class="ail-hud-val">LEVEL 5</span></div>
  <div class="ail-hud ail-hud-bl"><span class="ail-hud-label">NET</span><span class="ail-hud-val">LOCAL</span></div>
  <div class="ail-hud ail-hud-br"><span class="ail-hud-label">VER</span><span class="ail-hud-val" id="ail-hud-ver">--</span></div>
</div>
<style>
/* === AEGIS Cinematic Boot Sequence v5.9.30 === */
.ail-overlay{position:fixed;inset:0;z-index:99999;background:#020408;display:flex;align-items:center;justify-content:center;overflow:hidden;transition:opacity .6s cubic-bezier(.4,0,.2,1)}
.ail-overlay.ail-done{opacity:0;pointer-events:none}

/* Particle canvas */
#ail-canvas{position:absolute;inset:0;width:100%;height:100%;z-index:0}

/* Atmospheric effects */
.ail-vignette{position:absolute;inset:0;z-index:1;pointer-events:none;
  background:radial-gradient(ellipse 70% 60% at 50% 45%,transparent 30%,rgba(2,4,8,.85) 100%)}
.ail-scanline{position:absolute;inset:0;z-index:2;pointer-events:none;opacity:.04;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(214,168,74,.15) 2px,rgba(214,168,74,.15) 4px)}

/* Hex grid overlay â€” v5.9.35: brighter hex (0.06 â†’ 0.14) + subtle pulse animation */
.ail-hex-grid{position:absolute;inset:0;z-index:1;pointer-events:none;opacity:0;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='52'%3E%3Cpath d='M30 0L60 15V37L30 52L0 37V15Z' fill='none' stroke='rgba(214,168,74,0.14)' stroke-width='0.5'/%3E%3C/svg%3E");
  background-size:60px 52px;animation:ail-hexIn 1.5s ease 0.3s forwards}
@keyframes ail-hexIn{to{opacity:1;animation:ail-hexPulse 3s ease-in-out infinite}}
@keyframes ail-hexPulse{0%,100%{opacity:.85}50%{opacity:1}}

/* Center content */
.ail-center{position:relative;z-index:5;display:flex;flex-direction:column;align-items:center;width:min(480px,90vw)}

/* Shield assembly */
.ail-shield{text-align:center;margin-bottom:20px}
.ail-shield-outer{width:120px;height:132px;margin:0 auto;opacity:0;animation:ail-shieldIn .8s ease .2s forwards}
@keyframes ail-shieldIn{0%{opacity:0;transform:scale(.7)}100%{opacity:1;transform:scale(1)}}

/* SVG draw-in animations */
.ail-shield-path{animation:ail-draw 1.8s cubic-bezier(.4,0,.2,1) .5s forwards}
.ail-shield-inner{animation:ail-draw 1.5s cubic-bezier(.4,0,.2,1) .8s forwards}
.ail-reticle{animation:ail-draw 1.2s ease 1.2s forwards}
.ail-cross-h,.ail-cross-v{animation:ail-draw .8s ease 1.5s forwards}
@keyframes ail-draw{to{stroke-dashoffset:0}}

/* AEGIS title â€” letter-by-letter reveal */
.ail-title{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;font-size:clamp(32px,6vw,48px);font-weight:800;
  letter-spacing:clamp(8px,2vw,18px);color:transparent;margin:8px 0 6px;display:flex;justify-content:center;gap:2px}
.ail-letter{display:inline-block;opacity:0;transform:translateY(20px) scale(.8);
  animation:ail-letterIn .5s cubic-bezier(.2,.8,.3,1) calc(1s + var(--i) * .12s) forwards;
  background:linear-gradient(180deg,#FFE08A 0%,#D6A84A 40%,#B8743A 100%);-webkit-background-clip:text;background-clip:text;
  filter:drop-shadow(0 0 12px rgba(214,168,74,.6))}
@keyframes ail-letterIn{to{opacity:1;transform:translateY(0) scale(1)}}

/* Subtitle */
.ail-subtitle{font-family:'Segoe UI',system-ui,sans-serif;font-size:clamp(7px,1.3vw,10px);font-weight:500;
  letter-spacing:clamp(2px,0.8vw,5px);color:rgba(214,168,74,.5);text-align:center;
  opacity:0;animation:ail-fadeUp .6s ease 1.8s forwards;text-transform:uppercase}
@keyframes ail-fadeUp{0%{opacity:0;transform:translateY(8px)}100%{opacity:1;transform:translateY(0)}}

/* Boot terminal */
.ail-terminal{font-family:'Cascadia Code','SF Mono','Consolas','Monaco',monospace;font-size:11px;line-height:1.6;
  color:rgba(214,168,74,.6);text-align:left;width:100%;max-height:90px;overflow:hidden;
  padding:10px 14px;margin:16px 0 12px;border:1px solid rgba(214,168,74,.1);border-radius:6px;
  background:rgba(214,168,74,.03);opacity:0;animation:ail-fadeUp .4s ease 2s forwards}
.ail-terminal .ail-line{opacity:0;animation:ail-lineIn .3s ease forwards;white-space:nowrap;overflow:hidden}
@keyframes ail-lineIn{to{opacity:1}}
.ail-terminal .ail-ok{color:#3fb950}
.ail-terminal .ail-warn{color:#d29922}
.ail-terminal .ail-info{color:rgba(214,168,74,.4)}

/* Progress bar */
.ail-progress-track{width:100%;height:3px;background:rgba(214,168,74,.08);border-radius:2px;overflow:visible;
  position:relative;opacity:0;animation:ail-fadeUp .3s ease 2.1s forwards}
.ail-progress-fill{height:100%;width:0%;border-radius:2px;transition:width .3s cubic-bezier(.4,0,.2,1);
  background:linear-gradient(90deg,#B8743A,#D6A84A,#FFE08A)}
.ail-progress-glow{position:absolute;top:-3px;height:9px;width:0%;border-radius:4px;transition:width .3s cubic-bezier(.4,0,.2,1);
  background:linear-gradient(90deg,transparent 80%,rgba(214,168,74,.5));filter:blur(3px);pointer-events:none}

/* Status text */
.ail-status{font-family:'Segoe UI',system-ui,sans-serif;font-size:10px;font-weight:600;letter-spacing:3px;
  color:rgba(214,168,74,.5);text-transform:uppercase;margin-top:10px;
  opacity:0;animation:ail-fadeUp .3s ease 2.2s forwards}

/* HUD corners */
.ail-hud{position:absolute;z-index:6;font-family:'Cascadia Code','SF Mono','Consolas',monospace;font-size:9px;
  opacity:0;animation:ail-fadeUp .5s ease 0.8s forwards;display:flex;flex-direction:column;gap:2px}
.ail-hud-tl{top:20px;left:24px}.ail-hud-tr{top:20px;right:24px;text-align:right;align-items:flex-end}
.ail-hud-bl{bottom:20px;left:24px}.ail-hud-br{bottom:20px;right:24px;text-align:right;align-items:flex-end}
.ail-hud-label{color:rgba(214,168,74,.3);letter-spacing:2px;font-size:8px}
.ail-hud-val{color:rgba(214,168,74,.6);letter-spacing:1px}

/* Flash on complete */
.ail-overlay.ail-flash::before{content:"";position:absolute;inset:0;z-index:100;
  background:radial-gradient(circle at 50% 45%,rgba(214,168,74,.3),transparent 70%);
  animation:ail-flashPulse .6s ease forwards;pointer-events:none}
@keyframes ail-flashPulse{0%{opacity:0;transform:scale(.8)}40%{opacity:1}100%{opacity:0;transform:scale(1.5)}}

/* Reduced motion */
@media(prefers-reduced-motion:reduce){
  .ail-letter,.ail-shield-outer,.ail-terminal,.ail-subtitle,.ail-progress-track,.ail-status,.ail-hud,.ail-hex-grid{animation:none!important;opacity:1!important;transform:none!important}
  .ail-shield-path,.ail-shield-inner,.ail-reticle,.ail-cross-h,.ail-cross-v{animation:none!important;stroke-dashoffset:0!important}
  #ail-canvas{display:none}
}
</style>
<script>
// AEGIS Boot Sequence â€” inline for instant execution, zero dependencies
(function(){
  var ol=document.getElementById('aegis-init-loader');if(!ol)return;
  var cv=document.getElementById('ail-canvas');
  var ctx=cv?cv.getContext('2d'):null;
  var W=0,H=0,dpr=Math.min(window.devicePixelRatio||1,2);
  var particles=[];var PCOUNT=120;var raf=0;var alive=true;

  // Resize canvas
  function resize(){
    if(!cv)return;W=ol.clientWidth;H=ol.clientHeight;
    cv.width=W*dpr;cv.height=H*dpr;cv.style.width=W+'px';cv.style.height=H+'px';
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  resize();window.addEventListener('resize',resize);

  // Particles â€” gold dust drifting upward
  for(var i=0;i<PCOUNT;i++){
    particles.push({
      x:Math.random()*2000,y:Math.random()*2000,
      vx:(Math.random()-.5)*.15,vy:-(Math.random()*.3+.1),
      r:Math.random()*1.5+.3,a:Math.random()*.4+.05,
      pulse:Math.random()*Math.PI*2,pulseSpeed:Math.random()*.02+.005
    });
  }

  function drawParticles(){
    if(!ctx||!alive)return;
    ctx.clearRect(0,0,W,H);

    // Nebula glow â€” subtle radial gradients
    var g1=ctx.createRadialGradient(W*.3,H*.35,0,W*.3,H*.35,W*.4);
    g1.addColorStop(0,'rgba(51,100,180,.04)');g1.addColorStop(1,'transparent');ctx.fillStyle=g1;ctx.fillRect(0,0,W,H);
    var g2=ctx.createRadialGradient(W*.7,H*.6,0,W*.7,H*.6,W*.3);
    g2.addColorStop(0,'rgba(214,168,74,.03)');g2.addColorStop(1,'transparent');ctx.fillStyle=g2;ctx.fillRect(0,0,W,H);

    // Draw particles
    for(var i=0;i<particles.length;i++){
      var p=particles[i];
      p.x+=p.vx;p.y+=p.vy;p.pulse+=p.pulseSpeed;
      if(p.y<-10){p.y=H+10;p.x=Math.random()*W;}
      if(p.x<-10)p.x=W+10;if(p.x>W+10)p.x=-10;
      var alpha=p.a*(0.6+0.4*Math.sin(p.pulse));
      ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle='rgba(214,168,74,'+alpha+')';ctx.fill();
      // Glow
      if(p.r>1){
        ctx.beginPath();ctx.arc(p.x,p.y,p.r*3,0,Math.PI*2);
        ctx.fillStyle='rgba(214,168,74,'+(alpha*.15)+')';ctx.fill();
      }
    }

    // Connecting lines between nearby particles
    ctx.strokeStyle='rgba(214,168,74,.03)';ctx.lineWidth=.5;
    for(var i=0;i<particles.length;i++){
      for(var j=i+1;j<particles.length;j++){
        var dx=particles[i].x-particles[j].x,dy=particles[i].y-particles[j].y;
        var d=dx*dx+dy*dy;
        if(d<12000){ctx.beginPath();ctx.moveTo(particles[i].x,particles[i].y);ctx.lineTo(particles[j].x,particles[j].y);ctx.stroke();}
      }
    }
    raf=requestAnimationFrame(drawParticles);
  }
  // Start with slight delay to not compete with first paint
  setTimeout(drawParticles,100);

  // Boot sequence
  var term=document.getElementById('ail-terminal');
  var prog=document.getElementById('ail-progress');
  var progGlow=document.getElementById('ail-progress-glow');
  var statusEl=document.getElementById('ail-status');
  var verEl=document.getElementById('ail-hud-ver');
  var sysEl=document.getElementById('ail-hud-sys');

  // v5.9.35: Boot lines â€” cosmetic sequence plays during real module loading
  var lines=[
    {t:'> sys.boot()',c:'info',d:200},
    {t:'  [OK] Kernel initialized',c:'ok',d:150},
    {t:'  [OK] Security protocols active',c:'ok',d:150},
    {t:'  [OK] NLP engine loaded',c:'ok',d:120},
    {t:'  [OK] 105 quality checkers ready',c:'ok',d:120},
    {t:'  [OK] Document extractors online',c:'ok',d:100},
    {t:'  [OK] Role analysis engine ready',c:'ok',d:100},
    {t:'  [OK] Hyperlink validator armed',c:'ok',d:100},
    {t:'> aegis.launch()',c:'info',d:200}
  ];

  // v5.9.35: Real progress tracking â€” modules call _aegisBootProgress() as they load
  var bootSteps={total:6,done:0,cosmetic:0};
  var BOOT_STEPS=['dom','core','features','state','landing','ready'];

  function setProgress(p){
    var pct=Math.min(100,Math.round(p*100))+'%';
    if(prog){prog.style.width=pct;}
    if(progGlow){progGlow.style.width=pct;}
  }

  // Real progress: modules report in as they load
  window._aegisBootProgress=function(step,msg){
    bootSteps.done++;
    var real=bootSteps.done/bootSteps.total;
    var cosmetic=bootSteps.cosmetic/lines.length;
    // Progress = max of real and cosmetic (whichever is ahead)
    setProgress(Math.max(real*.9,cosmetic));
    if(statusEl&&msg)statusEl.textContent=msg.toUpperCase();
    // Add a real boot line to terminal
    if(term&&step!=='ready'){
      var el=document.createElement('div');el.className='ail-line';
      var sp=document.createElement('span');sp.className='ail-ok';
      sp.textContent='  [âœ“] '+(msg||step);
      el.appendChild(sp);term.appendChild(el);term.scrollTop=term.scrollHeight;
    }
  };

  function runBoot(){
    if(!term)return;var idx=0;
    function next(){
      if(idx>=lines.length){
        // v5.9.35: Don't show SYSTEMS ONLINE here â€” wait for _aegisBootDismiss
        // Just set cosmetic progress to "almost done"
        setProgress(.9);
        if(statusEl)statusEl.textContent='AWAITING LAUNCH';
        return;
      }
      var ln=lines[idx];
      var el=document.createElement('div');el.className='ail-line';
      var sp=document.createElement('span');sp.className='ail-'+ln.c;sp.textContent=ln.t;
      el.appendChild(sp);term.appendChild(el);
      term.scrollTop=term.scrollHeight;
      bootSteps.cosmetic=idx+1;
      // Progress: blend cosmetic + real
      var real=bootSteps.done/bootSteps.total;
      var cosmetic=(idx+1)/lines.length;
      setProgress(Math.max(real*.9,cosmetic*.85));
      if(statusEl){
        var msgs=['INITIALIZING','LOADING CORE','SECURITY CHECK','NLP ENGINE','QUALITY CHECKS','EXTRACTORS','ROLE ENGINE','VALIDATORS','LAUNCHING'];
        statusEl.textContent=msgs[idx]||'LOADING';
      }
      idx++;setTimeout(next,ln.d);
    }
    // Start boot after terminal fades in
    setTimeout(next,2300);
  }

  // Get version for HUD
  try{
    var x=new XMLHttpRequest();x.open('GET','/api/version',true);x.timeout=2000;
    x.onload=function(){try{var d=JSON.parse(x.responseText);if(verEl&&d.version)verEl.textContent='v'+d.version;}catch(e){}};
    x.send();
  }catch(e){}

  runBoot();

  // v5.9.35: Dismiss function â€” NOW shows SYSTEMS ONLINE + flash
  window._aegisBootDismiss=function(){
    if(!alive)return;alive=false;
    // Show SYSTEMS ONLINE at dismiss time (not before)
    setProgress(1);
    if(statusEl){statusEl.textContent='SYSTEMS ONLINE';statusEl.style.color='#3fb950';}
    if(sysEl)sysEl.textContent='READY';
    // Add final boot line
    if(term){
      var el=document.createElement('div');el.className='ail-line';
      var sp=document.createElement('span');sp.className='ail-ok';sp.textContent='  [âœ“] ALL SYSTEMS ONLINE';
      el.appendChild(sp);term.appendChild(el);term.scrollTop=term.scrollHeight;
    }
    // Brief pause to show SYSTEMS ONLINE, then flash + dismiss
    setTimeout(function(){
      ol.classList.add('ail-flash');
      setTimeout(function(){
        ol.classList.add('ail-done');
        cancelAnimationFrame(raf);
        setTimeout(function(){ol.remove();},700);
      },400);
    },300);
  };
})();
</script>
<!-- Stub element for any code that references aegisLoader -->
<div id="aegisLoader" style="display:none;"></div>

<!-- v3.0.32: Top horizontal nav bar (Thread 9: Enterprise Polish) -->
<header class="top-nav-bar" id="top-nav-bar">
    <div class="top-nav-brand" style="cursor: pointer;" title="Return to Home">
        <div class="top-nav-logo">
            <img src="/static/images/logo.svg" alt="AEGIS Logo" width="32" height="32" style="border-radius: 6px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div role="img" aria-label="AEGIS Logo" style="display:none; width:32px; height:32px; background:linear-gradient(135deg,#1a3a52,#0d1f2d); border-radius:6px; align-items:center; justify-content:center; color:#D6A84A; font-weight:bold; font-size:8px;">AEGIS</div>
        </div>
        <span class="top-nav-title" title="Aerospace Engineering Governance & Inspection System">AEGIS</span>
    </div>
    
    <!-- v4.6.1: Dashboard-first navigation â€” single Dashboard button replaces all module links -->
    <nav class="top-nav-links" role="navigation" aria-label="Main navigation">
        <button class="top-nav-link active" id="nav-dashboard" title="Return to Dashboard" aria-label="Return to Dashboard">
            <i data-lucide="layout-dashboard" aria-hidden="true"></i>
            <span>Dashboard</span>
        </button>
    </nav>
    <!-- v4.6.1: Hidden nav buttons preserved for programmatic tile click routing -->
    <div style="display:none;" aria-hidden="true">
        <button id="nav-review" data-view="review"></button>
        <button id="nav-forge" data-view="forge"></button>
        <button id="nav-roles" data-view="roles"></button>
        <button id="nav-metrics" data-view="metrics"></button>
        <button id="nav-history" data-view="history"></button>
        <button id="nav-compare"></button>
        <button id="nav-hyperlink-validator"></button>
        <button id="nav-link-history"></button>
        <button id="nav-portfolio"></button>
    </div>
    
    <div class="top-nav-actions">
        <!-- Run-state indicator -->
        <div class="run-state-indicator" id="run-state-indicator" role="status" aria-live="polite" aria-label="Scan state indicator">
            <span class="run-state-icon" id="run-state-icon" aria-hidden="true">
                <i data-lucide="circle" class="state-idle"></i>
            </span>
            <span class="run-state-label" id="run-state-label">Idle</span>
        </div>
        
        <!-- Quick actions -->
        <button class="top-nav-btn" id="btn-help-quick" title="Help & Documentation" aria-label="Help and Documentation">
            <i data-lucide="help-circle" aria-hidden="true"></i>
        </button>
        <button class="top-nav-btn" id="btn-settings-quick" title="Settings" aria-label="Open Settings">
            <i data-lucide="settings" aria-hidden="true"></i>
        </button>
    </div>
</header>

<div class="app-container">
    <!-- Enhanced Sidebar (v3.0.44: Collapsible) -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Review controls and settings">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <span class="sidebar-version" id="version-label"></span>
            </div>
            <!-- v4.0.2: Use chevron icons that point in the direction the panel will move -->
            <button class="btn btn-ghost btn-xs sidebar-collapse-btn" id="btn-sidebar-collapse" title="Collapse sidebar (Ctrl+B)" aria-label="Collapse sidebar" aria-expanded="true">
                <i data-lucide="chevron-left" aria-hidden="true"></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <!-- v3.0.114: Simplified Sidebar - Review Profile Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-label">Review Profile</div>
                <div class="profile-selector">
                    <button class="profile-btn active" id="btn-preset-reqs" title="Requirements-focused review">
                        <i data-lucide="file-check"></i>
                        <span>Requirements</span>
                    </button>
                    <button class="profile-btn" id="btn-preset-grammar" title="Grammar & spelling focus">
                        <i data-lucide="spell-check"></i>
                        <span>Grammar</span>
                    </button>
                    <button class="profile-btn" id="btn-preset-technical" title="Technical documentation">
                        <i data-lucide="file-cog"></i>
                        <span>Technical</span>
                    </button>
                    <button class="profile-btn" id="btn-preset-all" title="Enable all checks">
                        <i data-lucide="check-circle"></i>
                        <span>Full Scan</span>
                    </button>
                </div>
            </div>

            <!-- Document Type (optional) -->
            <div class="sidebar-section">
                <div class="sidebar-section-label">Document Type <span class="label-optional">(optional)</span></div>
                <div class="doc-type-selector">
                    <button class="doc-type-btn" id="btn-preset-prop" title="Procedure Operational">
                        <i data-lucide="clipboard-list"></i>
                        <span>PrOP</span>
                    </button>
                    <button class="doc-type-btn" id="btn-preset-pal" title="Process Asset Library">
                        <i data-lucide="library"></i>
                        <span>PAL</span>
                    </button>
                    <button class="doc-type-btn" id="btn-preset-fgost" title="Flow Gate/Stage Gate">
                        <i data-lucide="git-branch"></i>
                        <span>FGOST</span>
                    </button>
                    <button class="doc-type-btn" id="btn-preset-sow" title="Statement of Work">
                        <i data-lucide="scroll-text"></i>
                        <span>SOW</span>
                    </button>
                </div>
            </div>

            <!-- Severity Filter - Always visible -->
            <div class="sidebar-section">
                <div class="sidebar-section-label">Filter by Severity</div>
                <div class="severity-toggles">
                    <label class="severity-toggle" data-severity="critical">
                        <input type="checkbox" id="filter-critical" checked>
                        <span class="severity-pill critical">Critical <span class="sev-count" id="count-critical">0</span></span>
                    </label>
                    <label class="severity-toggle" data-severity="high">
                        <input type="checkbox" id="filter-high" checked>
                        <span class="severity-pill high">High <span class="sev-count" id="count-high">0</span></span>
                    </label>
                    <label class="severity-toggle" data-severity="medium">
                        <input type="checkbox" id="filter-medium" checked>
                        <span class="severity-pill medium">Medium <span class="sev-count" id="count-medium">0</span></span>
                    </label>
                    <label class="severity-toggle" data-severity="low">
                        <input type="checkbox" id="filter-low" checked>
                        <span class="severity-pill low">Low <span class="sev-count" id="count-low">0</span></span>
                    </label>
                    <label class="severity-toggle" data-severity="info">
                        <input type="checkbox" id="filter-info" checked>
                        <span class="severity-pill info">Info <span class="sev-count" id="count-info">0</span></span>
                    </label>
                </div>
            </div>

            <!-- Advanced Settings Toggle -->
            <div class="sidebar-section sidebar-advanced-toggle">
                <button class="btn btn-ghost btn-sm btn-full" id="btn-toggle-advanced" title="Show individual checker options" aria-label="Toggle advanced settings panel" aria-expanded="false" aria-controls="advanced-panel">
                    <i data-lucide="sliders-horizontal" aria-hidden="true"></i>
                    <span>Advanced Settings</span>
                    <i data-lucide="chevron-down" class="toggle-chevron" aria-hidden="true"></i>
                </button>
            </div>

            <!-- Advanced Checkers Panel (hidden by default) -->
            <div class="sidebar-advanced-panel" id="advanced-panel" style="display: none;">
                <!-- Writing Quality -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-writing">
                        <span>Writing Quality</span>
                        <span class="checker-count" id="count-writing">12</span>
                    </div>
                    <div class="checker-list" id="checks-writing">
                        <label class="checker-item"><input type="checkbox" data-checker="passive_voice" checked><span>Passive Voice</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="weak_language" checked><span>Weak Language</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="wordy_phrases" checked><span>Wordy Phrases</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="nominalization" checked><span>Nominalization</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="jargon" checked><span>Jargon</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="sentence_length" checked><span>Long Sentences</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="repeated_words" checked><span>Repeated Words</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="dangling_modifiers" checked><span>Dangling Modifiers</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="parallel_structure" checked><span>Parallel Structure</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="run_on_sentences" checked><span>Run-On Sentences</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="sentence_fragments" checked><span>Sentence Fragments</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="hyphenation" checked><span>Hyphenation</span></label>
                    </div>
                </div>

                <!-- Grammar & Spelling -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-grammar">
                        <span>Grammar & Spelling</span>
                        <span class="checker-count" id="count-grammar">5</span>
                    </div>
                    <div class="checker-list" id="checks-grammar">
                        <label class="checker-item"><input type="checkbox" data-checker="spelling" checked><span>Spelling</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="grammar" checked><span>Grammar</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="punctuation" checked><span>Punctuation</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="capitalization" checked><span>Capitalization</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="contractions" checked><span>Contractions</span></label>
                    </div>
                </div>

                <!-- Technical Writing -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-technical">
                        <span>Technical Writing</span>
                        <span class="checker-count" id="count-technical">13</span>
                    </div>
                    <div class="checker-list" id="checks-technical">
                        <label class="checker-item"><input type="checkbox" data-checker="acronyms" checked><span>Undefined Acronyms</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="requirements_language" checked><span>Requirements Language</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="tbd" checked><span>TBD/TBR Placeholders</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="testability" checked><span>Testability</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="atomicity" checked><span>Atomicity</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="escape_clauses" checked><span>Escape Clauses</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="number_format" checked><span>Number Format</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="units" checked><span>Units</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="terminology" checked><span>Terminology</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="serial_comma" checked><span>Serial Comma</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="enhanced_references" checked><span>Enhanced References</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="directive_verb_consistency" checked><span>Directive Verb Consistency</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="unresolved_cross_reference" checked><span>Unresolved Cross-References</span></label>
                    </div>
                </div>

                <!-- Clarity -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-clarity">
                        <span>Clarity</span>
                        <span class="checker-count">5</span>
                    </div>
                    <div class="checker-list" id="checks-clarity">
                        <label class="checker-item"><input type="checkbox" data-checker="ambiguous_pronouns" checked><span>Ambiguous Pronouns</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="hedging" checked><span>Hedging</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="weasel_words" checked><span>Weasel Words</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="cliches" checked><span>ClichÃ©s</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="redundancy" checked><span>Redundancy</span></label>
                    </div>
                </div>

                <!-- Document Structure -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-structure">
                        <span>Document Structure</span>
                        <span class="checker-count">7</span>
                    </div>
                    <div class="checker-list" id="checks-structure">
                        <label class="checker-item"><input type="checkbox" data-checker="document_structure" checked><span>Document Structure</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="references" checked><span>References</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="hyperlinks" checked><span>Hyperlinks</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="tables_figures" checked><span>Tables & Figures</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="lists" checked><span>Lists</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="orphan_headings" checked><span>Orphan Headings</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="empty_sections" checked><span>Empty Sections</span></label>
                    </div>
                </div>

                <!-- Standards -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-standards">
                        <span>Standards Compliance</span>
                        <span class="checker-count">3</span>
                    </div>
                    <div class="checker-list" id="checks-standards">
                        <label class="checker-item"><input type="checkbox" data-checker="mil_std" checked><span>MIL-STD Compliance</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="do178" checked><span>DO-178C Compliance</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="accessibility" checked><span>Accessibility</span></label>
                    </div>
                </div>

                <!-- Other -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-other">
                        <span>Other</span>
                        <span class="checker-count">4</span>
                    </div>
                    <div class="checker-list" id="checks-other">
                        <label class="checker-item"><input type="checkbox" data-checker="roles" checked><span>Role Extraction</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="gender_language" checked><span>Gender-Neutral</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="track_changes" checked><span>Track Changes</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="consistency" checked><span>Consistency</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="requirement_traceability" checked><span>Requirement Traceability</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="vague_quantifier" checked><span>Vague Quantifiers</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="verification_method" checked><span>Verification Method</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="ambiguous_scope" checked><span>Ambiguous Scope</span></label>
                    </div>
                </div>

                <!-- v5.2.0 Advanced NLP Enhancement Suite -->
                <div class="checker-category">
                    <div class="checker-header">
                        <span>Advanced NLP (v5.2.0)</span>
                        <span class="checker-count">10</span>
                    </div>
                    <div class="checker-list" id="checks-advanced-nlp">
                        <!-- Coreference & Semantics -->
                        <div class="checker-subcategory-title">Coreference & Semantics</div>
                        <label class="checker-item"><input type="checkbox" data-checker="coreference_resolution" checked><span>Coreference Resolution</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="semantic_role_analysis" checked><span>Semantic Role Analysis</span></label>

                        <!-- Prose Quality -->
                        <div class="checker-subcategory-title">Prose Quality</div>
                        <label class="checker-item"><input type="checkbox" data-checker="advanced_prose_lint" checked><span>Advanced Prose Lint</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="verbosity_detection" checked><span>Verbosity Detection</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="document_summarization" checked><span>Document Summarization</span></label>

                        <!-- Text Analysis -->
                        <div class="checker-subcategory-title">Text Analysis</div>
                        <label class="checker-item"><input type="checkbox" data-checker="keyword_extraction" checked><span>Keyword Extraction</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="complexity_analysis" checked><span>Complexity Analysis</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="information_extraction" checked><span>Information Extraction</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="noun_phrase_density" checked><span>Noun Phrase Density</span></label>

                        <!-- Requirements Compliance -->
                        <div class="checker-subcategory-title">Requirements Compliance</div>
                        <label class="checker-item"><input type="checkbox" data-checker="incose_compliance" checked><span>INCOSE Compliance</span></label>
                    </div>
                </div>

                <!-- v5.3.0 spaCy Ecosystem & Deep Analysis Suite -->
                <div class="checker-category">
                    <div class="checker-header">
                        <span>spaCy Deep Analysis (v5.3.0)</span>
                        <span class="checker-count">11</span>
                    </div>
                    <div class="checker-list" id="checks-spacy-deep">
                        <!-- Negation & Tone -->
                        <div class="checker-subcategory-title">Negation & Tone</div>
                        <label class="checker-item"><input type="checkbox" data-checker="negation_detection" checked><span>Negation Detection</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="subjectivity_detection" checked><span>Subjectivity / Tone</span></label>

                        <!-- Document Metrics -->
                        <div class="checker-subcategory-title">Document Metrics</div>
                        <label class="checker-item"><input type="checkbox" data-checker="text_quality_metrics" checked><span>Text Quality Metrics</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="sentence_complexity" checked><span>Sentence Complexity</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="lexical_diversity" checked><span>Lexical Diversity</span></label>

                        <!-- Terminology & Keywords -->
                        <div class="checker-subcategory-title">Terminology & Keywords</div>
                        <label class="checker-item"><input type="checkbox" data-checker="terminology_consistency" checked><span>Terminology Consistency</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="keyword_analysis" checked><span>Keyword Analysis (YAKE)</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="defined_before_used" checked><span>Defined Before Used</span></label>

                        <!-- Requirements Intelligence -->
                        <div class="checker-subcategory-title">Requirements Intelligence</div>
                        <label class="checker-item"><input type="checkbox" data-checker="requirement_similarity" checked><span>Duplicate Requirement Detection</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="quantifier_precision" checked><span>Quantifier Precision</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="cross_sentence_coherence" checked><span>Cross-Sentence Coherence</span></label>
                    </div>
                </div>

                <!-- Quick Actions for Advanced -->
                <div class="checker-actions">
                    <button class="btn btn-xs btn-ghost" id="btn-preset-none" title="Disable all checks">Clear All</button>
                    <button class="btn btn-xs btn-ghost" id="btn-save-profile" title="Save current settings">Save Profile</button>
                </div>
            </div>
        </nav>
        
        <!-- v3.0.49: Sidebar footer hidden - functionality moved to top nav bar -->
        <div class="sidebar-footer" style="display:none;">
            <!-- v3.0.33 Chunk C: Added statements-ready badge container -->
            <div class="btn-with-badge" style="position: relative; display: inline-block;">
                <button class="btn btn-ghost btn-sm" id="btn-statement-forge" title="Statement Forge" style="padding: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"></path><path d="M17.64 15 22 10.64"></path><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91"></path></svg>
                </button>
                <span class="sf-ready-badge" id="sf-ready-badge" style="display: none;" title="Statements extracted and ready">âœ“</span>
            </div>
            <button class="btn btn-ghost btn-sm" id="btn-scan-history" title="Scan History" style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-settings" title="Settings" style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-roles-report" title="Roles Report" disabled style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-diagnostics" title="Export Diagnostics (for troubleshooting)" style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M12 18v-6"></path><path d="M9 15h6"></path></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-help" title="Help (F1)" style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><path d="M12 17h.01"></path></svg>
            </button>
            <div class="version-info" id="footer-version"></div>
        </div>
        <div class="sidebar-credit">Created by Nicholas Georgeson</div>
    </aside>
    
    <main class="main-content">
        <header class="main-header">
            <div class="doc-info">
                <div class="doc-status" id="doc-status">
                    <span class="doc-status-indicator" id="doc-status-indicator">
                        <i data-lucide="file-x"></i>
                    </span>
                    <span class="doc-status-text" id="doc-status-text">No document loaded</span>
                </div>
                <h1 class="doc-title" id="doc-title"></h1>
                <p class="doc-subtitle" id="doc-subtitle"></p>
            </div>
            <!-- v3.0.43: Persistent run-state indicator -->
            <div class="run-state-indicator" id="run-state-indicator" style="display:none;" role="status" aria-live="polite">
                <div class="run-state-pulse"></div>
                <span class="run-state-text" id="run-state-text">Scanning...</span>
                <button class="btn btn-ghost btn-xs run-state-cancel" id="run-state-cancel" title="Cancel scan" aria-label="Cancel document scan">
                    <i data-lucide="x" aria-hidden="true"></i>
                </button>
            </div>
            <div class="header-actions">
                <button class="btn btn-ghost btn-icon" id="btn-theme-toggle" title="Toggle dark/light mode" aria-label="Toggle dark and light theme">
                    <i data-lucide="sun" id="theme-icon-light" style="display:none;" aria-hidden="true"></i>
                    <i data-lucide="moon" id="theme-icon-dark" aria-hidden="true"></i>
                </button>
                <button class="btn btn-primary btn-action" id="btn-open" style="gap: 6px;" aria-label="Open and upload a document for analysis">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><path d="M12 11v6"></path><path d="m9 14 3-3 3 3"></path></svg>
                    <span>Open</span>
                </button>
                <!-- v2.9.4.2: Batch Load button always visible (#19) -->
                <button class="btn btn-secondary btn-action" id="btn-batch-load" title="Load multiple documents" style="gap: 6px;" aria-label="Load multiple documents for batch processing">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M4 11l-2 2 2 2"></path><path d="M12 11l2 2-2 2"></path><path d="M5 16l3 6"></path><path d="M11 16l-3 6"></path></svg>
                    <span>Batch</span>
                </button>
                <button class="btn btn-secondary btn-action" id="btn-review" disabled style="gap: 6px;" aria-label="Start reviewing the selected document">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                    <span>Review</span>
                </button>
                <button class="btn btn-secondary btn-action" id="btn-export" disabled aria-label="Export review results and findings">
                    <i data-lucide="download" aria-hidden="true"></i><span>Export</span>
                </button>
            </div>
        </header>
        
        <!-- Enhanced Stats Bar with Metrics -->
        <div class="stats-bar" id="stats-bar" style="display:none;">
            <div class="stat-group stat-group-document">
                <div class="stat">
                    <i data-lucide="file-text" class="stat-icon" aria-hidden="true"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-words">0</span>
                        <span class="stat-label">Words</span>
                    </div>
                </div>
                <div class="stat">
                    <i data-lucide="align-justify" class="stat-icon" aria-hidden="true"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-paragraphs">0</span>
                        <span class="stat-label">Paragraphs</span>
                    </div>
                </div>
                <div class="stat">
                    <i data-lucide="table" class="stat-icon" aria-hidden="true"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-tables">0</span>
                        <span class="stat-label">Tables</span>
                    </div>
                </div>
                <div class="stat">
                    <i data-lucide="heading" class="stat-icon" aria-hidden="true"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-headings">0</span>
                        <span class="stat-label">Headings</span>
                    </div>
                </div>
            </div>
            
            <div class="stat-divider"></div>
            
            <div class="stat-group stat-group-issues">
                <div class="stat stat-issues">
                    <i data-lucide="alert-triangle" class="stat-icon" aria-hidden="true"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-issues">--</span>
                        <span class="stat-label">Issues</span>
                    </div>
                </div>
                <button class="stat stat-score-container" id="stat-score-container" style="cursor: pointer; border: none; background: none; padding: 0;" title="Click to see score breakdown" aria-label="View document quality score breakdown">
                    <div class="score-ring" id="score-ring">
                        <svg viewBox="0 0 36 36">
                            <path class="score-ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            <path class="score-ring-fill" id="score-ring-fill" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                        </svg>
                        <span class="score-value" id="stat-score">--</span>
                    </div>
                    <span class="stat-label">Score</span>
                </button>
                <div class="stat stat-grade-display">
                    <span class="stat-value grade" id="stat-grade">--</span>
                    <span class="stat-label">Grade</span>
                </div>
            </div>
            
            <div class="stat-divider"></div>

            <!-- v4.0.2: Compact gauge-style readability metrics -->
            <div class="stat-group stat-group-readability-gauges">
                <div class="stat-gauge tooltip-trigger" data-tooltip="Flesch Reading Ease Score (0-100). Higher = easier to read. 60-70: Standard. 30-50: College. 0-30: Graduate.">
                    <svg class="mini-gauge" viewBox="0 0 80 45">
                        <defs>
                            <linearGradient id="stat-flesch-grad" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#ef4444"/>
                                <stop offset="50%" style="stop-color:#f59e0b"/>
                                <stop offset="100%" style="stop-color:#10b981"/>
                            </linearGradient>
                        </defs>
                        <path d="M 8 38 A 32 32 0 0 1 72 38" fill="none" stroke="#e5e7eb" stroke-width="6" stroke-linecap="round"/>
                        <path id="stat-flesch-arc" d="M 8 38 A 32 32 0 0 1 72 38" fill="none" stroke="url(#stat-flesch-grad)" stroke-width="6" stroke-linecap="round" stroke-dasharray="0 100"/>
                        <text x="40" y="32" id="stat-flesch" class="gauge-num">--</text>
                    </svg>
                    <span class="stat-gauge-label">Flesch</span>
                </div>
                <div class="stat-gauge tooltip-trigger" data-tooltip="Flesch-Kincaid Grade Level. US school grade needed. 8-10: High school. 10-12: College. 12+: Graduate.">
                    <svg class="mini-gauge" viewBox="0 0 80 45">
                        <path d="M 8 38 A 32 32 0 0 1 72 38" fill="none" stroke="#e5e7eb" stroke-width="6" stroke-linecap="round"/>
                        <path id="stat-fk-arc" d="M 8 38 A 32 32 0 0 1 72 38" fill="none" stroke="#06b6d4" stroke-width="6" stroke-linecap="round" stroke-dasharray="0 100"/>
                        <text x="40" y="32" id="stat-fk-grade" class="gauge-num">--</text>
                    </svg>
                    <span class="stat-gauge-label">Grade Level</span>
                </div>
                <div class="stat-gauge tooltip-trigger" data-tooltip="Gunning Fog Index. Years of education needed. 12: High school. 14: College. 17+: Graduate.">
                    <svg class="mini-gauge" viewBox="0 0 80 45">
                        <path d="M 8 38 A 32 32 0 0 1 72 38" fill="none" stroke="#e5e7eb" stroke-width="6" stroke-linecap="round"/>
                        <path id="stat-fog-arc" d="M 8 38 A 32 32 0 0 1 72 38" fill="none" stroke="#8b5cf6" stroke-width="6" stroke-linecap="round" stroke-dasharray="0 100"/>
                        <text x="40" y="32" id="stat-fog" class="gauge-num">--</text>
                    </svg>
                    <span class="stat-gauge-label">Fog Index</span>
                </div>
            </div>
        </div>
        
        <div class="content-area">
            <!-- Empty State - Enterprise Design -->
            <div class="empty-state" id="empty-state">
                <div class="empty-icon" id="dropzone">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                </div>
                <h2>Drop a document to begin</h2>
                <p class="empty-subtitle">Drag & drop a .docx or .pdf file, or use <kbd>Ctrl</kbd>+<kbd>O</kbd> to open</p>
                <div class="empty-capabilities">
                    <span class="capability-item">50+ Quality Checks</span>
                    <span class="capability-divider">Â·</span>
                    <span class="capability-item">Role Extraction</span>
                    <span class="capability-divider">Â·</span>
                    <span class="capability-item">Readability Analysis</span>
                    <span class="capability-divider">Â·</span>
                    <span class="capability-item">Standards Compliance</span>
                </div>
            </div>
            
            <!-- Batch Upload Modal -->
            <div class="modal" id="batch-upload-modal" role="dialog" aria-modal="true" aria-labelledby="batch-modal-title">
                <div class="modal-overlay"></div>
                <div class="modal-container" style="max-width:700px;">
                    <div class="modal-header">
                        <h3 id="batch-modal-title"><i data-lucide="folder-plus" aria-hidden="true"></i> Batch Upload Documents</h3>
                        <button class="btn btn-ghost" id="btn-close-batch-modal" aria-label="Close batch upload dialog">
                            <i data-lucide="x" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Hidden file inputs (outside dropzone to prevent event bubbling issues) -->
                        <input type="file" id="batch-file-input" multiple accept=".docx,.pdf,.doc" style="display:none;">
                        <input type="file" id="batch-folder-input" webkitdirectory directory multiple style="display:none;">

                        <div class="batch-dropzone" id="batch-dropzone" role="region" aria-label="Drag and drop zone for uploading documents">
                            <i data-lucide="upload-cloud" aria-hidden="true"></i>
                            <p>Drop files or folders here</p>
                            <p class="text-muted">Supports .docx, .doc, and .pdf files (including subdirectories)</p>
                            <div class="batch-upload-buttons">
                                <button type="button" class="btn btn-secondary btn-sm" id="btn-select-files" aria-label="Select files from your computer">
                                    <i data-lucide="file-plus" aria-hidden="true"></i> Select Files
                                </button>
                                <button type="button" class="btn btn-secondary btn-sm" id="btn-select-folder" aria-label="Select a folder from your computer">
                                    <i data-lucide="folder-open" aria-hidden="true"></i> Select Folder
                                </button>
                            </div>
                            <p class="text-muted" style="margin-top: 8px; font-size: 11px; opacity: 0.7;">
                                Tip: For folder selection, navigate into the folder and click "Upload"
                            </p>
                        </div>
                        <!-- v5.5.0: Server-side folder scan input -->
                        <div class="folder-scan-section" id="folder-scan-section">
                            <div class="folder-scan-divider">
                                <span>or scan a server folder</span>
                            </div>
                            <div class="folder-scan-input-row">
                                <input type="text" id="folder-scan-path" class="folder-scan-input"
                                       placeholder="Enter folder path (e.g. C:\Documents\Specs)"
                                       aria-label="Folder path for server-side document scanning">
                                <button type="button" class="btn btn-secondary btn-sm" id="btn-folder-discover"
                                        aria-label="Preview files in folder before scanning">
                                    <i data-lucide="search" aria-hidden="true"></i> Preview
                                </button>
                                <button type="button" class="btn btn-primary btn-sm" id="btn-folder-scan"
                                        aria-label="Scan all documents in the specified folder">
                                    <i data-lucide="scan-line" aria-hidden="true"></i> Scan All
                                </button>
                            </div>
                            <div class="folder-scan-preview hidden" id="folder-scan-preview">
                                <!-- Discovery results shown here -->
                            </div>

                            <!-- v5.7.0: Folder Scan Real-Time Progress Dashboard (reuses bpd-* classes) -->
                            <div class="bpd-dashboard hidden" id="folder-scan-dashboard">
                                <div class="bpd-header">
                                    <div class="bpd-header-icon">
                                        <i data-lucide="folder-search"></i>
                                    </div>
                                    <h2 class="bpd-title">Folder Scan</h2>
                                    <div class="bpd-subtitle">Scanning documents through AEGIS quality engine</div>
                                </div>

                                <div class="bpd-stats">
                                    <div class="bpd-stat">
                                        <div class="bpd-stat-value" id="fs-docs-complete">0</div>
                                        <div class="bpd-stat-label">Complete</div>
                                    </div>
                                    <div class="bpd-stat-divider"></div>
                                    <div class="bpd-stat">
                                        <div class="bpd-stat-value" id="fs-docs-total">0</div>
                                        <div class="bpd-stat-label">Total</div>
                                    </div>
                                    <div class="bpd-stat-divider"></div>
                                    <div class="bpd-stat">
                                        <div class="bpd-stat-value" id="fs-percent">0%</div>
                                        <div class="bpd-stat-label">Progress</div>
                                    </div>
                                    <div class="bpd-stat-divider"></div>
                                    <div class="bpd-stat">
                                        <div class="bpd-stat-value" id="fs-issues-found">0</div>
                                        <div class="bpd-stat-label">Issues</div>
                                    </div>
                                </div>

                                <div class="bpd-overall">
                                    <div class="bpd-overall-bar">
                                        <div class="bpd-overall-fill" id="fs-progress-fill"></div>
                                        <div class="bpd-overall-glow" id="fs-progress-glow"></div>
                                    </div>
                                </div>

                                <div class="bpd-metrics">
                                    <div class="bpd-metric">
                                        <i data-lucide="clock" class="bpd-metric-icon"></i>
                                        <span class="bpd-metric-label">Elapsed</span>
                                        <span class="bpd-metric-value" id="fs-elapsed-time">00:00</span>
                                    </div>
                                    <div class="bpd-metric">
                                        <i data-lucide="timer" class="bpd-metric-icon"></i>
                                        <span class="bpd-metric-label">Remaining</span>
                                        <span class="bpd-metric-value bpd-estimated" id="fs-remaining-time">--:--</span>
                                    </div>
                                    <div class="bpd-metric">
                                        <i data-lucide="activity" class="bpd-metric-icon"></i>
                                        <span class="bpd-metric-label">Speed</span>
                                        <span class="bpd-metric-value" id="fs-speed">--</span>
                                    </div>
                                </div>

                                <div class="bpd-queue">
                                    <div class="bpd-queue-header">
                                        <span><i data-lucide="folder-open" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Document Queue</span>
                                        <span class="bpd-queue-status" id="fs-queue-status">Starting...</span>
                                    </div>
                                    <div class="bpd-queue-list" id="fs-doc-list">
                                        <!-- Document rows inserted dynamically by polling -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- v5.9.29: SharePoint Online Scan Section -->
                        <div class="sharepoint-scan-section" id="sharepoint-scan-section">
                            <div class="folder-scan-divider">
                                <span>or scan a SharePoint library</span>
                            </div>
                            <div class="folder-scan-input-row" style="flex-wrap:wrap;gap:6px;">
                                <input type="text" id="sp-site-url" class="folder-scan-input"
                                       placeholder="SharePoint site URL (e.g. https://ngc.sharepoint.us/sites/MyTeam)"
                                       aria-label="SharePoint site URL"
                                       style="flex:1 1 100%;">
                                <input type="text" id="sp-library-path" class="folder-scan-input"
                                       placeholder="Library path (e.g. /sites/MyTeam/Shared Documents)"
                                       aria-label="SharePoint document library path"
                                       style="flex:1 1 60%;">
                                <button type="button" class="btn btn-secondary btn-sm" id="btn-sp-test"
                                        aria-label="Test connection to SharePoint">
                                    <i data-lucide="plug" aria-hidden="true"></i> Test
                                </button>
                                <button type="button" class="btn btn-secondary btn-sm" id="btn-sp-discover"
                                        aria-label="Preview files in SharePoint library">
                                    <i data-lucide="search" aria-hidden="true"></i> Preview
                                </button>
                                <button type="button" class="btn btn-primary btn-sm" id="btn-sp-scan"
                                        aria-label="Scan all documents in SharePoint library" disabled>
                                    <i data-lucide="scan-line" aria-hidden="true"></i> Scan All
                                </button>
                            </div>
                            <div style="margin-top:4px;">
                                <label style="font-size:11px;color:var(--text-muted);cursor:pointer;">
                                    <input type="checkbox" id="sp-recursive" checked style="margin-right:4px;">
                                    Include subfolders
                                </label>
                            </div>
                            <div id="sp-connection-status" class="hidden" style="margin-top:8px;padding:8px 12px;border-radius:6px;font-size:12px;"></div>
                            <div class="folder-scan-preview hidden" id="sp-file-preview">
                                <!-- SharePoint discovery results shown here -->
                            </div>

                            <!-- SharePoint Scan Progress Dashboard (reuses bpd-* classes + folder scan dashboard) -->
                            <div class="bpd-dashboard hidden" id="sp-scan-dashboard">
                                <div class="bpd-header">
                                    <div class="bpd-header-icon">
                                        <i data-lucide="cloud"></i>
                                    </div>
                                    <h2 class="bpd-title">SharePoint Scan</h2>
                                    <div class="bpd-subtitle">Downloading and reviewing SharePoint documents</div>
                                </div>

                                <div class="bpd-stats">
                                    <div class="bpd-stat">
                                        <div class="bpd-stat-value" id="sp-docs-complete">0</div>
                                        <div class="bpd-stat-label">Complete</div>
                                    </div>
                                    <div class="bpd-stat-divider"></div>
                                    <div class="bpd-stat">
                                        <div class="bpd-stat-value" id="sp-docs-total">0</div>
                                        <div class="bpd-stat-label">Total</div>
                                    </div>
                                    <div class="bpd-stat-divider"></div>
                                    <div class="bpd-stat">
                                        <div class="bpd-stat-value" id="sp-percent">0%</div>
                                        <div class="bpd-stat-label">Progress</div>
                                    </div>
                                    <div class="bpd-stat-divider"></div>
                                    <div class="bpd-stat">
                                        <div class="bpd-stat-value" id="sp-issues-found">0</div>
                                        <div class="bpd-stat-label">Issues</div>
                                    </div>
                                </div>

                                <div class="bpd-overall">
                                    <div class="bpd-overall-bar">
                                        <div class="bpd-overall-fill" id="sp-progress-fill"></div>
                                        <div class="bpd-overall-glow" id="sp-progress-glow"></div>
                                    </div>
                                </div>

                                <div class="bpd-metrics">
                                    <div class="bpd-metric">
                                        <i data-lucide="clock" class="bpd-metric-icon"></i>
                                        <span class="bpd-metric-label">Elapsed</span>
                                        <span class="bpd-metric-value" id="sp-elapsed-time">00:00</span>
                                    </div>
                                    <div class="bpd-metric">
                                        <i data-lucide="timer" class="bpd-metric-icon"></i>
                                        <span class="bpd-metric-label">Remaining</span>
                                        <span class="bpd-metric-value bpd-estimated" id="sp-remaining-time">--:--</span>
                                    </div>
                                    <div class="bpd-metric">
                                        <i data-lucide="activity" class="bpd-metric-icon"></i>
                                        <span class="bpd-metric-label">Speed</span>
                                        <span class="bpd-metric-value" id="sp-speed">--</span>
                                    </div>
                                </div>

                                <div class="bpd-queue">
                                    <div class="bpd-queue-header">
                                        <span><i data-lucide="cloud" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Document Queue</span>
                                        <span class="bpd-queue-status" id="sp-queue-status">Starting...</span>
                                    </div>
                                    <div class="bpd-queue-list" id="sp-doc-list">
                                        <!-- Document rows inserted dynamically by polling -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="batch-file-list" id="batch-file-list">
                            <!-- Files will be listed here -->
                        </div>
                        <!-- v5.0.2: Batch Progress Dashboard (matches ScanProgress style) -->
                        <div class="bpd-dashboard hidden" id="batch-progress">
                            <!-- Header -->
                            <div class="bpd-header">
                                <div class="bpd-header-icon">
                                    <i data-lucide="layers"></i>
                                </div>
                                <h2 class="bpd-title" id="batch-progress-text">Batch Analysis</h2>
                                <div class="bpd-subtitle">Processing documents through AEGIS quality engine</div>
                            </div>

                            <!-- Stats row -->
                            <div class="bpd-stats">
                                <div class="bpd-stat">
                                    <div class="bpd-stat-value" id="batch-docs-complete">0</div>
                                    <div class="bpd-stat-label">Complete</div>
                                </div>
                                <div class="bpd-stat-divider"></div>
                                <div class="bpd-stat">
                                    <div class="bpd-stat-value" id="batch-docs-total">0</div>
                                    <div class="bpd-stat-label">Total</div>
                                </div>
                                <div class="bpd-stat-divider"></div>
                                <div class="bpd-stat">
                                    <div class="bpd-stat-value" id="batch-percent-animated">0%</div>
                                    <div class="bpd-stat-label">Progress</div>
                                </div>
                            </div>

                            <!-- Overall progress bar -->
                            <div class="bpd-overall">
                                <div class="bpd-overall-bar">
                                    <div class="bpd-overall-fill" id="batch-progress-fill"></div>
                                    <div class="bpd-overall-glow" id="batch-progress-glow"></div>
                                </div>
                            </div>

                            <!-- Time and speed metrics -->
                            <div class="bpd-metrics">
                                <div class="bpd-metric">
                                    <i data-lucide="clock" class="bpd-metric-icon"></i>
                                    <span class="bpd-metric-label">Elapsed</span>
                                    <span class="bpd-metric-value" id="batch-elapsed-time">00:00</span>
                                </div>
                                <div class="bpd-metric">
                                    <i data-lucide="timer" class="bpd-metric-icon"></i>
                                    <span class="bpd-metric-label">Remaining</span>
                                    <span class="bpd-metric-value bpd-estimated" id="batch-remaining-time">--:--</span>
                                </div>
                                <div class="bpd-metric">
                                    <i data-lucide="activity" class="bpd-metric-icon"></i>
                                    <span class="bpd-metric-label">Speed</span>
                                    <span class="bpd-metric-value" id="batch-speed">--</span>
                                </div>
                            </div>

                            <!-- Document queue -->
                            <div class="bpd-queue">
                                <div class="bpd-queue-header">
                                    <span><i data-lucide="file-stack" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Document Queue</span>
                                    <span class="bpd-queue-status" id="batch-queue-status">Waiting...</span>
                                </div>
                                <div class="bpd-queue-list" id="batch-doc-list">
                                    <!-- Document rows inserted dynamically -->
                                </div>
                            </div>

                            <!-- Sound toggle (hidden until processing) -->
                            <button class="bpd-sound-toggle" id="cinematic-sound-toggle" title="Toggle completion sound">
                                <i data-lucide="volume-2"></i>
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="btn-cancel-batch">Cancel</button>
                        <button class="btn btn-primary" id="btn-start-batch" disabled>
                            <i data-lucide="play"></i> Process All Files
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Batch Results View -->
            <div class="batch-results" id="batch-results" style="display:none;">
                <div class="batch-results-header">
                    <h3><i data-lucide="files"></i> Batch Scan Results</h3>
                    <button class="btn btn-secondary" id="btn-back-from-batch">
                        <i data-lucide="arrow-left"></i> Back
                    </button>
                </div>
                <div class="batch-summary" id="batch-summary">
                    <!-- Summary cards here -->
                </div>
                <div class="batch-documents" id="batch-documents">
                    <!-- Document list here -->
                </div>
            </div>
            
            <!-- Analytics Accordion (v3.0.13 - collapsed by default) -->
            <div class="analytics-accordion" id="analytics-accordion" style="display:none;">
                <div class="analytics-header" id="analytics-header">
                    <div class="analytics-summary">
                        <i data-lucide="bar-chart-2"></i>
                        <span class="analytics-title">Analytics</span>
                        <span class="analytics-inline-stats" id="analytics-inline-stats">
                            <!-- e.g., "5 Critical, 3 High, 12 Medium" - populated dynamically -->
                        </span>
                    </div>
                    <div class="analytics-actions">
                        <span class="analytics-toggle-hint" id="analytics-toggle-hint">Click to expand</span>
                        <i data-lucide="chevron-down" class="analytics-chevron" id="analytics-chevron"></i>
                    </div>
                </div>
                <div class="analytics-body" id="analytics-body" style="display:none;">
                    <!-- Chart Filter Notice -->
                    <div class="chart-filter-notice" id="chart-filter-notice" style="display:none;">
                        <i data-lucide="filter"></i>
                        <span>Filtered by chart: <strong id="chart-filter-value"></strong></span>
                        <button class="btn btn-xs btn-secondary" id="btn-clear-chart-filter">
                            <i data-lucide="x"></i> Clear
                        </button>
                    </div>
                    
                    <!-- Smart Recommendations Banner -->
                    <div class="smart-recommendations" id="smart-recommendations" style="display:none;">
                        <div class="recommendations-header">
                            <i data-lucide="lightbulb"></i>
                            <span>Smart Recommendations</span>
                            <button class="btn btn-ghost btn-xs" id="btn-dismiss-recommendations" title="Dismiss">
                                <i data-lucide="x"></i>
                            </button>
                        </div>
                        <div class="recommendations-body" id="recommendations-list">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                    
                    <!-- v4.0.2: Readability Analysis removed - now shown in stats bar gauges -->

                    <!-- Mini Charts Row - v4.0.1: Charts visible, enhanced with interactivity -->
                    <div class="dashboard-charts">
                        <!-- v4.0.1: Severity chart restored -->
                        <div class="chart-card chart-clickable" data-chart="severity" id="severity-chart-card">
                            <div class="chart-header">
                                <h4><i data-lucide="pie-chart"></i> Severity Distribution</h4>
                                <span class="chart-hint">Click to filter</span>
                            </div>
                            <div class="chart-body">
                                <canvas id="chart-severity" width="200" height="200"></canvas>
                            </div>
                        </div>
                        <!-- v4.0.1: Category chart restored -->
                        <div class="chart-card chart-clickable" data-chart="category" id="category-chart-card">
                            <div class="chart-header">
                                <h4><i data-lucide="bar-chart-3"></i> Top Categories</h4>
                                <span class="chart-hint">Click to filter</span>
                            </div>
                            <div class="chart-body">
                                <canvas id="chart-categories" width="300" height="200"></canvas>
                            </div>
                        </div>
                        <div class="chart-card chart-card-roles" id="roles-chart-card" style="display:none;">
                            <div class="chart-header">
                                <h4><i data-lucide="users"></i> Roles Detected</h4>
                                <button class="btn btn-ghost btn-sm" id="btn-view-roles" title="View Full Report">
                                    <i data-lucide="external-link"></i>
                                </button>
                            </div>
                            <div class="chart-body roles-summary" id="roles-summary">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                        <div class="chart-card chart-card-acronyms" id="acronym-metrics-card" style="display:none;">
                            <div class="chart-header">
                                <h4><i data-lucide="a-large-small"></i> Acronym Analysis</h4>
                                <div class="acronym-mode-badge" id="acronym-mode-badge" title="Click to toggle mode">
                                    <span id="acronym-mode-label">Strict Mode</span>
                                </div>
                            </div>
                            <div class="chart-body acronym-metrics" id="acronym-metrics">
                                <div class="acronym-metrics-grid">
                                    <div class="acronym-metric">
                                        <span class="metric-value" id="acronym-total-count">0</span>
                                        <span class="metric-label">Acronyms Found</span>
                                    </div>
                                    <div class="acronym-metric">
                                        <span class="metric-value" id="acronym-defined-count">0</span>
                                        <span class="metric-label">Defined</span>
                                    </div>
                                    <div class="acronym-metric">
                                        <span class="metric-value" id="acronym-suppressed-count">0</span>
                                        <span class="metric-label">Suppressed</span>
                                    </div>
                                    <div class="acronym-metric" style="background: var(--color-warning-light);">
                                        <span class="metric-value" id="acronym-flagged-count">0</span>
                                        <span class="metric-label">Flagged</span>
                                    </div>
                                </div>
                                <div class="acronym-suppressed-list" id="acronym-suppressed-list" style="display:none;">
                                    <small class="text-muted">Suppressed acronyms: <span id="acronym-suppressed-items">-</span></small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- v3.0.33 Chunk E: Score Trend Sparkline -->
                        <div class="chart-card chart-card-trend" id="score-trend-card" style="display:none;">
                            <div class="chart-header">
                                <h4><i data-lucide="trending-up"></i> Quality Score Trend</h4>
                                <span class="trend-summary" id="trend-summary">-</span>
                            </div>
                            <div class="chart-body sparkline-body" id="sparkline-container">
                                <svg id="score-sparkline" width="100%" height="60"></svg>
                                <div class="sparkline-tooltip" id="sparkline-tooltip" style="display:none;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- v3.0.114: Combined Document Analytics Panel (3 columns) -->
                    <div class="issue-analytics-combined" id="issue-analytics-combined" style="display:none;">
                        <div class="analytics-combined-header">
                            <h4><i data-lucide="bar-chart-3"></i> Document Analytics</h4>
                            <div class="heatmap-actions">
                                <button class="btn btn-ghost btn-xs" id="btn-export-heatmap" title="Export as PNG">
                                    <i data-lucide="download"></i>
                                    Export
                                </button>
                            </div>
                        </div>
                        <div class="analytics-combined-body three-columns">
                            <!-- Column 1: Category Ã— Severity Heatmap -->
                            <div class="analytics-panel heatmap-panel">
                                <div class="panel-subtitle">Issues by Category</div>
                                <div class="heatmap-body" id="issue-heatmap">
                                    <!-- Populated dynamically by renderIssueHeatmap() -->
                                </div>
                                <div class="heatmap-legend heatmap-intensity-legend">
                                    <span class="legend-item"><span class="legend-color intensity-0"></span> 0</span>
                                    <span class="legend-item"><span class="legend-color intensity-1"></span> 1-2</span>
                                    <span class="legend-item"><span class="legend-color intensity-2"></span> 3-5</span>
                                    <span class="legend-item"><span class="legend-color intensity-3"></span> 6-10</span>
                                    <span class="legend-item"><span class="legend-color intensity-4"></span> 10+</span>
                                </div>
                            </div>
                            <!-- Column 2: Fix Impact Analyzer (replaced Issues by Section carousel) -->
                            <div class="analytics-panel impact-analyzer-panel">
                                <div class="panel-subtitle"><i data-lucide="target"></i> Fix Impact Analyzer</div>
                                <div class="impact-analyzer-inline" id="impact-analyzer-inline">
                                    <div class="score-projection-inline">
                                        <!-- Current Score Gauge -->
                                        <div class="score-gauge-inline" id="current-score-gauge-inline">
                                            <svg viewBox="0 0 100 100">
                                                <circle class="score-gauge-bg" cx="50" cy="50" r="42" />
                                                <circle class="score-gauge-fill current" cx="50" cy="50" r="42"
                                                    stroke-dasharray="0 264" id="current-gauge-fill-inline" />
                                            </svg>
                                            <div class="score-gauge-center">
                                                <span class="score-gauge-value" id="current-score-value-inline">--</span>
                                                <span class="score-gauge-label">Current</span>
                                            </div>
                                        </div>
                                        <!-- Arrow with improvement -->
                                        <div class="score-arrow-inline">
                                            <i data-lucide="arrow-right"></i>
                                            <span class="score-improvement" id="score-improvement-inline">+0</span>
                                        </div>
                                        <!-- Projected Score Gauge -->
                                        <div class="score-gauge-inline" id="projected-score-gauge-inline">
                                            <svg viewBox="0 0 100 100">
                                                <circle class="score-gauge-bg" cx="50" cy="50" r="42" />
                                                <circle class="score-gauge-fill projected" cx="50" cy="50" r="42"
                                                    stroke-dasharray="0 264" id="projected-gauge-fill-inline" />
                                            </svg>
                                            <div class="score-gauge-center animate">
                                                <span class="score-gauge-value" id="projected-score-value-inline">--</span>
                                                <span class="score-gauge-label">Projected</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="top-fixes-header-inline">
                                        <span><i data-lucide="route"></i> Path to 100</span>
                                        <button class="btn btn-xs btn-primary" id="btn-select-top-fixes-inline" title="Select all issues in top group">
                                            <i data-lucide="check-square"></i> Select Top
                                        </button>
                                    </div>
                                    <div class="top-fixes-list-inline" id="top-fixes-list-inline">
                                        <!-- Dynamic fix items will be rendered here -->
                                    </div>
                                </div>
                            </div>
                            <!-- Column 3: Hyperlink Status with Domain Health Carousel -->
                            <div class="analytics-panel hyperlinks-panel" id="hyperlinks-panel">
                                <div class="panel-subtitle">Hyperlinks</div>
                                <div class="hyperlinks-summary" id="hyperlink-summary-inline">
                                    <!-- Summary: 4 valid, 0 invalid -->
                                </div>
                                <!-- Domain Health Carousel (3D) for Review Tab -->
                                <div class="review-domain-carousel-container" id="review-domain-carousel" style="display:none;">
                                    <!-- Domain health carousel will be rendered here by HyperlinkVisualization -->
                                </div>
                                <div class="hyperlinks-list" id="hyperlink-list-inline">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Legacy containers for backward compatibility (hidden) -->
                    <div class="issue-heatmap-container" id="issue-heatmap-container" style="display:none !important;"></div>
                    <div class="section-heatmap-container" id="section-heatmap-container" style="display:none !important;"></div>
                    <div class="hyperlink-status-container" id="hyperlink-status-container" style="display:none !important;"></div>
                </div>
            </div>
            
            <!-- Unified Filter Bar (v3.0.13) -->
            <div class="unified-filter-bar" id="unified-filter-bar" style="display:none;">
                <div class="filter-bar-left">
                    <div class="severity-toggles" id="unified-severity-toggles">
                        <button class="sev-toggle active" data-severity="critical" title="Critical">
                            <span class="sev-dot critical"></span>
                            <span class="sev-label">Critical</span>
                            <span class="sev-count" id="unified-count-critical">0</span>
                        </button>
                        <button class="sev-toggle active" data-severity="high" title="High">
                            <span class="sev-dot high"></span>
                            <span class="sev-label">High</span>
                            <span class="sev-count" id="unified-count-high">0</span>
                        </button>
                        <button class="sev-toggle active" data-severity="medium" title="Medium">
                            <span class="sev-dot medium"></span>
                            <span class="sev-label">Medium</span>
                            <span class="sev-count" id="unified-count-medium">0</span>
                        </button>
                        <button class="sev-toggle active" data-severity="low" title="Low">
                            <span class="sev-dot low"></span>
                            <span class="sev-label">Low</span>
                            <span class="sev-count" id="unified-count-low">0</span>
                        </button>
                        <button class="sev-toggle active" data-severity="info" title="Info">
                            <span class="sev-dot info"></span>
                            <span class="sev-label">Info</span>
                            <span class="sev-count" id="unified-count-info">0</span>
                        </button>
                    </div>
                    <div class="filter-divider"></div>
                    <div class="category-dropdown">
                        <button class="btn btn-ghost btn-sm" id="btn-category-dropdown" title="Filter by category">
                            <i data-lucide="tag"></i>
                            <span>Categories</span>
                            <span class="category-active-count" id="category-active-count" style="display:none;">0</span>
                            <i data-lucide="chevron-down" style="width:12px;height:12px;"></i>
                        </button>
                        <div class="category-dropdown-panel" id="category-dropdown-panel" style="display:none;">
                            <div class="category-dropdown-header">
                                <input type="text" id="unified-category-search" class="form-input form-input-sm" placeholder="Search categories..." aria-label="Search and filter categories">
                                <div class="category-quick-actions">
                                    <button class="btn btn-xs btn-ghost" id="unified-cat-all" title="Select All" aria-label="Select all categories">All</button>
                                    <button class="btn btn-xs btn-ghost" id="unified-cat-none" title="Select None" aria-label="Deselect all categories">None</button>
                                </div>
                            </div>
                            <div class="category-dropdown-list" id="unified-category-list">
                                <!-- Categories populated dynamically -->
                            </div>
                        </div>
                    </div>
                    <div class="filter-divider"></div>
                    <!-- v3.0.29: Validation filter toggle -->
                    <div class="validation-filter-toggle" id="validation-filter-toggle" title="Filter by source validation status">
                        <button class="btn btn-ghost btn-xs validation-btn active" data-validation="all" title="Show all issues">
                            <i data-lucide="list"></i>
                            <span>All</span>
                        </button>
                        <button class="btn btn-ghost btn-xs validation-btn" data-validation="validated" title="Show only validated issues">
                            <i data-lucide="check-circle"></i>
                            <span>Validated</span>
                            <span class="validation-count" id="validation-count-validated" style="display:none;">0</span>
                        </button>
                        <button class="btn btn-ghost btn-xs validation-btn" data-validation="unvalidated" title="Show unvalidated issues">
                            <i data-lucide="help-circle"></i>
                            <span>Unvalidated</span>
                            <span class="validation-count" id="validation-count-unvalidated" style="display:none;">0</span>
                        </button>
                    </div>
                </div>
                <div class="filter-bar-right">
                    <div class="filter-chips-inline" id="filter-chips-inline">
                        <!-- Active filter chips shown here -->
                    </div>
                    <button class="btn btn-ghost btn-xs" id="btn-clear-filters" title="Clear all filters" style="display:none;">
                        <i data-lucide="x"></i> Clear
                    </button>
                    <span class="filter-result-summary" id="filter-result-summary"></span>
                </div>
            </div>
            
            <!-- Issues Table -->
            <div class="table-container" id="issues-container" style="display:none;">
                <!-- Issue Families Panel (Pareto View) -->
                <div class="families-panel" id="families-panel" style="display:none;">
                    <div class="families-panel-header" id="families-panel-toggle">
                        <div class="families-panel-title">
                            <i data-lucide="layers"></i>
                            <span>Top Repeated Patterns</span>
                            <span class="families-panel-count" id="families-panel-count">0</span>
                        </div>
                        <div class="families-panel-actions">
                            <span class="families-panel-summary" id="families-panel-summary"></span>
                            <button class="btn btn-ghost btn-xs" id="btn-expand-families" title="Expand all details">
                                <i data-lucide="chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    <div class="families-panel-body" id="families-panel-body">
                        <div class="families-inline-list" id="families-inline-list">
                            <!-- Populated dynamically -->
                        </div>
                        <div class="families-panel-footer">
                            <button class="btn btn-xs btn-ghost" id="btn-families-expand">
                                <i data-lucide="maximize-2"></i> View All in Modal
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="table-header">
                    <div class="table-actions">
                        <div class="selection-dropdown">
                            <button class="btn btn-ghost btn-sm" id="btn-select-menu" title="Selection options">
                                <i data-lucide="check-square"></i>
                                <i data-lucide="chevron-down" style="width:12px;height:12px;margin-left:2px;"></i>
                            </button>
                            <div class="dropdown-menu" id="select-dropdown" style="display:none;">
                                <button class="dropdown-item" id="btn-select-page">Select this page</button>
                                <button class="dropdown-item" id="btn-select-filtered">Select all filtered (<span id="filtered-total">0</span>)</button>
                                <button class="dropdown-item" id="btn-select-none-menu">Deselect all</button>
                            </div>
                        </div>
                        <span class="selection-count" id="selection-count">0 selected</span>
                        <span class="filtered-count" id="filtered-count"></span>
                    </div>
                    <div class="table-view-controls">
                        <button class="btn btn-ghost btn-sm" id="btn-triage-mode" title="Review issues one at a time (keyboard-first)">
                            <i data-lucide="list-checks"></i> Triage
                        </button>
                        <button class="btn btn-ghost btn-sm" id="btn-families" title="Find repeated patterns for bulk action">
                            <i data-lucide="copy"></i> Families
                        </button>
                        <button class="btn btn-ghost btn-sm" id="btn-review-log" title="View audit trail of decisions">
                            <i data-lucide="clipboard-list"></i> Log
                            <span class="review-log-badge" id="review-log-badge" style="display:none;">0</span>
                        </button>
                        <div class="density-toggle" title="Row density">
                            <button class="btn btn-ghost btn-xs density-btn active" data-density="compact" title="Compact">
                                <i data-lucide="align-justify"></i>
                            </button>
                            <button class="btn btn-ghost btn-xs density-btn" data-density="comfortable" title="Comfortable">
                                <i data-lucide="menu"></i>
                            </button>
                        </div>
                        <div class="table-view-toggle">
                            <button class="btn btn-ghost btn-sm active" id="btn-view-table" title="Table View">
                                <i data-lucide="list"></i>
                            </button>
                            <button class="btn btn-ghost btn-sm" id="btn-view-cards" title="Card View">
                                <i data-lucide="layout-grid"></i>
                            </button>
                        </div>
                    </div>
                    <div class="search-box">
                        <i data-lucide="search"></i>
                        <input type="text" id="issue-search" placeholder="Search issues..." aria-label="Search issues">
                        <button class="btn btn-ghost btn-xs" id="btn-clear-search" style="display:none;" aria-label="Clear search">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                
                <div class="issues-list-header" id="issues-list-header">
                    <div class="col-expand"></div>
                    <div class="col-check"></div>
                    <div class="col-severity sortable" data-sort="severity" tabindex="0" role="button" aria-label="Sort by severity">
                        Severity <i data-lucide="chevron-up" class="sort-icon"></i>
                    </div>
                    <div class="col-category sortable" data-sort="category" tabindex="0" role="button" aria-label="Sort by category">
                        Category <i data-lucide="chevron-up" class="sort-icon"></i>
                    </div>
                    <div class="col-message">Message</div>
                    <div class="col-actions"></div>
                </div>
                
                <div class="table-body" id="issues-list" role="list" aria-label="Issues list">
                    <!-- Issues populated here -->
                </div>
                
                <!-- Keyboard Navigation Hint -->
                <div class="keyboard-hint" id="keyboard-hint" style="display:none;">
                    <kbd>â†‘</kbd><kbd>â†“</kbd> Navigate &nbsp; <kbd>Enter</kbd> Expand &nbsp; <kbd>Space</kbd> Select &nbsp; <kbd>Esc</kbd> Close
                </div>
                
                <!-- Pagination -->
                <div class="table-footer" id="table-footer" style="display:none;">
                    <div class="pagination-info">
                        Showing <span id="page-start">1</span>-<span id="page-end">50</span> of <span id="total-issues">0</span> issues
                    </div>
                    <div class="pagination-controls">
                        <button class="btn btn-ghost btn-sm" id="btn-prev-page" title="Previous page" disabled>
                            <i data-lucide="chevron-left"></i> Previous
                        </button>
                        <span class="page-indicator">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
                        <button class="btn btn-ghost btn-sm" id="btn-next-page" title="Next page" disabled>
                            Next <i data-lucide="chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Hidden file input -->
<input type="file" id="file-input" style="display:none" accept=".docx,.pdf,.doc">

<!-- Toast container -->
<div class="toast-container" id="toast-container" role="status" aria-live="polite" aria-atomic="true"></div>

<!-- Enhanced Loading overlay with 3D animated progress (B9) -->
<div class="loading-overlay" id="loading-overlay">
    <div class="loading-content loading-3d">
        <!-- Glowing orb accents -->
        <div class="loading-orb loading-orb-1"></div>
        <div class="loading-orb loading-orb-2"></div>
        <div class="loading-orb loading-orb-3"></div>

        <p id="loading-text" class="loading-title">Processing...</p>

        <!-- Molten Progress bar -->
        <div class="molten-progress molten-medium molten-with-reflection" id="loading-molten-progress">
            <div class="molten-rail"></div>
            <div class="molten-fill" id="loading-progress-bar"></div>
            <div class="molten-orb" id="loading-progress-orb"></div>
        </div>

        <!-- v2.9.4.2: Enhanced loading with ETA (#24) -->
        <div class="loading-eta-container" id="loading-eta-container" style="display:none;">
            <span class="loading-eta-label">Estimated time remaining:</span>
            <span class="loading-eta-value" id="loading-eta">calculating...</span>
        </div>
        <p class="loading-detail" id="loading-detail"></p>
        <!-- v2.9.4.2: Item counter for long operations -->
        <p class="loading-items" id="loading-items" style="display:none;"></p>
        <!-- Step-by-step progress checklist (B9) -->
        <div class="loading-steps" id="loading-steps" style="display:none;">
            <div class="loading-step" data-step="upload">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Uploading document...</span>
            </div>
            <div class="loading-step" data-step="extract">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Extracting text content...</span>
            </div>
            <div class="loading-step" data-step="analyze">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Running quality checks...</span>
            </div>
            <div class="loading-step" data-step="roles">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Detecting roles & responsibilities...</span>
            </div>
            <div class="loading-step" data-step="render">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Rendering results...</span>
            </div>
        </div>
        <!-- v2.9.4.2: Cancel button for long operations -->
        <button class="btn btn-ghost btn-sm loading-cancel" id="loading-cancel" style="display:none;">
            <i data-lucide="x"></i> Cancel
        </button>
    </div>
</div>

<!-- v5.9.4: Export Progress Overlay -->
<div class="export-progress-overlay" id="export-progress-overlay">
    <div class="export-progress-card">
        <div class="export-progress-icon"><i data-lucide="loader-2"></i></div>
        <div class="export-progress-title" id="export-progress-title">Generating Export...</div>
        <div class="export-progress-detail" id="export-progress-detail">Preparing your document</div>
        <div class="export-progress-bar">
            <div class="export-progress-bar-fill" id="export-progress-bar-fill"></div>
        </div>
    </div>
</div>

<!-- Triage Mode Modal -->
<div class="modal modal-lg" id="modal-triage" role="dialog" aria-modal="true" aria-labelledby="modal-triage-title">
    <div class="modal-content triage-modal">
        <div class="modal-header">
            <h3 id="modal-triage-title"><i data-lucide="list-checks"></i> Triage Mode</h3>
            <div class="triage-progress">
                <span id="triage-current">1</span> / <span id="triage-total">0</span>
                <div class="triage-progress-bar">
                    <div class="triage-progress-fill" id="triage-progress-fill" style="width:0%"></div>
                </div>
            </div>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body triage-body">
            <div class="triage-issue" id="triage-issue">
                <div class="triage-header">
                    <span class="severity-badge" id="triage-severity">Info</span>
                    <span class="triage-category" id="triage-category">Category</span>
                </div>
                <div class="triage-message" id="triage-message">
                    Issue message will appear here
                </div>
                <div class="triage-context" id="triage-context">
                    <h5>Context</h5>
                    <div class="context-text" id="triage-context-text">
                        Surrounding text context...
                    </div>
                </div>
                <div class="triage-suggestion" id="triage-suggestion-section">
                    <h5>Suggestion</h5>
                    <div class="suggestion-text" id="triage-suggestion-text">
                        Suggested fix...
                    </div>
                </div>
                <div class="triage-family-info" id="triage-family-info" style="display:none;"></div>
            </div>
        </div>
        <div class="modal-footer triage-footer">
            <div class="triage-nav">
                <button class="btn btn-ghost" id="btn-triage-prev" title="Previous issue (â†)">
                    <i data-lucide="chevron-left"></i> Prev
                </button>
                <button class="btn btn-ghost" id="btn-triage-next" title="Next issue (â†’)">
                    Next <i data-lucide="chevron-right"></i>
                </button>
            </div>
            <div class="triage-actions">
                <button class="btn btn-success" id="btn-triage-keep" title="Keep this issue (K)">
                    <i data-lucide="check"></i> Keep
                </button>
                <button class="btn btn-warning" id="btn-triage-suppress" title="Suppress/baseline this issue (S)">
                    <i data-lucide="eye-off"></i> Suppress
                </button>
                <button class="btn btn-primary" id="btn-triage-fixed" title="Mark as fixed (F)">
                    <i data-lucide="check-circle"></i> Fixed
                </button>
            </div>
            <div class="triage-shortcuts">
                <kbd>â†</kbd><kbd>â†’</kbd> Navigate &nbsp;
                <kbd>K</kbd> Keep &nbsp;
                <kbd>S</kbd> Suppress &nbsp;
                <kbd>F</kbd> Fixed &nbsp;
                <kbd>Esc</kbd> Exit
            </div>
        </div>
    </div>
</div>

<!-- Bulk Selection Confirmation Modal -->
<div class="modal modal-sm" id="modal-bulk-confirm" role="dialog" aria-modal="true" aria-labelledby="modal-bulk-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-bulk-title"><i data-lucide="alert-triangle"></i> Confirm Selection</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <p>You are about to select <strong id="bulk-count">0</strong> issues.</p>
            <p class="text-muted">This may affect performance with very large selections.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="btn-confirm-bulk">Select All</button>
        </div>
    </div>
</div>

<!-- Export Modal -->
<div class="modal" id="modal-export" role="dialog" aria-modal="true" aria-labelledby="modal-export-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-export-title"><i data-lucide="download" aria-hidden="true"></i> Export Document</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
        <div class="form-group">
            <label>Reviewer Name</label>
            <input type="text" id="export-reviewer-name" class="form-input" value="AEGIS" placeholder="Enter reviewer name">
        </div>
        <div class="form-group">
            <label>Export Mode</label>
            <div class="radio-group export-mode-group">
                <label class="radio-card">
                    <input type="radio" name="export-mode" value="all" checked>
                    <div class="radio-card-content">
                        <i data-lucide="file-text"></i>
                        <span class="radio-card-title">All Issues</span>
                        <span class="radio-card-count" id="export-count-all">0</span>
                    </div>
                </label>
                <label class="radio-card">
                    <input type="radio" name="export-mode" value="filtered">
                    <div class="radio-card-content">
                        <i data-lucide="filter"></i>
                        <span class="radio-card-title">Filtered</span>
                        <span class="radio-card-count" id="export-count-filtered">0</span>
                    </div>
                </label>
                <label class="radio-card">
                    <input type="radio" name="export-mode" value="selected">
                    <div class="radio-card-content">
                        <i data-lucide="check-square"></i>
                        <span class="radio-card-title">Selected</span>
                        <span class="radio-card-count" id="export-count-selected">0</span>
                    </div>
                </label>
            </div>
        </div>
        <div class="form-group">
            <label>Export Format</label>
            <div class="radio-group export-format-group">
                <label class="radio-card format-card" id="format-docx-card">
                    <input type="radio" name="export-format" value="docx" checked>
                    <div class="radio-card-content">
                        <i data-lucide="file-text"></i>
                        <span class="radio-card-title">Word</span>
                        <span class="radio-card-desc">.docx comments</span>
                    </div>
                </label>
                <label class="radio-card format-card format-card-pdf" id="format-pdf-card">
                    <input type="radio" name="export-format" value="pdf">
                    <div class="radio-card-content">
                        <i data-lucide="file-badge"></i>
                        <span class="radio-card-title">PDF Report</span>
                        <span class="radio-card-desc">.pdf branded</span>
                    </div>
                </label>
                <label class="radio-card format-card format-card-xlsx" id="format-xlsx-card">
                    <input type="radio" name="export-format" value="xlsx">
                    <div class="radio-card-content">
                        <i data-lucide="sheet"></i>
                        <span class="radio-card-title">Excel</span>
                        <span class="radio-card-desc">.xlsx detailed</span>
                    </div>
                </label>
                <label class="radio-card format-card" id="format-csv-card">
                    <input type="radio" name="export-format" value="csv">
                    <div class="radio-card-content">
                        <i data-lucide="file-spreadsheet"></i>
                        <span class="radio-card-title">CSV</span>
                        <span class="radio-card-desc">.csv simple</span>
                    </div>
                </label>
                <label class="radio-card format-card" id="format-json-card">
                    <input type="radio" name="export-format" value="json">
                    <div class="radio-card-content">
                        <i data-lucide="braces"></i>
                        <span class="radio-card-title">JSON</span>
                        <span class="radio-card-desc">.json raw data</span>
                    </div>
                </label>
            </div>
            <p class="help-text" id="export-pdf-notice" style="display:none; color: var(--warning);">
                Note: PDF source files are read-only. Word export is only available for DOCX files.
            </p>
        </div>
        <!-- v5.9.4: Pre-export filter panel -->
        <div class="export-filter-panel" id="export-filter-panel">
            <div class="export-filter-header" id="export-filter-header" onclick="window.toggleExportFilterPanel()">
                <h4><i data-lucide="sliders-horizontal"></i> Filter Issues</h4>
                <span class="export-filter-toggle"><span>Expand</span> <i data-lucide="chevron-down"></i></span>
            </div>
            <div class="export-filter-body" id="export-filter-body">
                <div class="export-filter-row">
                    <div class="export-filter-group">
                        <label>Severity</label>
                        <div class="export-filter-chips" id="export-filter-severity-chips">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>
                <div class="export-filter-row">
                    <div class="export-filter-group">
                        <label>Category</label>
                        <div class="export-filter-chips" id="export-filter-category-chips">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>
                <div class="export-filter-preview" id="export-filter-preview" style="display:none;">
                    <span><span class="export-filter-preview-count" id="export-filter-count">0</span>
                    <span class="export-filter-preview-label"> issues will be exported</span></span>
                    <button class="export-filter-clear" id="export-filter-clear" onclick="window.clearExportFilters()">Clear Filters</button>
                </div>
            </div>
        </div>
        <!-- v3.0.111: Consolidated fix review section -->
        <div class="form-group" id="apply-fixes-group">
            <div class="fix-assistant-launcher" id="fix-assistant-launcher">
                <div class="fix-assistant-summary">
                    <div class="fix-summary-stat">
                        <i data-lucide="wand-2"></i>
                        <span id="fixable-count">0</span> fixes available
                    </div>
                    <div class="fix-summary-stat selected">
                        <i data-lucide="check-circle"></i>
                        <span id="selected-fix-count">0</span> selected
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" id="btn-open-fix-assistant" title="Review fixes before applying them to the document" onclick="if(window.FixAssistant){window.FixAssistant.open()}">
                    <i data-lucide="clipboard-check"></i> Review & Select Fixes
                </button>
            </div>
            <label class="checkbox-label checkbox-featured" style="margin-top: 0.75rem;">
                <input type="checkbox" id="export-apply-fixes">
                <span>
                    <strong>Apply selected fixes with Track Changes</strong>
                    <small>Selected fixes will be automatically applied to the exported document</small>
                </span>
            </label>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-secondary modal-close">Cancel</button>
        <button class="btn btn-primary" id="btn-do-export"><i data-lucide="download"></i> Export</button>
    </div>
    </div>
</div>

<!-- Export Review Modal (v2.9.4.2 #22) - Full-screen review before export -->
<div class="modal modal-fullscreen" id="modal-export-review" role="dialog" aria-modal="true" aria-labelledby="modal-export-review-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-export-review-title"><i data-lucide="clipboard-check"></i> Review Changes Before Export</h3>
            <div class="export-review-progress">
                <span id="export-review-progress-text">0 of 0 reviewed</span>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="export-review-progress-bar" style="width:0%"></div>
                </div>
            </div>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body export-review-body">
            <!-- Filter controls -->
            <div class="export-review-filters">
                <div class="filter-group">
                    <label>Severity:</label>
                    <select id="export-review-filter-severity" class="form-select">
                        <option value="">All</option>
                        <option value="Critical">Critical</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Category:</label>
                    <select id="export-review-filter-category" class="form-select">
                        <option value="">All</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Status:</label>
                    <select id="export-review-filter-status" class="form-select">
                        <option value="">All</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-sm btn-secondary" id="btn-approve-all-visible">
                        <i data-lucide="check-check"></i> Approve All Visible
                    </button>
                    <button class="btn btn-sm btn-secondary" id="btn-reject-all-visible">
                        <i data-lucide="x-circle"></i> Reject All Visible
                    </button>
                </div>
            </div>
            
            <!-- Issues list -->
            <div class="export-review-list" id="export-review-list">
                <!-- Populated dynamically -->
            </div>
        </div>
        <div class="modal-footer">
            <div class="export-review-summary">
                <span class="summary-item approved"><i data-lucide="check"></i> <span id="export-review-approved">0</span> approved</span>
                <span class="summary-item rejected"><i data-lucide="x"></i> <span id="export-review-rejected">0</span> rejected</span>
                <span class="summary-item pending"><i data-lucide="clock"></i> <span id="export-review-pending">0</span> pending</span>
            </div>
            <div class="export-review-actions">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-primary" id="btn-export-approved">
                    <i data-lucide="download"></i> Export Approved (<span id="export-review-approved-count">0</span>)
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Fix Assistant Modal (v3.0.96) - Triage-style fix review -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Fix Assistant v2 Modal - v3.0.97                                            -->
<!-- Premium document review interface with two-panel layout                     -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="fav2-modal" id="fav2-modal" role="dialog" aria-modal="true" aria-labelledby="fav2-modal-title" style="display: none;">
    <div class="fav2-modal-content">
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- Header                                                               -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <header class="fav2-header">
            <div class="fav2-header-left">
                <!-- Title -->
                <h2 class="fav2-title" id="fav2-modal-title">
                    <i data-lucide="wand-2" aria-hidden="true"></i>
                    <span>Fix Assistant</span>
                </h2>
                
                <!-- Search -->
                <div class="fav2-search-wrapper">
                    <i data-lucide="search" class="fav2-search-icon" aria-hidden="true"></i>
                    <input 
                        type="text" 
                        id="fav2-search-input" 
                        class="fav2-search-input" 
                        placeholder="Search fixes..." 
                        aria-label="Search fixes"
                    >
                </div>
                
                <!-- Navigation Mode -->
                <div class="fav2-mode-wrapper">
                    <label for="fav2-nav-mode" class="visually-hidden">Navigation mode</label>
                    <select id="fav2-nav-mode" class="fav2-nav-mode" aria-label="Navigation mode">
                        <option value="all">All Fixes</option>
                        <option value="pending">Pending Only</option>
                        <option value="page">Current Page</option>
                        <option value="category">By Category</option>
                        <option value="confidence">By Confidence</option>
                    </select>
                </div>
            </div>
            
            <div class="fav2-header-center">
                <!-- Progress Bar -->
                <div class="fav2-progress-wrapper" role="progressbar" aria-valuenow="12" aria-valuemin="0" aria-valuemax="47" aria-label="Review progress">
                    <div class="fav2-progress-bar" id="fav2-progress-bar">
                        <div class="fav2-progress-fill" id="fav2-progress-fill" style="width: 25%;"></div>
                    </div>
                    <span class="fav2-progress-text" id="fav2-progress-text">
                        <span id="fav2-counter-current">12</span> of <span id="fav2-counter-total">47</span>
                    </span>
                </div>
            </div>
            
            <div class="fav2-header-right">
                <!-- Undo/Redo -->
                <div class="fav2-btn-group" role="group" aria-label="Undo and redo actions">
                    <button type="button" id="fav2-btn-undo" class="fav2-btn fav2-btn-icon" aria-label="Undo last action" title="Undo (U)" disabled>
                        <i data-lucide="undo-2" aria-hidden="true"></i>
                    </button>
                    <button type="button" id="fav2-btn-redo" class="fav2-btn fav2-btn-icon" aria-label="Redo last action" title="Redo (Shift+U)" disabled>
                        <i data-lucide="redo-2" aria-hidden="true"></i>
                    </button>
                </div>
                
                <!-- Shortcuts Toggle -->
                <button type="button" id="fav2-btn-shortcuts" class="fav2-btn fav2-btn-icon" aria-label="Toggle keyboard shortcuts" aria-pressed="false" title="Keyboard shortcuts (?)">
                    <i data-lucide="keyboard" aria-hidden="true"></i>
                </button>
                
                <!-- Sound Toggle -->
                <button type="button" id="fav2-btn-sound" class="fav2-btn fav2-btn-icon" aria-label="Toggle sound effects" aria-pressed="false" title="Sound effects (off)">
                    <i data-lucide="volume-x" aria-hidden="true"></i>
                </button>
                
                <!-- Close -->
                <button type="button" id="fav2-btn-close" class="fav2-btn fav2-btn-icon fav2-btn-close" aria-label="Close Fix Assistant" title="Close (Esc)">
                    <i data-lucide="x" aria-hidden="true"></i>
                </button>
            </div>
        </header>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- Body - Two Panel Layout                                              -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <main class="fav2-body">
            <div class="fav2-panels">
                
                <!-- Left Panel: Document Viewer -->
                <div class="fav2-panel-left">
                    <!-- Mini-map -->
                    <aside class="fav2-minimap-container" aria-label="Document minimap">
                        <div class="fav2-minimap" id="fav2-minimap" role="img" aria-label="Document overview with fix locations">
                            <!-- JS renders minimap content here -->
                            <div class="fav2-minimap-placeholder">
                                <span>Minimap</span>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Document Viewer -->
                    <section class="fav2-document-viewer-container">
                        <div class="fav2-document-viewer" id="fav2-document-viewer" tabindex="0" aria-label="Document preview with highlighted fixes" role="region">
                            <!-- JS renders document content here -->
                            <div class="fav2-viewer-placeholder">
                                <i data-lucide="file-text" aria-hidden="true"></i>
                                <span>Document content will appear here</span>
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- Right Panel: Fix Details -->
                <aside class="fav2-panel-right" aria-label="Fix details panel">
                    
                    <!-- Fix Header with Badges -->
                    <div class="fav2-fix-header">
                        <div class="fav2-fix-badges">
                            <span class="fav2-confidence-badge fav2-confidence-safe" id="fav2-confidence-badge" role="status">
                                SAFE
                            </span>
                            <span class="fav2-category-badge" id="fav2-category-badge">
                                Spelling
                            </span>
                        </div>
                        <div class="fav2-fix-counter" aria-label="Fix position">
                            <span class="fav2-counter-display">
                                <span id="fav2-counter-current-detail" aria-live="polite">1</span>
                                <span class="fav2-counter-separator">/</span>
                                <span id="fav2-counter-total-detail">47</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Change Preview -->
                    <section class="fav2-change-section" aria-labelledby="fav2-change-heading">
                        <h3 class="visually-hidden" id="fav2-change-heading">Proposed Change</h3>
                        
                        <div class="fav2-change-row fav2-change-before">
                            <span class="fav2-change-label">Before:</span>
                            <span class="fav2-change-text" id="fav2-change-before" role="status" aria-live="polite">
                                recieve
                            </span>
                        </div>
                        
                        <div class="fav2-change-row fav2-change-after">
                            <span class="fav2-change-label">After:</span>
                            <span class="fav2-change-text" id="fav2-change-after" role="status" aria-live="polite">
                                receive
                            </span>
                        </div>
                    </section>
                    
                    <!-- Reason -->
                    <section class="fav2-reason-section" aria-labelledby="fav2-reason-heading">
                        <h3 class="visually-hidden" id="fav2-reason-heading">Reason for change</h3>
                        <div class="fav2-reason" id="fav2-reason" role="status" aria-live="polite">
                            Common spelling error: "i before e except after c"
                        </div>
                    </section>
                    
                    <!-- Confidence Details (Expandable) -->
                    <section class="fav2-confidence-section">
                        <button 
                            type="button" 
                            id="fav2-confidence-toggle" 
                            class="fav2-confidence-toggle" 
                            aria-expanded="false" 
                            aria-controls="fav2-confidence-details"
                        >
                            <i data-lucide="chevron-down" class="fav2-toggle-icon" aria-hidden="true"></i>
                            <span>Show confidence details</span>
                        </button>
                        <div class="fav2-confidence-details" id="fav2-confidence-details" hidden>
                            <dl class="fav2-confidence-list">
                                <dt>Confidence Score:</dt>
                                <dd><span class="fav2-confidence-score">95%</span></dd>
                                <dt>Category Certainty:</dt>
                                <dd>High</dd>
                                <dt>Pattern Match:</dt>
                                <dd>Dictionary lookup</dd>
                                <dt>Risk Level:</dt>
                                <dd>Minimal</dd>
                            </dl>
                        </div>
                    </section>
                    
                    <!-- Reviewer Note -->
                    <section class="fav2-note-section" aria-labelledby="fav2-note-heading">
                        <label for="fav2-reviewer-note" class="fav2-note-label" id="fav2-note-heading">
                            <i data-lucide="info" aria-hidden="true"></i>
                            Reviewer Note (optional):
                        </label>
                        <textarea 
                            id="fav2-reviewer-note" 
                            class="fav2-reviewer-note" 
                            placeholder="Add a note about this fix..."
                            rows="2"
                            aria-describedby="fav2-note-hint"
                        ></textarea>
                        <span class="fav2-note-hint visually-hidden" id="fav2-note-hint">
                            Optional note explaining your decision
                        </span>
                    </section>
                    
                    <!-- Page Fixes List -->
                    <section class="fav2-page-fixes-section" aria-labelledby="fav2-page-fixes-heading">
                        <h4 class="fav2-page-fixes-heading" id="fav2-page-fixes-heading">
                            Fixes on this page (<span class="fav2-page-fix-count">3</span>):
                        </h4>
                        <ul class="fav2-page-fixes-list" id="fav2-page-fixes-list" role="listbox" aria-label="Fixes on current page">
                            <!-- JS populates this list -->
                            <li class="fav2-page-fix-item fav2-page-fix-current" role="option" aria-selected="true" data-fix-index="0">
                                <span class="fav2-page-fix-text">recieve</span>
                                <span class="fav2-page-fix-status">(current)</span>
                            </li>
                            <li class="fav2-page-fix-item" role="option" aria-selected="false" data-fix-index="1">
                                <span class="fav2-page-fix-text">accomodate</span>
                            </li>
                            <li class="fav2-page-fix-item" role="option" aria-selected="false" data-fix-index="2">
                                <span class="fav2-page-fix-text">occured</span>
                            </li>
                        </ul>
                    </section>
                    
                    <!-- Action Buttons -->
                    <nav class="fav2-actions" aria-label="Fix actions">
                        <div class="fav2-action-primary">
                            <button type="button" id="fav2-btn-accept" class="fav2-btn fav2-btn-accept" title="Accept fix (A)">
                                <i data-lucide="check" aria-hidden="true"></i>
                                <span>Accept</span>
                            </button>
                            <button type="button" id="fav2-btn-reject" class="fav2-btn fav2-btn-reject" title="Reject fix (R)">
                                <i data-lucide="x" aria-hidden="true"></i>
                                <span>Reject</span>
                            </button>
                            <button type="button" id="fav2-btn-skip" class="fav2-btn fav2-btn-skip" title="Skip for now (S)">
                                <i data-lucide="skip-forward" aria-hidden="true"></i>
                                <span>Skip</span>
                            </button>
                        </div>
                        <div class="fav2-action-nav">
                            <button type="button" id="fav2-btn-prev" class="fav2-btn fav2-btn-nav" aria-label="Previous fix" title="Previous (â†)">
                                <i data-lucide="chevron-left" aria-hidden="true"></i>
                                <span>Prev</span>
                            </button>
                            <button type="button" id="fav2-btn-next" class="fav2-btn fav2-btn-nav" aria-label="Next fix" title="Next (â†’)">
                                <span>Next</span>
                                <i data-lucide="chevron-right" aria-hidden="true"></i>
                            </button>
                        </div>
                    </nav>
                    
                </aside>
                
            </div>
            
            <!-- Split View Container (hidden by default) -->
            <div class="fav2-split-view" id="fav2-split-view" hidden aria-label="Split comparison view">
                <div class="fav2-split-original">
                    <h4>Original</h4>
                    <div class="fav2-split-content"></div>
                </div>
                <div class="fav2-split-modified">
                    <h4>With Changes</h4>
                    <div class="fav2-split-content"></div>
                </div>
            </div>
        </main>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- Footer                                                               -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <footer class="fav2-footer">
            <div class="fav2-footer-left">
                <!-- Statistics -->
                <div class="fav2-stats" role="status" aria-live="polite" aria-label="Review statistics">
                    <span class="fav2-stat fav2-stat-accepted" title="Accepted fixes">
                        <i data-lucide="check" aria-hidden="true"></i>
                        <span id="fav2-stat-accepted">28</span> accepted
                    </span>
                    <span class="fav2-stat fav2-stat-rejected" title="Rejected fixes">
                        <i data-lucide="x" aria-hidden="true"></i>
                        <span id="fav2-stat-rejected">8</span> rejected
                    </span>
                    <span class="fav2-stat fav2-stat-pending" title="Pending fixes">
                        <span class="fav2-stat-pending-icon">â—‹</span>
                        <span id="fav2-stat-pending">11</span> pending
                    </span>
                </div>
            </div>
            
            <div class="fav2-footer-center">
                <!-- Bulk Actions -->
                <div class="fav2-bulk-actions" role="group" aria-label="Bulk actions">
                    <button type="button" id="fav2-btn-accept-safe" class="fav2-btn fav2-btn-bulk" title="Accept all high-confidence fixes">
                        <i data-lucide="shield-check" aria-hidden="true"></i>
                        <span>Safe</span>
                    </button>
                    <button type="button" id="fav2-btn-accept-all" class="fav2-btn fav2-btn-bulk" title="Accept all remaining fixes">
                        <i data-lucide="check-check" aria-hidden="true"></i>
                        <span>All</span>
                    </button>
                </div>
                
                <!-- View Mode Toggle -->
                <div class="fav2-view-toggle" role="group" aria-label="View mode">
                    <button type="button" id="fav2-btn-view-mode" class="fav2-btn fav2-btn-view" aria-pressed="false" title="Toggle split view">
                        <i data-lucide="eye" aria-hidden="true"></i>
                        <span>View</span>
                    </button>
                </div>
            </div>
            
            <div class="fav2-footer-right">
                <!-- Done Button -->
                <button type="button" id="fav2-btn-done" class="fav2-btn fav2-btn-done" title="Finish review and apply changes">
                    <span>Done</span>
                </button>
            </div>
        </footer>
        
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- Floating Panels                                                          -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <!-- Keyboard Shortcuts Panel -->
    <div class="fav2-shortcuts-panel" id="fav2-shortcuts-panel" role="complementary" aria-labelledby="fav2-shortcuts-title" hidden>
        <div class="fav2-shortcuts-header">
            <h3 id="fav2-shortcuts-title">
                <i data-lucide="keyboard" aria-hidden="true"></i>
                Keyboard Shortcuts
            </h3>
            <button type="button" class="fav2-shortcuts-close" aria-label="Close shortcuts panel">
                <i data-lucide="x" aria-hidden="true"></i>
            </button>
        </div>
        <div class="fav2-shortcuts-content">
            <table class="fav2-shortcuts-table" role="presentation">
                <thead class="visually-hidden">
                    <tr>
                        <th>Shortcut</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>A</kbd></td>
                        <td class="fav2-shortcut-action">Accept current fix</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>R</kbd></td>
                        <td class="fav2-shortcut-action">Reject current fix</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>S</kbd></td>
                        <td class="fav2-shortcut-action">Skip (decide later)</td>
                    </tr>
                    <tr class="fav2-shortcuts-divider"><td colspan="2"></td></tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>â†</kbd> <kbd>â†’</kbd></td>
                        <td class="fav2-shortcut-action">Previous / Next fix</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>U</kbd></td>
                        <td class="fav2-shortcut-action">Undo last action</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>Shift</kbd>+<kbd>U</kbd></td>
                        <td class="fav2-shortcut-action">Redo</td>
                    </tr>
                    <tr class="fav2-shortcuts-divider"><td colspan="2"></td></tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>/</kbd></td>
                        <td class="fav2-shortcut-action">Focus search</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>G</kbd></td>
                        <td class="fav2-shortcut-action">Go to page...</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>?</kbd></td>
                        <td class="fav2-shortcut-action">Toggle this panel</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>Esc</kbd></td>
                        <td class="fav2-shortcut-action">Close Fix Assistant</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
</div>

<!-- Settings Modal -->
<div class="modal modal-lg" id="modal-settings">
    <div class="modal-content">
        <div class="modal-header">
        <h3><i data-lucide="settings" aria-hidden="true"></i> Settings</h3>
        <button class="btn btn-ghost modal-close" aria-label="Close settings modal"><i data-lucide="x" aria-hidden="true"></i></button>
    </div>
    <div class="modal-body modal-settings">
        <!-- v5.9.19: Settings tabs with scroll indicator wrapper -->
        <div class="settings-tabs-wrapper" id="settings-tabs-wrapper">
            <button class="settings-tabs-arrow arrow-left" id="settings-arrow-left" aria-label="Scroll tabs left">&#8249;</button>
            <button class="settings-tabs-arrow arrow-right" id="settings-arrow-right" aria-label="Scroll tabs right">&#8250;</button>
            <div class="settings-tabs" role="tablist" id="settings-tabs-scroll">
                <button class="settings-tab active" data-tab="general" role="tab"><i data-lucide="sliders-horizontal"></i> General</button>
                <button class="settings-tab" data-tab="review" role="tab"><i data-lucide="book-open"></i> Review</button>
                <button class="settings-tab" data-tab="profiles" role="tab"><i data-lucide="file-check"></i> Profiles</button>
                <button class="settings-tab" data-tab="network" role="tab"><i data-lucide="shield"></i> Network</button>
                <button class="settings-tab" data-tab="display" role="tab"><i data-lucide="monitor"></i> Display</button>
                <button class="settings-tab" data-tab="updates" role="tab">
                    <i data-lucide="download-cloud"></i> Updates
                    <span class="update-badge" id="update-badge" style="display:none;">!</span>
                </button>
                <button class="settings-tab" data-tab="troubleshoot" role="tab"><i data-lucide="stethoscope"></i> Diagnostics</button>
                <button class="settings-tab" data-tab="data-management" role="tab"><i data-lucide="database"></i> Data</button>
                <button class="settings-tab" data-tab="sharing" role="tab"><i data-lucide="share-2"></i> Sharing</button>
            </div>
        </div>
        
        <!-- v5.9.3: Redesigned General Tab -->
        <div class="settings-content active-tab" id="settings-general">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="user"></i>
                    <h4>Identity</h4>
                </div>
                <div class="settings-form-group">
                    <label>Default Reviewer Name</label>
                    <input type="text" id="settings-reviewer" class="form-input" placeholder="Enter default reviewer name">
                    <p class="help-text">This name appears in exported reports and scan metadata</p>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="toggle-right"></i>
                    <h4>Behavior</h4>
                </div>
                <div class="settings-toggle">
                    <div class="settings-toggle-info">
                        <span class="toggle-label">Auto-review on file load</span>
                        <span class="toggle-description">Automatically start scanning when a file is selected</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="settings-auto-review">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-toggle">
                    <div class="settings-toggle-info">
                        <span class="toggle-label">Remember checker selections</span>
                        <span class="toggle-description">Persist your enabled/disabled checkers across sessions</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="settings-remember-checks" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-toggle">
                    <div class="settings-toggle-info">
                        <span class="toggle-label">Show help guide &amp; tours</span>
                        <span class="toggle-description">Enable the floating help beacon, guided tours, and live demos</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="settings-guide-enabled" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="mail"></i>
                    <h4>Support</h4>
                </div>
                <div class="settings-form-group">
                    <label>Diagnostics Support Email</label>
                    <input type="email" id="settings-diagnostics-email" class="form-input" placeholder="support@example.com" value="Nicholas.georgeson@gmail.com">
                    <p class="help-text">Email address for sending diagnostic reports via Outlook</p>
                </div>
            </div>
        </div>
        
        <!-- v5.9.3: Redesigned Review Tab -->
        <div class="settings-content" id="settings-review">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="book-open"></i>
                    <h4>Style Guide Presets</h4>
                </div>
                <div class="settings-preset-grid">
                    <button class="settings-preset-btn preset-btn" data-preset="microsoft" title="Microsoft Writing Style Guide">
                        <i data-lucide="file-text"></i> Microsoft
                    </button>
                    <button class="settings-preset-btn preset-btn" data-preset="google" title="Google Developer Documentation Style Guide">
                        <i data-lucide="code"></i> Google
                    </button>
                    <button class="settings-preset-btn preset-btn" data-preset="plain_language" title="US Plain Language Guidelines">
                        <i data-lucide="users"></i> Plain Language
                    </button>
                    <button class="settings-preset-btn preset-btn" data-preset="asd_ste100" title="ASD Simplified Technical English">
                        <i data-lucide="plane"></i> ASD-STE100
                    </button>
                    <button class="settings-preset-btn preset-btn" data-preset="government" title="US Government/Federal Style">
                        <i data-lucide="landmark"></i> Government
                    </button>
                    <button class="settings-preset-btn preset-btn" data-preset="aerospace" title="Aerospace/Defense Documentation">
                        <i data-lucide="rocket"></i> Aerospace
                    </button>
                    <button class="settings-preset-btn preset-btn" data-preset="all_checks" title="Enable all checkers">
                        <i data-lucide="check-circle"></i> All Checks
                    </button>
                    <button class="settings-preset-btn preset-btn" data-preset="minimal" title="Basic grammar and spelling only">
                        <i data-lucide="zap"></i> Minimal
                    </button>
                </div>
                <div id="preset-description" class="settings-preset-info" style="display: none;">
                    <span class="preset-name" id="preset-name"></span>
                    <p id="preset-desc" style="margin: 4px 0 0 0;"></p>
                    <span id="preset-checker-count" style="font-size: 11px; color: var(--text-muted);"></span>
                </div>
                <p class="help-text">Select a style guide to automatically configure checkers for that writing style.</p>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="sliders-horizontal"></i>
                    <h4>Writing Thresholds</h4>
                </div>
                <div class="settings-form-group">
                    <label>Max Sentence Length (words)</label>
                    <input type="number" id="settings-max-sentence" class="form-input" value="40" min="20" max="100">
                    <p class="help-text">Sentences exceeding this length will be flagged</p>
                </div>
                <div class="settings-form-group">
                    <label>Passive Voice Threshold</label>
                    <select id="settings-passive-threshold" class="form-input">
                        <option value="strict">Strict - Flag all passive voice</option>
                        <option value="moderate" selected>Moderate - Allow some passive</option>
                        <option value="lenient">Lenient - Only flag excessive use</option>
                    </select>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="scan-text"></i>
                    <h4>Extraction</h4>
                </div>
                <div class="settings-toggle">
                    <div class="settings-toggle-info">
                        <span class="toggle-label">Extract roles and responsibilities</span>
                        <span class="toggle-description">Automatically identify and catalog roles, RACI statements, and organizational references during scans</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="settings-extract-roles" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- v5.9.3: NEW Network & Auth Tab (extracted from Review) -->
        <div class="settings-content" id="settings-network">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="link"></i>
                    <h4>Hyperlink Validation</h4>
                </div>
                <div class="settings-form-group">
                    <label>Validation Mode</label>
                    <select id="settings-hyperlink-mode" class="form-input">
                        <option value="offline">Offline â€” Format validation only (no network access)</option>
                        <option value="validator">Validator â€” Full HTTP check with authentication</option>
                    </select>
                    <p class="help-text">Validator mode supports Windows SSO, CAC/PIV certificates, and proxy servers. Optimized for .mil/.gov sites.</p>
                </div>
                <div class="hyperlink-mode-status" id="hyperlink-mode-status" style="display:none; margin-top: 8px; padding: 8px; border-radius: var(--radius-sm); font-size: 12px;">
                    <i data-lucide="info"></i>
                    <span id="hyperlink-mode-status-text"></span>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="key"></i>
                    <h4>Client Certificates</h4>
                    <span class="card-description">CAC/PIV authentication</span>
                </div>
                <div class="settings-form-group">
                    <label>Certificate File (.pem)</label>
                    <input type="text" id="settings-client-cert" class="form-input" placeholder="Path to certificate file (.pem)">
                    <p class="help-text">For CAC/PIV authentication to .mil sites. Leave blank for Windows SSO only.</p>
                </div>
                <div class="settings-form-group">
                    <label>Private Key File (.pem)</label>
                    <input type="text" id="settings-client-key" class="form-input" placeholder="Path to private key file (.pem)">
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="shield-check"></i>
                    <h4>SSL &amp; Proxy</h4>
                </div>
                <div class="settings-form-group">
                    <label>CA Certificate Bundle</label>
                    <input type="text" id="settings-ca-bundle" class="form-input" placeholder="Path to CA bundle (.crt or .pem)">
                    <p class="help-text">DoD/Federal PKI root CA bundle for government site validation</p>
                </div>
                <div class="settings-form-group">
                    <label>Proxy Server</label>
                    <input type="text" id="settings-proxy-url" class="form-input" placeholder="http://proxy.corp.mil:8080">
                    <p class="help-text">Enterprise proxy server for network-restricted environments</p>
                </div>
                <div class="settings-toggle">
                    <div class="settings-toggle-info">
                        <span class="toggle-label">Verify SSL certificates</span>
                        <span class="toggle-description">Disable only for testing with self-signed certificates</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="settings-verify-ssl" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-privacy-notice">
                <i data-lucide="info"></i>
                <span>All network traffic stays local to your machine. No data is sent to external servers. Hyperlink validation only checks URL reachability.</span>
            </div>
        </div>

        <!-- v5.9.3: Redesigned Document Profiles Tab -->
        <div class="settings-content" id="settings-profiles">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="file-check"></i>
                    <h4>Document Type Profiles</h4>
                    <span class="card-description">Persist across sessions</span>
                </div>

                <!-- Profile Selector -->
                <div class="settings-profile-pills">
                    <button class="settings-profile-pill profile-btn-settings active" data-profile="prop">PrOP</button>
                    <button class="settings-profile-pill profile-btn-settings" data-profile="pal">PAL</button>
                    <button class="settings-profile-pill profile-btn-settings" data-profile="fgost">FGOST</button>
                    <button class="settings-profile-pill profile-btn-settings" data-profile="sow">SOW</button>
                </div>

                <!-- Profile Description -->
                <div class="settings-preset-info" id="profile-description">
                    <span class="preset-name">PrOP (Procedure Operational)</span> â€” Focus on process clarity and step-by-step instructions.
                </div>
            </div>

            <!-- Checker Selection Grid -->
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="list-checks"></i>
                    <h4>Available Checks</h4>
                </div>
            <div class="checker-grid-container">
                <div class="settings-grid-actions">
                    <button class="btn btn-ghost btn-xs" id="btn-profile-select-all"><i data-lucide="check-square"></i> Select All</button>
                    <button class="btn btn-ghost btn-xs" id="btn-profile-clear-all"><i data-lucide="square"></i> Clear All</button>
                    <button class="btn btn-ghost btn-xs" id="btn-profile-reset-default"><i data-lucide="rotate-ccw"></i> Reset Default</button>
                </div>

                <div class="settings-checker-grid" id="profile-checker-grid">
                    <!-- Writing Quality -->
                    <div class="settings-checker-category">
                        <h5>Writing Quality</h5>
                        <label class="checker-option"><input type="checkbox" data-check="passive_voice"> Passive Voice</label>
                        <label class="checker-option"><input type="checkbox" data-check="enhanced_passive"> Enhanced Passive (NLP)</label>
                        <label class="checker-option"><input type="checkbox" data-check="weak_language"> Weak Language</label>
                        <label class="checker-option"><input type="checkbox" data-check="wordy_phrases"> Wordy Phrases</label>
                        <label class="checker-option"><input type="checkbox" data-check="nominalization"> Nominalization</label>
                        <label class="checker-option"><input type="checkbox" data-check="jargon"> Jargon</label>
                        <label class="checker-option"><input type="checkbox" data-check="sentence_length"> Sentence Length</label>
                        <label class="checker-option"><input type="checkbox" data-check="repeated_words"> Repeated Words</label>
                        <label class="checker-option"><input type="checkbox" data-check="fragments_v2"> Sentence Fragments</label>
                    </div>

                    <!-- Grammar & Spelling -->
                    <div class="settings-checker-category">
                        <h5>Grammar &amp; Spelling</h5>
                        <label class="checker-option"><input type="checkbox" data-check="spelling"> Spelling</label>
                        <label class="checker-option"><input type="checkbox" data-check="grammar"> Grammar</label>
                        <label class="checker-option"><input type="checkbox" data-check="punctuation"> Punctuation</label>
                        <label class="checker-option"><input type="checkbox" data-check="capitalization"> Capitalization</label>
                        <label class="checker-option"><input type="checkbox" data-check="contractions"> Contractions</label>
                        <label class="checker-option"><input type="checkbox" data-check="contraction_consistency"> Contraction Consistency</label>
                        <label class="checker-option"><input type="checkbox" data-check="oxford_comma"> Oxford Comma</label>
                    </div>

                    <!-- Technical Writing -->
                    <div class="settings-checker-category">
                        <h5>Technical Writing</h5>
                        <label class="checker-option"><input type="checkbox" data-check="acronyms"> Acronyms</label>
                        <label class="checker-option"><input type="checkbox" data-check="acronym_first_use"> Acronym First Use</label>
                        <label class="checker-option"><input type="checkbox" data-check="acronym_multiple_definition"> Multiple Definitions</label>
                        <label class="checker-option"><input type="checkbox" data-check="requirements_language"> Requirements Language</label>
                        <label class="checker-option"><input type="checkbox" data-check="requirements_analysis"> Requirements Analysis</label>
                        <label class="checker-option"><input type="checkbox" data-check="tbd"> TBD/TBR Items</label>
                        <label class="checker-option"><input type="checkbox" data-check="testability"> Testability</label>
                        <label class="checker-option"><input type="checkbox" data-check="atomicity"> Atomicity</label>
                        <label class="checker-option"><input type="checkbox" data-check="escape_clauses"> Escape Clauses</label>
                        <label class="checker-option"><input type="checkbox" data-check="terminology_consistency"> Terminology Consistency</label>
                        <label class="checker-option"><input type="checkbox" data-check="technical_dictionary"> Technical Dictionary</label>
                    </div>

                    <!-- Clarity -->
                    <div class="settings-checker-category">
                        <h5>Clarity</h5>
                        <label class="checker-option"><input type="checkbox" data-check="ambiguous_pronouns"> Ambiguous Pronouns</label>
                        <label class="checker-option"><input type="checkbox" data-check="hedging"> Hedging</label>
                        <label class="checker-option"><input type="checkbox" data-check="weasel_words"> Weasel Words</label>
                        <label class="checker-option"><input type="checkbox" data-check="cliches"> Cliches</label>
                        <label class="checker-option"><input type="checkbox" data-check="redundancy"> Redundancy</label>
                        <label class="checker-option"><input type="checkbox" data-check="future_tense"> Future Tense</label>
                        <label class="checker-option"><input type="checkbox" data-check="latin_abbreviations"> Latin Abbreviations</label>
                        <label class="checker-option"><input type="checkbox" data-check="sentence_initial_conjunction"> Initial Conjunctions</label>
                        <label class="checker-option"><input type="checkbox" data-check="directional_language"> Directional Language</label>
                        <label class="checker-option"><input type="checkbox" data-check="time_sensitive_language"> Time-Sensitive Language</label>
                    </div>

                    <!-- Readability -->
                    <div class="settings-checker-category">
                        <h5>Readability</h5>
                        <label class="checker-option"><input type="checkbox" data-check="ari"> ARI Score</label>
                        <label class="checker-option"><input type="checkbox" data-check="spache"> Spache Readability</label>
                        <label class="checker-option"><input type="checkbox" data-check="dale_chall"> Dale-Chall</label>
                        <label class="checker-option"><input type="checkbox" data-check="text_statistics"> Text Statistics</label>
                        <label class="checker-option"><input type="checkbox" data-check="prose_linting"> Prose Linting</label>
                        <label class="checker-option"><input type="checkbox" data-check="semantic_analysis"> Semantic Analysis</label>
                    </div>

                    <!-- Procedural Writing -->
                    <div class="settings-checker-category">
                        <h5>Procedural Writing</h5>
                        <label class="checker-option"><input type="checkbox" data-check="imperative_mood"> Imperative Mood</label>
                        <label class="checker-option"><input type="checkbox" data-check="second_person"> Second Person (You)</label>
                        <label class="checker-option"><input type="checkbox" data-check="numbered_list_sequence"> List Sequence</label>
                        <label class="checker-option"><input type="checkbox" data-check="link_text_quality"> Link Text Quality</label>
                    </div>

                    <!-- Document Structure -->
                    <div class="settings-checker-category">
                        <h5>Document Structure</h5>
                        <label class="checker-option"><input type="checkbox" data-check="document_structure"> Document Structure</label>
                        <label class="checker-option"><input type="checkbox" data-check="structure_analysis"> Structure Analysis</label>
                        <label class="checker-option"><input type="checkbox" data-check="heading_case"> Heading Case</label>
                        <label class="checker-option"><input type="checkbox" data-check="references"> References</label>
                        <label class="checker-option"><input type="checkbox" data-check="cross_references"> Cross-References</label>
                        <label class="checker-option"><input type="checkbox" data-check="cross_reference_targets"> Reference Targets</label>
                        <label class="checker-option"><input type="checkbox" data-check="hyperlinks"> Hyperlinks</label>
                        <label class="checker-option"><input type="checkbox" data-check="tables_figures"> Tables & Figures</label>
                        <label class="checker-option"><input type="checkbox" data-check="lists"> Lists</label>
                        <label class="checker-option"><input type="checkbox" data-check="orphan_headings"> Orphan Headings</label>
                        <label class="checker-option"><input type="checkbox" data-check="empty_sections"> Empty Sections</label>
                    </div>

                    <!-- Product & Code -->
                    <div class="settings-checker-category">
                        <h5>Product &amp; Code</h5>
                        <label class="checker-option"><input type="checkbox" data-check="product_name_consistency"> Product Names</label>
                        <label class="checker-option"><input type="checkbox" data-check="code_formatting"> Code Formatting</label>
                        <label class="checker-option"><input type="checkbox" data-check="enhanced_acronyms"> Enhanced Acronyms</label>
                    </div>

                    <!-- Standards & Compliance -->
                    <div class="settings-checker-category">
                        <h5>Standards &amp; Compliance</h5>
                        <label class="checker-option"><input type="checkbox" data-check="mil_std"> MIL-STD</label>
                        <label class="checker-option"><input type="checkbox" data-check="mil_std_40051"> MIL-STD-40051</label>
                        <label class="checker-option"><input type="checkbox" data-check="do178"> DO-178</label>
                        <label class="checker-option"><input type="checkbox" data-check="s1000d"> S1000D</label>
                        <label class="checker-option"><input type="checkbox" data-check="as9100"> AS9100</label>
                        <label class="checker-option"><input type="checkbox" data-check="accessibility"> Accessibility</label>
                        <label class="checker-option"><input type="checkbox" data-check="gender_language"> Gender Language</label>
                    </div>

                    <!-- Other -->
                    <div class="settings-checker-category">
                        <h5>Other</h5>
                        <label class="checker-option"><input type="checkbox" data-check="roles"> Roles</label>
                        <label class="checker-option"><input type="checkbox" data-check="units"> Units</label>
                        <label class="checker-option"><input type="checkbox" data-check="terminology"> Terminology</label>
                        <label class="checker-option"><input type="checkbox" data-check="consistency"> Consistency</label>
                    </div>
                </div>
            </div>
            </div>

            <!-- Save Status -->
            <div class="profile-save-status" id="profile-save-status" style="display: none;">
                <i data-lucide="check-circle"></i>
                <span>Profile saved</span>
            </div>
        </div>

        <!-- v5.9.3: Redesigned Sharing Tab -->
        <div class="settings-content" id="settings-sharing">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="folder-sync"></i>
                    <h4>Dictionary Location</h4>
                </div>
                <div class="settings-form-group">
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="dict-location" id="dict-location-local" value="local" checked>
                            <span>Local (app folder only)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="dict-location" id="dict-location-shared" value="shared">
                            <span>Shared Drive / Network Folder</span>
                        </label>
                    </div>
                </div>
                <div class="settings-form-group shared-path-group" id="shared-path-group" style="display:none;">
                    <label for="settings-shared-path">Shared Folder Path</label>
                    <div class="input-with-button">
                        <input type="text" id="settings-shared-path" class="form-input"
                               placeholder="\\\\server\\share\\twr or S:\\Team\\TechWriter">
                        <button class="btn btn-secondary" id="btn-browse-shared" title="Browse...">
                            <i data-lucide="folder"></i>
                        </button>
                        <button class="btn btn-secondary" id="btn-test-shared" title="Test Connection">
                            <i data-lucide="wifi"></i>
                        </button>
                    </div>
                    <p class="help-text">Enter a UNC path (\\\\server\\share) or mapped drive path (S:\\folder)</p>
                    <div class="path-status" id="shared-path-status" style="display:none;">
                        <i data-lucide="check-circle"></i>
                        <span id="shared-path-status-text">Connection status will appear here</span>
                    </div>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="activity"></i>
                    <h4>Connection Status</h4>
                </div>
                <div class="settings-sharing-status" id="settings-sharing-status">
                    <div class="settings-sharing-status-item">
                        <span class="status-dot ok"></span>
                        <span>Local DB: <strong id="status-local-db">Checking...</strong></span>
                    </div>
                    <div class="settings-sharing-status-item">
                        <span class="status-dot warn"></span>
                        <span>Master: <strong id="status-master-file">Checking...</strong></span>
                    </div>
                    <div class="settings-sharing-status-item">
                        <span class="status-dot error"></span>
                        <span>Shared: <strong id="status-shared-location">Not configured</strong></span>
                    </div>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="upload"></i>
                    <h4>Import Roles Package</h4>
                </div>
                <p class="help-text" style="margin-bottom: 12px;">Import a .aegis-roles package received from a team member</p>
                <div class="settings-actions-row">
                    <input type="file" id="import-roles-package" accept=".aegis-roles,.json" style="display:none;">
                    <button class="btn btn-secondary" id="btn-import-roles-package">
                        <i data-lucide="upload"></i> Import Package
                    </button>
                    <span id="import-package-status" class="help-text"></span>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="info"></i>
                    <h4>How Team Sharing Works</h4>
                </div>
                <div class="settings-info-grid">
                    <div class="settings-info-item">
                        <i data-lucide="hard-drive"></i>
                        <div><strong>Local Mode</strong>Dictionary stored in your app folder only</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="cloud"></i>
                        <div><strong>Shared Mode</strong>Dictionary syncs from a network location</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="users"></i>
                        <div><strong>Team Sync</strong>All members point to the same shared folder</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="package"></i>
                        <div><strong>Offline Sharing</strong>Use .aegis-roles packages via email</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- v5.9.3: Redesigned Display Tab -->
        <div class="settings-content" id="settings-display">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="layout-grid"></i>
                    <h4>Interface</h4>
                </div>
                <div class="settings-toggle">
                    <div class="settings-toggle-info">
                        <span class="toggle-label">Essentials mode</span>
                        <span class="toggle-description">Hide advanced features (Statement Forge, Roles, Triage, Families, Analytics) for a simpler interface</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="settings-essentials-mode">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-toggle">
                    <div class="settings-toggle-info">
                        <span class="toggle-label">Compact mode</span>
                        <span class="toggle-description">Denser issue list with smaller row heights</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="settings-compact-mode">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-toggle">
                    <div class="settings-toggle-info">
                        <span class="toggle-label">Expand analytics by default</span>
                        <span class="toggle-description">Show charts and statistics panel expanded after each scan</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="settings-show-charts">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="list"></i>
                    <h4>Pagination</h4>
                </div>
                <div class="settings-form-group">
                    <label>Issues Per Page</label>
                    <select id="settings-page-size" class="form-input">
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                        <option value="all">All (no pagination)</option>
                    </select>
                    <p class="help-text">Controls how many review issues are shown per page in the results table</p>
                </div>
            </div>
        </div>
        
        <!-- v5.9.3: Redesigned Updates Tab -->
        <div class="settings-content" id="settings-updates">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="download-cloud"></i>
                    <h4>Update Status</h4>
                </div>
                <div class="settings-update-status" id="update-status-content">
                    <div class="update-checking" id="update-checking" style="display:none;">
                        <div class="spinner-small"></div>
                        <span>Checking for updates...</span>
                    </div>
                    <div class="no-updates" id="no-updates">
                        <div class="update-message">
                            <i data-lucide="check-circle" style="color: #22c55e;"></i>
                            <span>You're up to date. Place update files in the <code>updates</code> folder to apply them.</span>
                        </div>
                    </div>
                    <div class="updates-available" id="updates-available" style="display:none;">
                        <div class="update-summary">
                            <span class="update-count" id="update-count">0</span> update(s) available
                        </div>
                        <div class="update-list" id="update-list"></div>
                        <div class="settings-toggle" style="margin-top: 12px;">
                            <div class="settings-toggle-info">
                                <span class="toggle-label">Create backup before updating</span>
                                <span class="toggle-description">Recommended â€” allows rollback if issues occur</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="update-create-backup" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="update-result" id="update-result" style="display:none;">
                        <div class="result-icon"></div>
                        <div class="result-message"></div>
                    </div>
                </div>
                <div class="settings-actions-row" style="margin-top: 12px;">
                    <button class="btn btn-secondary" id="btn-check-updates">
                        <i data-lucide="refresh-cw"></i> Check for Updates
                    </button>
                    <button class="btn btn-primary" id="btn-apply-updates" style="display:none;">
                        <i data-lucide="download"></i> Apply Updates
                    </button>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="archive"></i>
                    <h4>Backups</h4>
                </div>
                <div class="settings-backup-list" id="backup-list">
                    <p class="help-text">Loading backups...</p>
                </div>
                <div class="settings-actions-row">
                    <button class="btn btn-secondary" id="btn-load-backups">
                        <i data-lucide="refresh-cw"></i> Refresh
                    </button>
                    <button class="btn btn-warning" id="btn-rollback" disabled>
                        <i data-lucide="rotate-ccw"></i> Rollback to Latest
                    </button>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="info"></i>
                    <h4>How to Update</h4>
                </div>
                <div class="settings-info-grid">
                    <div class="settings-info-item">
                        <i data-lucide="folder-plus"></i>
                        <div><strong>Step 1</strong>Extract update package to the <code>updates</code> folder</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="search"></i>
                        <div><strong>Step 2</strong>Click "Check for Updates" above</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="check-circle"></i>
                        <div><strong>Step 3</strong>Review changes and click "Apply"</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="refresh-cw"></i>
                        <div><strong>Step 4</strong>Server restarts automatically</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- v5.9.3: Redesigned Diagnostics Tab -->
        <div class="settings-content" id="settings-troubleshoot">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="stethoscope"></i>
                    <h4>Diagnostic Summary</h4>
                </div>
                <div class="settings-diag-stats" id="diagnostic-summary">
                    <div class="settings-diag-stat errors">
                        <div class="stat-value" id="diag-error-count">0</div>
                        <div class="stat-label">Errors</div>
                    </div>
                    <div class="settings-diag-stat warnings">
                        <div class="stat-value" id="diag-warning-count">0</div>
                        <div class="stat-label">Warnings</div>
                    </div>
                    <div class="settings-diag-stat">
                        <div class="stat-value" id="diag-request-count">0</div>
                        <div class="stat-label">Requests</div>
                    </div>
                </div>
                <div class="settings-actions-row">
                    <button class="btn btn-secondary" id="btn-diag-refresh" title="Refresh diagnostic summary">
                        <i data-lucide="refresh-cw"></i> Refresh Stats
                    </button>
                    <button class="btn btn-primary" id="btn-diag-export-json" title="Export diagnostics as JSON">
                        <i data-lucide="download"></i> Export JSON
                    </button>
                    <button class="btn btn-secondary" id="btn-diag-export-txt" title="Export diagnostics as text">
                        <i data-lucide="file-text"></i> Export Text
                    </button>
                    <button class="btn btn-secondary" id="btn-diag-email" title="Email diagnostics via Outlook">
                        <i data-lucide="mail"></i> Email to Support
                    </button>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="heart-pulse"></i>
                    <h4>Dependency Health Check</h4>
                </div>
                <p class="help-text" style="margin-bottom: 12px;">Verify all Python packages, NLP models, and system dependencies are installed and working.</p>
                <div class="settings-actions-row">
                    <button class="btn btn-secondary" id="btn-diag-health-check" title="Check dependencies">
                        <i data-lucide="heart-pulse"></i> Run Health Check
                    </button>
                </div>
                <div class="settings-health-results" id="health-check-results">
                    <div id="health-check-content"></div>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="file-search"></i>
                    <h4>What's Included in Exports</h4>
                </div>
                <div class="settings-info-grid">
                    <div class="settings-info-item">
                        <i data-lucide="cpu"></i>
                        <div><strong>System Info</strong>App version, Python, platform</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="alert-circle"></i>
                        <div><strong>Error Tracking</strong>Recent errors, stack traces</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="package"></i>
                        <div><strong>Module Status</strong>Packages, features, database</div>
                    </div>
                    <div class="settings-info-item">
                        <i data-lucide="terminal"></i>
                        <div><strong>Browser Logs</strong>Console messages, JS errors</div>
                    </div>
                </div>
            </div>

            <div class="settings-privacy-notice">
                <i data-lucide="shield-check"></i>
                <span><strong>Privacy Protected</strong> â€” All exports are automatically sanitized. Email addresses, file paths with usernames, API tokens, and IP addresses are redacted. No document content is included.</span>
            </div>
        </div>

        <!-- v5.9.3: Redesigned Data Management Tab -->
        <div class="settings-content" id="settings-data-management">
            <div class="settings-card">
                <div class="settings-card-header">
                    <i data-lucide="database"></i>
                    <h4>Stored Data</h4>
                </div>
                <div class="settings-data-item">
                    <div class="settings-data-item-info">
                        <span class="item-name"><i data-lucide="history" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Scan History</span>
                        <span class="item-count" id="scan-history-count">Loading...</span>
                    </div>
                    <button class="btn-danger" id="btn-clear-scan-history">
                        <i data-lucide="trash-2"></i> Clear
                    </button>
                </div>
                <div class="settings-data-item">
                    <div class="settings-data-item-info">
                        <span class="item-name"><i data-lucide="file-text" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Statement Data</span>
                        <span class="item-count" id="statement-data-count">Loading...</span>
                    </div>
                    <button class="btn-danger" id="btn-clear-statements">
                        <i data-lucide="trash-2"></i> Clear
                    </button>
                </div>
                <div class="settings-data-item">
                    <div class="settings-data-item-info">
                        <span class="item-name"><i data-lucide="users" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Role Dictionary</span>
                        <span class="item-count" id="role-dictionary-count">Loading...</span>
                    </div>
                    <button class="btn-danger" id="btn-clear-role-dictionary">
                        <i data-lucide="trash-2"></i> Clear
                    </button>
                </div>
                <div class="settings-data-item">
                    <div class="settings-data-item-info">
                        <span class="item-name"><i data-lucide="brain" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Learning Data</span>
                        <span class="item-count" id="learning-data-count">Loading...</span>
                    </div>
                    <button class="btn-danger" id="btn-clear-learning-data">
                        <i data-lucide="trash-2"></i> Clear
                    </button>
                </div>
            </div>

            <div class="settings-danger-zone">
                <div class="settings-card-header">
                    <i data-lucide="alert-triangle"></i>
                    <h4>Factory Reset</h4>
                </div>
                <div class="settings-factory-reset">
                    <p>This will permanently delete <strong>ALL</strong> user data including scan history, role dictionaries, learning data, and preferences. This action cannot be undone.</p>
                    <button class="btn-factory-reset" id="btn-factory-reset">
                        <i data-lucide="refresh-ccw"></i> Factory Reset
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-secondary modal-close">Cancel</button>
        <button class="btn btn-primary" id="btn-save-settings">Save Settings</button>
    </div>
    </div>
</div>

<!-- Help Modal - Comprehensive Documentation -->
<!-- Help Modal - Comprehensive Documentation System v2.9.6 -->
<div class="modal modal-fullscreen" id="modal-help" role="dialog" aria-modal="true" aria-labelledby="help-title">
    <div class="modal-content help-modal-content">
        <div class="modal-header help-modal-header">
            <h3 id="help-title"><i data-lucide="book-open"></i> Help & Documentation</h3>
            <div class="help-header-actions">
                <!-- v2.9.6: Added search functionality (#55) -->
                <div class="help-search-container">
                    <i data-lucide="search" aria-hidden="true"></i>
                    <input type="text" id="help-search-input" class="help-search-input" placeholder="Search help..." autocomplete="off" aria-label="Search help documentation">
                </div>
                <button class="btn btn-ghost" id="btn-help-print" title="Print this section" aria-label="Print help section"><i data-lucide="printer" aria-hidden="true"></i></button>
                <button class="btn btn-ghost modal-close" aria-label="Close help modal"><i data-lucide="x" aria-hidden="true"></i></button>
            </div>
        </div>
        <div class="modal-body help-modal-body">
            <!-- Sidebar Navigation - v2.9.6: Now dynamically built from HelpDocs.navigation -->
            <nav class="help-sidebar">
                <!-- Navigation will be built dynamically by HelpContent.buildNavigation() -->
                <!-- Fallback static content below will be replaced on init -->
                <div class="help-nav-section">
                    <div class="help-nav-title">Getting Started</div>
                    <button class="help-tab active" data-tab="quick-start"><i data-lucide="zap" aria-hidden="true"></i> Quick Start</button>
                    <button class="help-tab" data-tab="first-review"><i data-lucide="play-circle" aria-hidden="true"></i> First Review</button>
                    <button class="help-tab" data-tab="interface-tour"><i data-lucide="layout" aria-hidden="true"></i> Interface Tour</button>
                </div>
                <div class="help-nav-section">
                    <div class="help-nav-title">Document Review</div>
                    <button class="help-tab" data-tab="loading-docs"><i data-lucide="upload" aria-hidden="true"></i> Loading Documents</button>
                    <button class="help-tab" data-tab="review-types"><i data-lucide="sliders" aria-hidden="true"></i> Review Types</button>
                    <button class="help-tab" data-tab="understanding-results"><i data-lucide="bar-chart-2" aria-hidden="true"></i> Understanding Results</button>
                </div>
                <div class="help-nav-section">
                    <div class="help-nav-title">Quality Checkers</div>
                    <button class="help-tab" data-tab="checker-acronyms"><i data-lucide="a-large-small" aria-hidden="true"></i> Acronyms</button>
                    <button class="help-tab" data-tab="checker-grammar"><i data-lucide="spell-check" aria-hidden="true"></i> Grammar</button>
                    <button class="help-tab" data-tab="checker-hyperlinks"><i data-lucide="link" aria-hidden="true"></i> Hyperlinks</button>
                    <button class="help-tab" data-tab="checker-requirements"><i data-lucide="list-checks" aria-hidden="true"></i> Requirements</button>
                    <button class="help-tab" data-tab="checker-all"><i data-lucide="list" aria-hidden="true"></i> All Checkers</button>
                </div>
                <div class="help-nav-section">
                    <div class="help-nav-title">Roles & Statement Forge</div>
                    <button class="help-tab" data-tab="role-detection"><i data-lucide="users" aria-hidden="true"></i> Role Detection</button>
                    <button class="help-tab" data-tab="role-matrix"><i data-lucide="grid-3x3" aria-hidden="true"></i> RACI Matrix</button>
                    <button class="help-tab" data-tab="forge-overview"><i data-lucide="hammer" aria-hidden="true"></i> Statement Forge</button>
                </div>
                <div class="help-nav-section">
                    <div class="help-nav-title">Reference</div>
                    <button class="help-tab" data-tab="shortcuts"><i data-lucide="keyboard" aria-hidden="true"></i> Shortcuts</button>
                    <button class="help-tab" data-tab="trouble-common"><i data-lucide="wrench" aria-hidden="true"></i> Troubleshooting</button>
                    <button class="help-tab" data-tab="version-history"><i data-lucide="history" aria-hidden="true"></i> Version History</button>
                    <button class="help-tab" data-tab="about"><i data-lucide="info" aria-hidden="true"></i> About</button>
                </div>
                <div class="help-nav-footer">
                    <span class="help-version" id="help-version"></span>
                    <span class="help-credit">Nicholas Georgeson</span>
                </div>
            </nav>
            
            <!-- Main Content Area - v2.9.6: Content rendered dynamically by HelpContent -->
            <main class="help-main">
                <!-- v2.9.6: Content rendered dynamically by HelpContent.renderSection() -->
                <!-- Initial loading placeholder -->
                <div class="help-section" id="help-loading">
                    <h1>Loading Help...</h1>
                    <p>Please wait while help content loads.</p>
                </div>
            </main>
        </div>
    </div>
</div>

<!-- Issue Detail Modal -->
<div class="modal modal-lg" id="modal-issue-detail">
    <div class="modal-content">
        <div class="modal-header">
        <h3><i data-lucide="alert-circle" aria-hidden="true"></i> Issue Details</h3>
        <button class="btn btn-ghost modal-close" aria-label="Close issue details modal"><i data-lucide="x" aria-hidden="true"></i></button>
    </div>
    <div class="modal-body">
        <div class="issue-detail">
            <div class="detail-header">
                <span id="detail-severity" class="severity-badge"></span>
                <span id="detail-category" class="category-badge"></span>
            </div>
            <div class="detail-section">
                <label>Issue</label>
                <p id="detail-message" class="detail-message"></p>
            </div>
            <div class="detail-section" id="detail-flagged-section">
                <label>Flagged Text</label>
                <code id="detail-flagged" class="detail-code"></code>
            </div>
            <div class="detail-section" id="detail-suggestion-section">
                <label>Suggestion</label>
                <p id="detail-suggestion" class="detail-suggestion"></p>
            </div>
            <div class="detail-section">
                <label>Paragraph Context</label>
                <p id="detail-paragraph" class="paragraph-preview"></p>
            </div>
            <div class="detail-section detail-location">
                <label>Location</label>
                <span><i data-lucide="map-pin"></i> Paragraph <span id="detail-para-num">--</span></span>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-prev-issue" aria-label="Show previous issue"><i data-lucide="chevron-left" aria-hidden="true"></i> Previous</button>
        <button class="btn btn-secondary" id="btn-next-issue" aria-label="Show next issue">Next <i data-lucide="chevron-right" aria-hidden="true"></i></button>
        <button class="btn btn-primary modal-close" aria-label="Close triage modal">Close</button>
    </div>
    </div>
</div>

<!-- Roles Report Modal - v2.9.7: Sidebar Navigation -->
<div class="modal modal-fullscreen" id="modal-roles" role="dialog" aria-modal="true" aria-labelledby="modal-roles-title">
    <div class="modal-content roles-modal-content">
        <div class="modal-header roles-modal-header">
            <h3 id="modal-roles-title"><i data-lucide="users"></i> Roles & Responsibilities Studio</h3>
            <div class="roles-header-actions">
                <!-- v2.9.7: Search functionality for roles -->
                <div class="roles-search-container">
                    <i data-lucide="search" aria-hidden="true"></i>
                    <input type="text" id="roles-global-search" class="roles-search-input" placeholder="Search roles..." autocomplete="off" aria-label="Search roles by name">
                </div>
                <!-- v3.0.98: Document filter dropdown -->
                <div class="roles-document-filter">
                    <span class="roles-document-filter-label">Filter by Document:</span>
                    <select id="roles-document-filter" class="form-select" title="Filter roles by source document" aria-label="Filter roles by document">
                        <option value="all">All Documents</option>
                        <!-- Populated dynamically -->
                    </select>
                </div>
                <!-- v3.0.80: Export dropdown with All/Selected options -->
                <div class="dropdown" id="roles-export-dropdown">
                    <button class="btn btn-ghost" id="btn-export-roles-report" title="Export Roles">
                        <i data-lucide="download"></i>
                        <i data-lucide="chevron-down" style="width:12px;height:12px;margin-left:2px;"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" id="roles-export-menu">
                        <button class="dropdown-item" id="btn-export-all-csv">
                            <i data-lucide="file-spreadsheet"></i> Export All Roles (CSV)
                        </button>
                        <button class="dropdown-item" id="btn-export-current-csv">
                            <i data-lucide="file-text"></i> Export Current Document (CSV)
                        </button>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item" id="btn-export-all-json">
                            <i data-lucide="braces"></i> Export All Roles (JSON)
                        </button>
                        <button class="dropdown-item" id="btn-export-selected-doc-csv">
                            <i data-lucide="file-check"></i> Export Selected Document...
                        </button>
                    </div>
                </div>
                <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
            </div>
        </div>
        <div class="modal-body roles-modal-body">
            <!-- v2.9.7: Sidebar Navigation (matching help modal pattern) -->
            <nav class="roles-sidebar" role="tablist">
                <div class="roles-nav-section">
                    <div class="roles-nav-title">Analysis</div>
                    <button class="roles-nav-item active" data-tab="overview" role="tab" aria-selected="true" aria-controls="roles-overview" id="tab-overview">
                        <i data-lucide="layout-dashboard" aria-hidden="true"></i> Overview
                    </button>
                    <button class="roles-nav-item" data-tab="graph" role="tab" aria-selected="false" aria-controls="roles-graph" id="tab-graph">
                        <i data-lucide="git-branch" aria-hidden="true"></i> Relationship Graph
                    </button>
                    <button class="roles-nav-item" data-tab="details" role="tab" aria-selected="false" aria-controls="roles-details" id="tab-details">
                        <i data-lucide="list" aria-hidden="true"></i> Role Details
                    </button>
                    <button class="roles-nav-item" data-tab="matrix" role="tab" aria-selected="false" aria-controls="roles-matrix" id="tab-matrix">
                        <i data-lucide="grid-3x3" aria-hidden="true"></i> RACI Matrix
                    </button>
                    <button class="roles-nav-item" data-tab="roledocmatrix" role="tab" aria-selected="false" aria-controls="roles-roledocmatrix" id="tab-roledocmatrix">
                        <i data-lucide="table-2" aria-hidden="true"></i> Role-Doc Matrix
                    </button>
                </div>
                <div class="roles-nav-section">
                    <div class="roles-nav-title">Workflow</div>
                    <button class="roles-nav-item" data-tab="adjudication" role="tab" aria-selected="false" aria-controls="roles-adjudication" id="tab-adjudication">
                        <i data-lucide="check-circle" aria-hidden="true"></i> Adjudication
                    </button>
                </div>
                <div class="roles-nav-section">
                    <div class="roles-nav-title">Management</div>
                    <button class="roles-nav-item" data-tab="dictionary" role="tab" aria-selected="false" aria-controls="roles-dictionary" id="tab-dictionary">
                        <i data-lucide="book-open" aria-hidden="true"></i> Role Dictionary
                    </button>
                    <button class="roles-nav-item" data-tab="documents" role="tab" aria-selected="false" aria-controls="roles-documents" id="tab-documents">
                        <i data-lucide="file-text" aria-hidden="true"></i> Document Log
                    </button>
                </div>
                <div class="roles-nav-footer">
                    <div class="roles-stats-mini">
                        <span><strong id="sidebar-roles-count">0</strong> roles</span>
                        <span><strong id="sidebar-resp-count">0</strong> responsibilities</span>
                    </div>
                </div>
            </nav>
            
            <!-- Main Content Area -->
            <main class="roles-main">
            
            <!-- Overview Tab -->
            <div class="roles-section" id="roles-overview" role="tabpanel" aria-labelledby="tab-overview">
                <!-- v4.4 Quick Actions Toolbar -->
                <div class="roles-quick-actions">
                    <button class="btn btn-outline btn-sm" id="btn-overview-reports" onclick="TWR.FunctionTags?.showReportsModal()" title="Generate Reports">
                        <i data-lucide="file-bar-chart"></i> Reports
                    </button>
                    <button class="btn btn-outline btn-sm" id="btn-overview-functions" onclick="TWR.FunctionTags?.showFunctionTagsModal()" title="Manage Function Categories">
                        <i data-lucide="tags"></i> Functions
                    </button>
                </div>

                <!-- v3.4.0: Data Explorer Quick Access -->
                <div class="data-explorer-banner" onclick="TWR.DataExplorer?.open()" style="background: linear-gradient(135deg, rgba(74,144,217,0.15), rgba(99,102,241,0.15)); border: 1px solid rgba(74,144,217,0.3); border-radius: 12px; padding: 16px 20px; margin-bottom: 16px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">ðŸ”</span>
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">Data Explorer</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Click any stat below to drill down, or click here for the full interactive experience</div>
                        </div>
                    </div>
                    <span style="color: var(--accent); font-size: 20px;">â†’</span>
                </div>

                <div class="roles-summary-grid">
                    <div class="roles-summary-card roles-card-clickable" onclick="TWR.DataExplorer?.open('roles')" title="Click to explore all roles in detail" style="cursor: pointer;">
                        <div class="summary-icon"><i data-lucide="users"></i></div>
                        <div class="summary-value" id="total-roles-count">0</div>
                        <div class="summary-label">Unique Roles</div>
                        <div id="adjudicated-subtitle" style="font-size: 10px; color: #22c55e; margin-top: 2px; display: none;">âœ“ <span id="adjudicated-subtitle-text"></span></div>
                        <div class="summary-hint" style="font-size: 10px; color: var(--accent); margin-top: 4px; opacity: 0; transition: opacity 0.2s;">Click to explore â†’</div>
                    </div>
                    <div class="roles-summary-card roles-card-clickable" onclick="TWR.DataExplorer?.open('mentions')" title="Click to see how responsibilities are calculated" style="cursor: pointer;">
                        <div class="summary-icon"><i data-lucide="list-checks"></i></div>
                        <div class="summary-value" id="total-responsibilities-count">0</div>
                        <div class="summary-label">Responsibilities</div>
                        <div class="summary-hint" style="font-size: 10px; color: var(--accent); margin-top: 4px; opacity: 0; transition: opacity 0.2s;">Click to explore â†’</div>
                    </div>
                    <div class="roles-summary-card roles-card-clickable" onclick="TWR.DataExplorer?.open('documents')" title="Click to view all analyzed documents" style="cursor: pointer;">
                        <div class="summary-icon"><i data-lucide="file-text"></i></div>
                        <div class="summary-value" id="total-documents-count">1</div>
                        <div class="summary-label">Documents Analyzed</div>
                        <div class="summary-hint" style="font-size: 10px; color: var(--accent); margin-top: 4px; opacity: 0; transition: opacity 0.2s;">Click to explore â†’</div>
                    </div>
                    <div class="roles-summary-card roles-card-clickable" onclick="TWR.DataExplorer?.open('interactions')" title="Click to explore role relationships" style="cursor: pointer;">
                        <div class="summary-icon"><i data-lucide="git-branch"></i></div>
                        <div class="summary-value" id="total-interactions-count">0</div>
                        <div class="summary-label">Role Interactions</div>
                        <div class="summary-hint" style="font-size: 10px; color: var(--accent); margin-top: 4px; opacity: 0; transition: opacity 0.2s;">Click to explore â†’</div>
                    </div>
                </div>
                
                <!-- v3.0.12: Entity audit info bar -->
                <div class="entity-audit-bar" id="entity-audit-bar" style="display: none;">
                    <i data-lucide="info"></i>
                    <span id="entity-audit-text">Export will include 0 roles</span>
                </div>
                
                <div class="roles-chart-container">
                    <h4>Responsibility Distribution</h4>
                    <div class="roles-bar-chart" id="roles-distribution-chart">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                
                <div class="roles-top-list">
                    <h4>Top Roles by Responsibility Count</h4>
                    <div id="top-roles-list">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                <!-- v4.7.0: Container for dynamic overview rendering from roles.js -->
                <div id="roles-overview-content"></div>
            </div>

            <!-- Graph Tab -->
            <div class="roles-section" id="roles-graph" style="display:none;" role="tabpanel" aria-labelledby="tab-graph">
                <!-- v4.4 Quick Actions Toolbar -->
                <div class="roles-quick-actions" style="margin-bottom: 8px;">
                    <button class="btn btn-outline btn-sm" onclick="TWR.FunctionTags?.showReportsModal()" title="Generate Reports">
                        <i data-lucide="file-bar-chart"></i> Reports
                    </button>
                    <button class="btn btn-outline btn-sm" onclick="TWR.FunctionTags?.showFunctionTagsModal()" title="Manage Function Categories">
                        <i data-lucide="tags"></i> Functions
                    </button>
                    <div class="graph-export-wrapper" style="position:relative;display:inline-block">
                        <button class="btn btn-outline btn-sm" id="btn-graph-export" title="Export Graph">
                            <i data-lucide="download"></i> Export
                        </button>
                        <div class="graph-export-menu" id="graph-export-menu" style="display:none">
                            <button class="graph-export-option" data-format="png"><i data-lucide="image"></i> PNG (High-Res)</button>
                            <button class="graph-export-option" data-format="svg"><i data-lucide="code"></i> SVG (Vector)</button>
                            <button class="graph-export-option" data-format="html"><i data-lucide="globe"></i> Interactive HTML</button>
                        </div>
                    </div>
                </div>

                <!-- Live Stats Bar -->
                <div class="graph-stats-bar" id="graph-stats-bar">
                    <span class="graph-stat"><strong id="graph-node-count">0</strong> Nodes</span>
                    <span class="graph-stat"><strong id="graph-link-count">0</strong> Links</span>
                    <span class="graph-stat"><strong id="graph-visible-links">0</strong> Visible</span>
                    <span class="graph-stat">Threshold: <strong id="graph-threshold">1</strong></span>
                    <span class="graph-stat">Max: <strong id="graph-max-weight">--</strong></span>
                </div>

                <!-- v4.5.2: Prominent layout switcher -->
                <div class="graph-layout-switcher" id="graph-layout-switcher">
                    <span class="layout-switcher-label">View:</span>
                    <button class="layout-btn active" data-layout="heb" title="Hierarchical Edge Bundling">
                        <i data-lucide="circle-dot"></i>
                        <span>Edge Bundling</span>
                    </button>
                    <button class="layout-btn" data-layout="semantic-zoom" title="Semantic Zoom (clusters)">
                        <i data-lucide="scan"></i>
                        <span>Semantic Zoom</span>
                    </button>
                    <button class="layout-btn" data-layout="force" title="Force-Directed Graph">
                        <i data-lucide="share-2"></i>
                        <span>Force-Directed</span>
                    </button>
                    <button class="layout-btn" data-layout="bipartite" title="Bipartite (Roles vs Documents)">
                        <i data-lucide="columns"></i>
                        <span>Bipartite</span>
                    </button>
                </div>

                <div class="graph-controls">
                    <div class="graph-control-group">
                        <label for="graph-search">Search:</label>
                        <input type="text" id="graph-search" class="form-input" placeholder="Highlight nodes...">
                        <span id="graph-search-count" class="search-count"></span>
                    </div>
                    <div class="graph-control-group slider-group">
                        <label for="graph-weight-filter">Min. Weight:</label>
                        <input type="range" id="graph-weight-filter" min="1" max="20" value="1" disabled>
                        <span id="graph-weight-value">1</span>
                        <span class="slider-loading" id="slider-loading">Loading...</span>
                    </div>
                    <div class="graph-control-group">
                        <label for="graph-max-nodes">Max Nodes:</label>
                        <select id="graph-max-nodes" class="form-select">
                            <option value="50">50 nodes</option>
                            <option value="100" selected>100 nodes</option>
                            <option value="200">200 nodes</option>
                            <option value="500">500 nodes (slower)</option>
                        </select>
                    </div>
                    <div class="graph-control-group">
                        <label for="graph-layout">Layout:</label>
                        <select id="graph-layout" class="form-select">
                            <option value="heb" selected>Edge Bundling</option>
                            <option value="semantic-zoom">Semantic Zoom</option>
                            <option value="force">Force-Directed (Classic)</option>
                            <option value="bipartite">Bipartite (Roles | Docs)</option>
                        </select>
                    </div>
                    <div class="graph-control-group slider-group" id="bundling-tension-group">
                        <label for="graph-bundling">Bundling:</label>
                        <input type="range" id="graph-bundling" min="0" max="100" value="85" step="1">
                        <span id="graph-bundling-value">0.85</span>
                    </div>
                    <div class="graph-control-group">
                        <label for="graph-labels">Labels:</label>
                        <select id="graph-labels" class="form-select">
                            <option value="selected" selected>Selected Only</option>
                            <option value="hover">On Hover</option>
                            <option value="all">All (slower)</option>
                            <option value="none">None</option>
                        </select>
                    </div>
                    <div class="graph-control-buttons">
                        <button class="btn btn-secondary btn-sm" id="btn-clear-graph-selection" title="Clear selection">
                            <i data-lucide="x-circle"></i> Clear
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-reset-graph-view" title="Reset zoom and pan">
                            <i data-lucide="maximize-2"></i> Reset
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-refresh-graph" title="Reload graph data">
                            <i data-lucide="refresh-cw"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- v3.0.77: Enhanced Self-Explanatory Legend -->
                <div class="graph-first-time-hint" id="graph-first-time-hint">
                    <i data-lucide="mouse-pointer-click"></i>
                    <span><strong>Tip:</strong> Hover nodes to highlight connections. Click to drill down. Adjust bundling slider for clarity.</span>
                    <span class="dismiss-hint" onclick="this.parentElement.style.display='none'" title="Dismiss">âœ•</span>
                </div>
                
                <div class="graph-legend" id="graph-legend-force">
                    <!-- Node Types -->
                    <span class="legend-item"><span class="legend-dot role-dot"></span> Role</span>
                    <span class="legend-item"><span class="legend-dot doc-dot"></span> Document</span>
                    <span class="legend-item"><span class="legend-dot deliverable-dot"></span> Deliverable</span>
                    <span class="legend-item"><span class="legend-dot system-dot"></span> System/Tool</span>
                    <span class="legend-item"><span class="legend-dot org-dot"></span> Organization</span>
                    <span class="legend-divider">|</span>

                    <!-- Node Size Explanation -->
                    <span class="legend-item" title="Larger nodes = more mentions">
                        <span class="legend-visual-example">
                            <span class="legend-node-small" style="background:#4A90D9"></span>
                            <span style="margin:0 2px">â†’</span>
                            <span class="legend-node-large" style="background:#4A90D9"></span>
                        </span>
                        Size = mentions
                    </span>
                    <span class="legend-divider">|</span>

                    <!-- Line Types -->
                    <span class="legend-item" title="Solid line: Role appears in Document">
                        <span class="legend-line-solid"></span> In document
                    </span>
                    <span class="legend-item" title="Dashed line: Roles appear together in same document(s)">
                        <span class="legend-line-dashed"></span> Co-occur
                    </span>
                    <span class="legend-divider">|</span>

                    <!-- Line Thickness -->
                    <span class="legend-item" title="Thicker lines = stronger connection">
                        <span class="legend-visual-example">
                            <span class="legend-line-thin"></span>
                            <span style="margin:0 2px">â†’</span>
                            <span class="legend-line-thick"></span>
                        </span>
                        Thickness = strength
                    </span>
                    <span class="legend-divider">|</span>

                    <!-- Connection Strength -->
                    <span class="legend-item" title="Dashed border = few connections">
                        <span class="legend-node-weak"></span> Weak
                    </span>
                    <span class="legend-item" title="Solid fill = many connections">
                        <span class="legend-node-strong"></span> Strong
                    </span>
                </div>

                <!-- v4.5.1: HEB Legend (shown when layout is edge-bundling or semantic-zoom) -->
                <div class="graph-legend graph-legend-heb" id="graph-legend-heb" style="display:none;">
                    <span class="legend-item"><span class="legend-dot role-dot"></span> Role</span>
                    <span class="legend-item"><span class="legend-dot doc-dot"></span> Document</span>
                    <span class="legend-divider">|</span>
                    <span class="legend-item" title="Colored arc = document group">
                        <span class="legend-arc-sample"></span> Document group
                    </span>
                    <span class="legend-item" title="Bundled curves = shared relationships">
                        <span class="legend-curve-sample"></span> Bundled edge
                    </span>
                    <span class="legend-divider">|</span>
                    <span class="legend-item" title="Larger nodes = more mentions">
                        <span class="legend-visual-example">
                            <span class="legend-node-small" style="background:#4A90D9"></span>
                            <span style="margin:0 2px">â†’</span>
                            <span class="legend-node-large" style="background:#4A90D9"></span>
                        </span>
                        Size = mentions
                    </span>
                    <span class="legend-divider">|</span>
                    <span class="legend-item" title="Edge brightness = connection strength">
                        <span class="legend-visual-example">
                            <span class="legend-line-dim"></span>
                            <span style="margin:0 2px">â†’</span>
                            <span class="legend-line-bright"></span>
                        </span>
                        Brightness = strength
                    </span>
                </div>
                
                <!-- v4.0.2: Graph Layout with Side Panel -->
                <div class="graph-layout-container">
                    <!-- D3 Graph Container -->
                    <div class="graph-container" id="roles-graph-container">
                        <!-- v4.0.2: Performance notice dynamically added by JS only when needed -->

                        <svg id="roles-graph-svg" width="100%" height="500"></svg>
                        <div class="graph-loading" id="graph-loading" style="display:none;">
                            <i data-lucide="loader" class="spin"></i> Loading graph...
                        </div>

                        <!-- BATCH E3: Link Legend (v2.9.0) -->
                        <div class="graph-link-legend" id="graph-link-legend">
                            <span class="legend-title">Link Types:</span>
                            <div class="link-legend-item">
                                <span class="link-legend-line solid"></span>
                                <span>Role-Document</span>
                            </div>
                            <div class="link-legend-item">
                                <span class="link-legend-line dashed"></span>
                                <span>Role-Deliverable</span>
                            </div>
                            <div class="link-legend-item">
                                <span class="link-legend-line dotted"></span>
                                <span>Coordination</span>
                            </div>
                        </div>

                        <!-- Fallback Table (when D3 unavailable) -->
                        <div class="graph-fallback" id="graph-fallback" style="display:none;">
                            <p class="fallback-notice">
                                <i data-lucide="alert-triangle"></i>
                                Graph visualization unavailable. Showing table view instead.
                            </p>
                            <div class="fallback-controls">
                                <input type="text" id="fallback-role-search" class="form-input" placeholder="Filter by role...">
                                <input type="text" id="fallback-doc-search" class="form-input" placeholder="Filter by document...">
                                <select id="fallback-sort" class="form-select">
                                    <option value="weight-desc">Weight (High â†’ Low)</option>
                                    <option value="weight-asc">Weight (Low â†’ High)</option>
                                    <option value="role-asc">Role (A â†’ Z)</option>
                                    <option value="doc-asc">Document (A â†’ Z)</option>
                                </select>
                                <label class="checkbox-label fallback-checkbox">
                                    <input type="checkbox" id="fallback-match-selection">
                                    <span>Match graph selection</span>
                                </label>
                            </div>
                            <div class="fallback-table-container">
                                <table class="data-table" id="graph-fallback-table">
                                    <thead>
                                        <tr>
                                            <th class="sortable-col" data-sort="role">Role <i data-lucide="chevron-up" class="sort-icon"></i></th>
                                            <th class="sortable-col" data-sort="doc">Document <i data-lucide="chevron-up" class="sort-icon"></i></th>
                                            <th class="sortable-col" data-sort="weight">Mentions <i data-lucide="chevron-up" class="sort-icon"></i></th>
                                            <th>Top Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="graph-fallback-body">
                                        <!-- Populated dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Graph Help Tooltip (shows on help button click) -->
                        <div class="graph-help-popup" id="graph-help-popup" style="display:none;">
                            <div class="help-popup-header">
                                <strong>Graph Interactions</strong>
                                <button class="btn btn-ghost btn-xs" id="btn-close-graph-help" aria-label="Close help">
                                    <i data-lucide="x"></i>
                                </button>
                            </div>
                            <ul class="help-popup-list">
                                <li><strong>Click Role</strong> â†’ Highlight connected documents, show role details</li>
                                <li><strong>Click Document</strong> â†’ Highlight roles found in it, show document info</li>
                                <li><strong>Pin Button</strong> â†’ Keep selection highlighted while exploring</li>
                                <li><strong>Drag Node</strong> â†’ Reposition node</li>
                                <li><strong>Scroll</strong> â†’ Zoom in/out</li>
                                <li><strong>Click Background</strong> â†’ Clear selection (unless pinned)</li>
                                <li><strong>Search Box</strong> â†’ Highlight matching nodes</li>
                                <li><strong>Tab + Enter</strong> â†’ Navigate and select with keyboard</li>
                            </ul>
                        </div>
                    </div><!-- End graph-container -->

                    <!-- v4.0.2: Enhanced Node Details Side Panel -->
                    <div class="graph-details-panel" id="graph-info-panel">
                        <!-- Toggle tab on the left edge -->
                        <button class="panel-toggle-tab" id="btn-toggle-info-panel" title="Hide panel">
                            <i data-lucide="chevron-right"></i>
                        </button>
                        <div class="details-panel-content">
                            <div class="details-panel-header">
                                <div class="details-panel-title-row">
                                    <div class="details-panel-icon" id="details-panel-icon">
                                        <i data-lucide="user"></i>
                                    </div>
                                    <div class="details-panel-title-group">
                                        <h3 id="info-panel-title">Select a Node</h3>
                                        <span class="details-panel-subtitle" id="details-panel-subtitle">Click any node to view details</span>
                                    </div>
                                </div>
                            </div>
                            <div class="details-panel-body" id="info-panel-body">
                            <div class="details-empty-state">
                                <div class="details-empty-icon">
                                    <i data-lucide="mouse-pointer-click"></i>
                                </div>
                                <p>Click on any node in the graph to see detailed information about roles, documents, and their connections.</p>
                            </div>
                        </div>
                        </div><!-- End details-panel-content -->
                    </div>
                </div><!-- End graph-layout-container -->
            </div>
            
            <!-- Details Tab -->
            <div class="roles-section" id="roles-details" style="display:none;" role="tabpanel" aria-labelledby="tab-details">
                <div class="roles-filter-bar">
                    <input type="text" id="roles-search" class="form-input" placeholder="Search roles...">
                    <select id="roles-sort" class="form-select">
                        <option value="count-desc">Most Responsibilities</option>
                        <option value="count-asc">Least Responsibilities</option>
                        <option value="alpha">Alphabetical</option>
                    </select>
                </div>
                <div class="roles-report" id="roles-report-content">
                    <!-- Populated dynamically -->
                </div>
            </div>
            
            <!-- Matrix Tab - v2.9.7: Interactive RACI Matrix -->
            <div class="roles-section" id="roles-matrix" style="display:none;" role="tabpanel" aria-labelledby="tab-matrix">
                <div class="raci-header">
                    <h4><i data-lucide="grid-3x3"></i> RACI Responsibility Matrix</h4>
                    <p class="help-text">Click cells to edit RACI assignments. R=Responsible, A=Accountable, C=Consulted, I=Informed.</p>
                </div>
                
                <div class="raci-toolbar">
                    <div class="raci-controls-left">
                        <label class="checkbox-label">
                            <input type="checkbox" id="matrix-filter-critical">
                            <span>Show only R/A roles</span>
                        </label>
                        <select id="matrix-sort" class="form-select" style="width:auto;">
                            <option value="frequency">Sort by Frequency</option>
                            <option value="alpha">Sort Alphabetically</option>
                        </select>
                        <!-- v4.5.2: Dictionary filter -->
                        <select id="matrix-dict-filter" class="form-select" style="width:auto;" title="Filter by dictionary status">
                            <option value="all">All Roles</option>
                            <option value="dictionary">Dictionary Only</option>
                            <option value="discovered">Discovered Only</option>
                        </select>
                    </div>
                    <div class="raci-controls-right">
                        <button class="btn btn-secondary btn-sm" id="btn-raci-reset" title="Reset to detected values">
                            <i data-lucide="rotate-ccw"></i> Reset
                        </button>
                        <div class="raci-export-wrapper">
                            <button class="btn btn-secondary btn-sm" id="btn-raci-export" title="Export RACI matrix to CSV">
                                <i data-lucide="download"></i> Export CSV <i data-lucide="chevron-down" class="raci-export-chevron"></i>
                            </button>
                            <div class="raci-export-menu" id="raci-export-menu"></div>
                        </div>
                    </div>
                </div>
                
                <div class="raci-matrix-info">
                    <i data-lucide="info"></i>
                    <span>Values show action verb counts from document. Click any cell to override.</span>
                </div>
                
                <div class="responsibility-matrix" id="responsibility-matrix">
                    <!-- Populated dynamically with interactive cells -->
                </div>
                
                <div class="raci-legend-bar">
                    <span class="raci-legend-item" title="Responsible â€” performs the work"><span class="raci-legend-icon raci-r">R</span>Responsible</span>
                    <span class="raci-legend-item" title="Accountable â€” approves / owns"><span class="raci-legend-icon raci-a">A</span>Accountable</span>
                    <span class="raci-legend-item" title="Consulted â€” advises / reviews"><span class="raci-legend-icon raci-c">C</span>Consulted</span>
                    <span class="raci-legend-item" title="Informed â€” kept up to date"><span class="raci-legend-icon raci-i">I</span>Informed</span>
                    <span class="raci-legend-divider"></span>
                    <span class="raci-legend-item" title="Role exists in the Role Dictionary"><span class="raci-legend-badge raci-dict-badge">D</span>Dictionary</span>
                    <span class="raci-legend-item" title="Role has been adjudicated and confirmed"><span class="raci-legend-badge adj-badge adj-confirmed">âœ“</span>Confirmed</span>
                    <span class="raci-legend-item" title="Role is an adjudicated deliverable"><span class="raci-legend-badge adj-badge adj-deliverable">â˜…</span>Deliverable</span>
                    <span class="raci-legend-item" title="Role has been adjudicated and rejected"><span class="raci-legend-badge adj-badge adj-rejected">âœ—</span>Rejected</span>
                    <span class="raci-legend-item" title="Number of documents containing this role"><span class="raci-legend-badge raci-doc-count-icon">n</span>Docs</span>
                </div>
            </div>
            
            <!-- Role-Document Matrix Tab - v3.0.97: Cross-document role mapping -->
            <div class="roles-section" id="roles-roledocmatrix" style="display:none;" role="tabpanel" aria-labelledby="tab-roledocmatrix">
                <div class="roledoc-header">
                    <h4><i data-lucide="table-2"></i> Role-Document Matrix</h4>
                    <p class="help-text">Cross-reference showing which roles appear in which documents. âœ“ indicates the role was found in that document.</p>
                </div>
                
                <div class="roledoc-toolbar">
                    <div class="roledoc-controls-left">
                        <label class="checkbox-label">
                            <input type="checkbox" id="roledoc-show-counts">
                            <span>Show mention counts</span>
                        </label>
                    </div>
                    <div class="roledoc-controls-right">
                        <button class="btn btn-secondary btn-sm" id="btn-roledoc-refresh" title="Refresh matrix data">
                            <i data-lucide="refresh-cw"></i> Refresh
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-roledoc-export-csv" title="Export to CSV">
                            <i data-lucide="download"></i> CSV
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-roledoc-export-excel" title="Export to Excel">
                            <i data-lucide="file-spreadsheet"></i> Excel
                        </button>
                    </div>
                </div>
                
                <div class="roledoc-matrix-info">
                    <i data-lucide="info"></i>
                    <span>This matrix aggregates role data from all scanned documents in your history. Scan multiple documents to see cross-document patterns.</span>
                </div>
                
                <div class="roledoc-matrix-container" id="roledoc-matrix-container">
                    <p class="text-muted">Loading matrix data...</p>
                </div>
                
                <p class="roledoc-empty" id="roledoc-empty" style="display:none;">
                    No cross-document role data available. Scan at least two documents to see role-document relationships.
                </p>
            </div>
            
            <!-- Role Adjudication Tab - v4.0.3: Complete overhaul with dashboard, kanban, auto-classify -->
            <div class="roles-section" id="roles-adjudication" style="display:none;" role="tabpanel" aria-labelledby="tab-adjudication">
                <!-- Dashboard Header -->
                <div class="adj-dashboard">
                    <div class="adj-dashboard-left">
                        <h4><i data-lucide="shield-check"></i> Role Adjudication</h4>
                        <p class="help-text">Review, classify, and validate extracted roles. Confirmed roles improve future scans. Rejected roles are excluded automatically.</p>
                    </div>
                    <div class="adj-dashboard-right">
                        <div class="adj-progress-ring" id="adj-progress-ring"></div>
                        <div class="adj-stat-cards">
                            <div class="adj-stat-card adj-stat-pending" data-filter="pending" title="Click to filter pending">
                                <span class="adj-stat-count" id="adj-pending-count">0</span>
                                <span class="adj-stat-label">Pending</span>
                            </div>
                            <div class="adj-stat-card adj-stat-confirmed" data-filter="confirmed" title="Click to filter confirmed">
                                <span class="adj-stat-count" id="adj-confirmed-count">0</span>
                                <span class="adj-stat-label">Confirmed</span>
                            </div>
                            <div class="adj-stat-card adj-stat-deliverable" data-filter="deliverable" title="Click to filter deliverables">
                                <span class="adj-stat-count" id="adj-deliverable-count">0</span>
                                <span class="adj-stat-label">Deliverables</span>
                            </div>
                            <div class="adj-stat-card adj-stat-rejected" data-filter="rejected" title="Click to filter rejected">
                                <span class="adj-stat-count" id="adj-rejected-count">0</span>
                                <span class="adj-stat-label">Rejected</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Toolbar -->
                <div class="adj-toolbar">
                    <div class="adj-toolbar-left">
                        <label class="adj-select-all-label" title="Select all visible">
                            <input type="checkbox" id="adj-select-all">
                        </label>
                        <select id="adj-filter" class="form-select adj-filter-select">
                            <option value="all" selected>All Items</option>
                            <option value="pending">Pending Review</option>
                            <option value="confirmed">Confirmed Roles</option>
                            <option value="deliverable">Deliverables</option>
                            <option value="rejected">Rejected</option>
                            <option value="low-confidence">Low Confidence (&lt;70%)</option>
                            <option value="has-tags">Has Function Tags</option>
                            <option value="no-tags">No Function Tags</option>
                        </select>
                        <div class="adj-search-wrapper">
                            <i data-lucide="search" class="adj-search-icon"></i>
                            <input type="text" id="adj-search" class="form-input adj-search-input" placeholder="Search roles...">
                        </div>
                        <!-- Bulk Actions -->
                        <div class="adj-bulk-actions" id="adj-bulk-actions" style="display:none;">
                            <span class="adj-bulk-divider"></span>
                            <span class="adj-bulk-label" id="adj-selection-info"><strong id="adj-selected-count">0</strong> selected</span>
                            <button class="btn btn-sm adj-bulk-btn adj-bulk-confirm" id="btn-bulk-confirm" title="Confirm all selected as roles">
                                <i data-lucide="user-check"></i> Confirm
                            </button>
                            <button class="btn btn-sm adj-bulk-btn adj-bulk-deliverable" id="btn-bulk-deliverable" title="Mark all selected as deliverables">
                                <i data-lucide="package"></i> Deliverable
                            </button>
                            <button class="btn btn-sm adj-bulk-btn adj-bulk-reject" id="btn-bulk-reject" title="Reject all selected">
                                <i data-lucide="x-circle"></i> Reject
                            </button>
                            <button class="btn btn-sm btn-ghost" id="btn-bulk-pending" title="Reset selected to pending">
                                <i data-lucide="clock"></i>
                            </button>
                        </div>
                    </div>
                    <div class="adj-toolbar-right">
                        <div class="adj-view-toggle" id="adj-view-toggle">
                            <button class="adj-view-btn active" data-view="list" title="List View">
                                <i data-lucide="list"></i>
                            </button>
                            <button class="adj-view-btn" data-view="kanban" title="Board View">
                                <i data-lucide="columns-3"></i>
                            </button>
                        </div>
                        <button id="btn-auto-adjudicate" class="btn btn-sm btn-secondary adj-auto-btn" title="Auto-classify roles using patterns and history">
                            <i data-lucide="sparkles"></i> Auto-Classify
                        </button>
                        <button id="btn-undo-adj" class="btn btn-sm btn-ghost" title="Undo (Ctrl+Z)" disabled>
                            <i data-lucide="undo-2"></i>
                        </button>
                        <button id="btn-redo-adj" class="btn btn-sm btn-ghost" title="Redo (Ctrl+Y)" disabled>
                            <i data-lucide="redo-2"></i>
                        </button>
                        <div class="adj-export-dropdown" id="adj-export-dropdown">
                            <button id="btn-export-adjudication" class="btn btn-sm btn-secondary" title="Export / Import">
                                <i data-lucide="download"></i>
                            </button>
                            <div class="adj-export-menu" id="adj-export-menu" style="display:none;">
                                <button class="adj-export-item" data-action="csv">
                                    <i data-lucide="file-spreadsheet"></i> CSV Spreadsheet
                                </button>
                                <button class="adj-export-item" data-action="html">
                                    <i data-lucide="globe"></i> Interactive HTML Board
                                </button>
                                <button class="adj-export-item" data-action="pdf">
                                    <i data-lucide="file-text"></i> PDF Report
                                </button>
                                <div class="adj-export-divider"></div>
                                <button class="adj-export-item" data-action="import">
                                    <i data-lucide="upload"></i> Import Decisions...
                                </button>
                            </div>
                            <input type="file" id="adj-import-file" accept=".json" style="display:none;">
                        </div>
                        <div class="adj-share-dropdown" id="adj-share-dropdown">
                            <button id="btn-share-adjudication" class="btn btn-sm btn-secondary" title="Share roles">
                                <i data-lucide="share-2"></i>
                            </button>
                            <div class="adj-share-menu" id="adj-share-menu" style="display:none;">
                                <button class="adj-share-item" data-action="shared-folder">
                                    <i data-lucide="folder-sync"></i> Export to Shared Folder
                                </button>
                                <button class="adj-share-item" data-action="email-package">
                                    <i data-lucide="mail"></i> Email Package...
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="adj-content" id="adj-content">
                    <!-- List View -->
                    <div class="adj-list-view" id="adj-list-view">
                        <div class="adjudication-list" id="adjudication-list">
                            <!-- Populated dynamically by renderAdjudication() -->
                        </div>
                    </div>
                    <!-- Kanban View -->
                    <div class="adj-kanban-view" id="adj-kanban-view" style="display:none;">
                        <div class="adj-kanban-column" data-status="pending">
                            <div class="adj-kanban-header">
                                <span class="adj-kanban-dot adj-dot-pending"></span>
                                <span>Pending</span>
                                <span class="adj-kanban-count" id="adj-kanban-pending">0</span>
                            </div>
                            <div class="adj-kanban-cards" id="adj-kanban-cards-pending"></div>
                        </div>
                        <div class="adj-kanban-column" data-status="confirmed">
                            <div class="adj-kanban-header">
                                <span class="adj-kanban-dot adj-dot-confirmed"></span>
                                <span>Confirmed</span>
                                <span class="adj-kanban-count" id="adj-kanban-confirmed">0</span>
                            </div>
                            <div class="adj-kanban-cards" id="adj-kanban-cards-confirmed"></div>
                        </div>
                        <div class="adj-kanban-column" data-status="deliverable">
                            <div class="adj-kanban-header">
                                <span class="adj-kanban-dot adj-dot-deliverable"></span>
                                <span>Deliverables</span>
                                <span class="adj-kanban-count" id="adj-kanban-deliverable">0</span>
                            </div>
                            <div class="adj-kanban-cards" id="adj-kanban-cards-deliverable"></div>
                        </div>
                        <div class="adj-kanban-column" data-status="rejected">
                            <div class="adj-kanban-header">
                                <span class="adj-kanban-dot adj-dot-rejected"></span>
                                <span>Rejected</span>
                                <span class="adj-kanban-count" id="adj-kanban-rejected">0</span>
                            </div>
                            <div class="adj-kanban-cards" id="adj-kanban-cards-rejected"></div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="adj-footer">
                    <button class="btn btn-success" id="btn-save-adjudication">
                        <i data-lucide="save"></i> Save &amp; Apply
                    </button>
                    <button class="btn btn-ghost btn-sm" id="btn-reset-adjudication">
                        <i data-lucide="rotate-ccw"></i> Reset
                    </button>
                    <div class="adj-keyboard-hint">
                        <kbd>C</kbd> Confirm &nbsp;<kbd>D</kbd> Deliverable &nbsp;<kbd>R</kbd> Reject &nbsp;
                        <kbd>&uarr;&darr;</kbd> Navigate &nbsp;<kbd>Space</kbd> Select &nbsp;<kbd>Ctrl+Z</kbd> Undo
                    </div>
                </div>
            </div>
            
            <!-- Role Dictionary Tab -->
            <div class="roles-section" id="roles-dictionary" style="display:none;" role="tabpanel" aria-labelledby="tab-dictionary">
                <div class="dictionary-header">
                    <h4><i data-lucide="book-open"></i> Role Dictionary</h4>
                    <p class="text-muted">Manage known roles used for extraction. Changes affect future scans.</p>
                </div>

                <!-- Dashboard Stats -->
                <div id="dict-dashboard" class="dict-dashboard"></div>

                <div class="dictionary-toolbar">
                    <input type="text" id="dict-search" class="form-input" placeholder="Search dictionary... ( / )" style="width:220px;">
                    <select id="dict-filter-source" class="form-select" style="width:130px;">
                        <option value="">All Sources</option>
                        <option value="builtin">Built-in</option>
                        <option value="manual">Manual</option>
                        <option value="adjudication">Adjudication</option>
                        <option value="upload">Upload</option>
                        <option value="sipoc">SIPOC Import</option>
                    </select>
                    <select id="dict-filter-category" class="form-select" style="width:130px;">
                        <option value="">All Categories</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Management">Management</option>
                        <option value="Leadership">Leadership</option>
                        <option value="Government">Government</option>
                        <option value="Board">Board</option>
                        <option value="Stakeholder">Stakeholder</option>
                        <option value="Custom">Custom</option>
                    </select>
                    <select id="dict-filter-adj-status" class="form-select dict-enhanced-filter" style="width:130px;">
                        <option value="">Adj. Status</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="deliverable">Deliverable</option>
                        <option value="rejected">Rejected</option>
                        <option value="pending">Pending</option>
                    </select>
                    <select id="dict-filter-has-desc" class="form-select dict-enhanced-filter" style="width:120px;">
                        <option value="">Description</option>
                        <option value="yes">Has description</option>
                        <option value="no">No description</option>
                    </select>
                    <select id="dict-filter-has-tags" class="form-select dict-enhanced-filter" style="width:120px;">
                        <option value="">Tags</option>
                        <option value="yes">Has tags</option>
                        <option value="no">No tags</option>
                    </select>
                    <span id="dict-filter-count" class="dict-filter-count"></span>
                    <div style="flex:1;"></div>
                    <div class="dict-view-toggle">
                        <button class="dict-view-btn active" data-view="table" title="Table view (T)" aria-label="Switch to table view"><i data-lucide="list" aria-hidden="true"></i></button>
                        <button class="dict-view-btn" data-view="card" title="Card view (T)" aria-label="Switch to card view"><i data-lucide="layout-grid" aria-hidden="true"></i></button>
                        <button class="dict-view-btn" data-view="hierarchy" title="Inheritance view" aria-label="Switch to hierarchy view"><i data-lucide="git-branch" aria-hidden="true"></i></button>
                    </div>
                    <div class="btn-divider"></div>
                    <div class="btn-group" title="Team Sharing" role="group" aria-label="Team sharing and synchronization">
                        <button class="btn btn-secondary btn-sm" id="btn-sync-dictionary" title="Sync from shared master file" aria-label="Synchronize dictionary from shared master file">
                            <i data-lucide="refresh-cw" aria-hidden="true"></i> Sync
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-download-master" title="Download shareable master file" aria-label="Download and share master dictionary file">
                            <i data-lucide="share-2" aria-hidden="true"></i> Share
                        </button>
                    </div>
                    <div class="btn-divider"></div>
                    <button class="btn btn-secondary btn-sm" id="btn-seed-dictionary" title="Add built-in roles">
                        <i data-lucide="database"></i> Seed Built-in
                    </button>
                    <div class="dict-import-dropdown" style="position:relative;display:inline-block;">
                        <button class="btn btn-secondary btn-sm" id="btn-import-dictionary" title="Import roles from file">
                            <i data-lucide="upload" aria-hidden="true"></i> Import <i data-lucide="chevron-down" style="width:12px;height:12px;margin-left:2px;" aria-hidden="true"></i>
                        </button>
                        <div class="dict-import-menu" id="dict-import-menu" role="menu">
                            <button class="dict-import-option" data-import="csv" role="menuitem"><i data-lucide="file-spreadsheet" aria-hidden="true"></i> Import CSV / Excel</button>
                            <button class="dict-import-option" data-import="sipoc" role="menuitem"><i data-lucide="git-branch" aria-hidden="true"></i> Nimbus SIPOC Import</button>
                        </div>
                    </div>
                    <button class="btn btn-secondary btn-sm" id="btn-export-dictionary" title="Export to CSV" aria-label="Export dictionary to CSV file">
                        <i data-lucide="download" aria-hidden="true"></i> Export CSV
                    </button>
                    <button class="btn btn-secondary btn-sm" id="btn-download-template" title="Download blank template for manual role entry">
                        <i data-lucide="file-plus"></i> Template
                    </button>
                    <button class="btn btn-secondary btn-sm" id="btn-export-hierarchy" title="Export Role Inheritance Map as interactive HTML" style="display:none;">
                        <i data-lucide="git-branch"></i> Export Inheritance Map
                    </button>
                    <button class="btn btn-primary btn-sm" id="btn-add-role">
                        <i data-lucide="plus"></i> Add Role
                    </button>
                    <div class="btn-divider"></div>
                    <button class="btn btn-secondary btn-sm" id="btn-function-tags" onclick="TWR.FunctionTags.showFunctionTagsModal()" title="Manage function categories">
                        <i data-lucide="tags"></i> Functions
                    </button>
                    <button class="btn btn-secondary btn-sm" id="btn-role-reports" onclick="TWR.FunctionTags.showReportsModal()" title="Generate role reports">
                        <i data-lucide="file-text"></i> Reports
                    </button>
                </div>

                <!-- Sharing Info Panel -->
                <div class="dictionary-sharing-info" id="dict-sharing-info">
                    <div class="sharing-status" id="sharing-status">
                        <i data-lucide="info"></i>
                        <span>Dictionary status: <strong id="dict-status-text">Checking...</strong></span>
                    </div>
                </div>

                <!-- Bulk Operations Bar -->
                <div id="dict-bulk-bar" class="dict-bulk-bar" style="display:none;">
                    <span class="dict-bulk-count">0 selected</span>
                    <div class="dict-bulk-actions" role="group" aria-label="Bulk actions for selected roles">
                        <button class="btn btn-sm btn-secondary" data-bulk="activate" aria-label="Activate selected roles"><i data-lucide="eye" aria-hidden="true"></i> Activate</button>
                        <button class="btn btn-sm btn-secondary" data-bulk="deactivate" aria-label="Deactivate selected roles"><i data-lucide="eye-off" aria-hidden="true"></i> Deactivate</button>
                        <button class="btn btn-sm btn-secondary" data-bulk="set-category" aria-label="Set category for selected roles"><i data-lucide="tag" aria-hidden="true"></i> Set Category</button>
                        <button class="btn btn-sm btn-secondary" data-bulk="mark-deliverable" aria-label="Mark selected roles as deliverable"><i data-lucide="star" aria-hidden="true"></i> Mark Deliverable</button>
                        <button class="btn btn-sm btn-secondary" data-bulk="unmark-deliverable" aria-label="Unmark selected roles as deliverable"><i data-lucide="star-off" aria-hidden="true"></i> Unmark Deliverable</button>
                        <button class="btn btn-sm btn-danger" data-bulk="delete" aria-label="Delete selected roles"><i data-lucide="trash-2" aria-hidden="true"></i> Delete</button>
                    </div>
                    <button class="btn btn-ghost btn-xs dict-bulk-clear" onclick="TWR.DictFix.bulkAction('clear')" aria-label="Clear selection"><i data-lucide="x" aria-hidden="true"></i></button>
                </div>

                <!-- Content Area (Table or Card view rendered here) -->
                <div id="dict-content-area" class="dict-content-area"></div>

                <div class="dictionary-empty" id="dict-empty" style="display:none;">
                    <i data-lucide="book-open"></i>
                    <p>No roles in dictionary. Click "Seed Built-in" to add standard roles, or add your own.</p>
                </div>

                <!-- Keyboard Hints -->
                <div class="dict-keyboard-hints">
                    <kbd>â†‘â†“</kbd><kbd>jk</kbd> Navigate &nbsp;
                    <kbd>Space</kbd> Select &nbsp;
                    <kbd>Enter</kbd> Edit &nbsp;
                    <kbd>T</kbd> Toggle View &nbsp;
                    <kbd>/</kbd> Search &nbsp;
                    <kbd>Esc</kbd> Clear
                </div>
            </div>
            
            <!-- Add/Edit Role Modal -->
            <div class="modal" id="edit-role-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="edit-role-title">
                <div class="modal-overlay"></div>
                <div class="modal-container" style="max-width:540px;">
                    <div class="modal-header">
                        <h3 id="edit-role-title">Add Role</h3>
                        <button class="btn btn-ghost" id="btn-close-role-modal" aria-label="Close edit role dialog"><i data-lucide="x" aria-hidden="true"></i></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="edit-role-id">
                        <div class="form-group">
                            <label for="edit-role-name">Role Name *</label>
                            <input type="text" id="edit-role-name" class="form-input" placeholder="e.g., Systems Engineer">
                        </div>
                        <div class="form-group">
                            <label for="edit-role-category">Category</label>
                            <select id="edit-role-category" class="form-select" onchange="TWR.DictFix.handleCategoryChange(this.value)">
                                <option value="Role">Role</option>
                                <option value="Management">Management</option>
                                <option value="Technical">Technical</option>
                                <option value="Organization">Organization</option>
                                <option value="Governance">Governance</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Quality">Quality</option>
                                <option value="Safety">Safety</option>
                                <option value="Operations">Operations</option>
                                <option value="Support">Support</option>
                                <option value="Compliance">Compliance</option>
                                <option value="Procurement">Procurement</option>
                                <option value="Leadership">Leadership</option>
                                <option value="Deliverable">Deliverable</option>
                                <option value="__custom__">+ Add Custom...</option>
                            </select>
                            <div id="edit-role-custom-category" style="display:none;margin-top:6px;">
                                <div style="display:flex;gap:6px;">
                                    <input type="text" id="edit-role-custom-category-input" class="form-input" placeholder="Enter custom category...">
                                    <button class="btn btn-sm btn-primary" onclick="TWR.DictFix.applyCustomCategory()">Apply</button>
                                    <button class="btn btn-sm btn-ghost" onclick="TWR.DictFix.cancelCustomCategory()">Cancel</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Function Tags</label>
                            <div id="edit-role-tags-container" style="display:flex;flex-wrap:wrap;gap:4px;min-height:28px;padding:6px;border:1px solid var(--border-default);border-radius:8px;background:var(--bg-surface);">
                                <span class="text-muted" style="font-size:12px;" id="edit-role-tags-empty">No function tags assigned</span>
                            </div>
                            <div style="margin-top:6px;display:flex;gap:6px;">
                                <select id="edit-role-tag-select" class="form-select" style="flex:1;">
                                    <option value="">Select a function tag...</option>
                                </select>
                                <button class="btn btn-sm btn-secondary" id="btn-add-role-tag" onclick="TWR.DictFix.addFunctionTag()">
                                    <i data-lucide="plus" style="width:14px;height:14px;"></i> Add
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit-role-aliases">Aliases (comma-separated)</label>
                            <input type="text" id="edit-role-aliases" class="form-input" placeholder="e.g., SE, System Engineer">
                        </div>
                        <div class="form-group">
                            <label for="edit-role-description">Description</label>
                            <textarea id="edit-role-description" class="form-textarea" rows="2" placeholder="Optional description"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="edit-role-deliverable">
                                <span>This is a deliverable/work product (not a role)</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="edit-role-notes">Notes</label>
                            <textarea id="edit-role-notes" class="form-textarea" rows="2" placeholder="Optional notes"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="btn-cancel-role">Cancel</button>
                        <button class="btn btn-primary" id="btn-save-role">Save Role</button>
                    </div>
                </div>
            </div>
            
            <!-- Role Detail Card Modal -->
            <div class="modal" id="role-detail-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="role-detail-title">
                <div class="modal-overlay" onclick="document.getElementById('role-detail-modal').style.display='none';document.getElementById('role-detail-modal').classList.remove('active');"></div>
                <div class="modal-content" style="max-width:760px;padding:0;border-radius:var(--radius-xl, 16px);">
                    <div id="role-detail-body">
                        <!-- Dynamically rendered by viewRoleDetail() -->
                    </div>
                </div>
            </div>

            <!-- Import Dictionary Modal -->
            <!-- v2.9.1 D2: Smart Import Wizard (5-step flow) -->
            <div class="modal" id="import-dict-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="import-wizard-title">
                <div class="modal-overlay"></div>
                <div class="modal-container" style="max-width:650px;">
                    <div class="modal-header">
                        <h3 id="import-wizard-title">Import Roles - Step 1 of 5</h3>
                        <button class="btn btn-ghost" id="btn-close-import-modal" aria-label="Close import wizard dialog"><i data-lucide="x" aria-hidden="true"></i></button>
                    </div>
                    <div class="modal-body">
                        <!-- Step 1: Select File -->
                        <div class="import-wizard-step" id="import-step-1">
                            <div class="import-dropzone" id="dict-import-dropzone">
                                <i data-lucide="upload"></i>
                                <p>Drop a file here</p>
                                <p class="text-muted">Supports CSV, JSON, TXT, XLSX</p>
                                <input type="file" id="dict-import-file" accept=".csv,.json,.txt,.xlsx,.xls" style="display:none;">
                            </div>
                            <div class="import-format-help" style="margin-top:16px;">
                                <p><strong>Supported formats:</strong></p>
                                <ul style="margin:8px 0;padding-left:20px;">
                                    <li><strong>CSV:</strong> Columns with role names, categories, aliases</li>
                                    <li><strong>JSON:</strong> Array of role objects or TWR export format</li>
                                    <li><strong>TXT:</strong> One role name per line</li>
                                    <li><strong>XLSX:</strong> Excel with role data (first sheet used)</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Step 2: File Analysis -->
                        <div class="import-wizard-step" id="import-step-2" style="display:none;">
                            <div class="import-analysis-result">
                                <h4><i data-lucide="file-search"></i> File Analysis</h4>
                                <div class="analysis-stats" id="import-analysis-stats">
                                    <!-- Populated dynamically -->
                                </div>
                                <div class="analysis-preview" id="import-analysis-preview" style="max-height:200px;overflow-y:auto;margin-top:12px;">
                                    <!-- Sample data preview -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 3: Column Mapping -->
                        <div class="import-wizard-step" id="import-step-3" style="display:none;">
                            <h4><i data-lucide="columns"></i> Map Columns</h4>
                            <p class="text-muted">Match your file columns to role fields:</p>
                            <div class="column-mapping-grid" id="import-column-mapping">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                        
                        <!-- Step 4: Preview & Confirm -->
                        <div class="import-wizard-step" id="import-step-4" style="display:none;">
                            <h4><i data-lucide="eye"></i> Preview Import</h4>
                            <div class="import-preview-summary" id="import-preview-summary">
                                <!-- Summary of what will be imported -->
                            </div>
                            <div class="import-preview-list" id="import-preview-list" style="max-height:250px;overflow-y:auto;margin-top:12px;">
                                <!-- List of roles to import -->
                            </div>
                            <div class="import-options" style="margin-top:16px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="import-skip-duplicates" checked>
                                    Skip roles already in dictionary
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="import-skip-generic">
                                    Skip generic terms (e.g., "Manager", "Team")
                                </label>
                            </div>
                        </div>
                        
                        <!-- Step 5: Complete -->
                        <div class="import-wizard-step" id="import-step-5" style="display:none;">
                            <div class="import-complete-result" id="import-complete-result">
                                <div class="success-icon" style="text-align:center;margin:20px 0;">
                                    <i data-lucide="check-circle" style="width:64px;height:64px;color:#27AE60;"></i>
                                </div>
                                <h4 style="text-align:center;">Import Complete!</h4>
                                <div id="import-complete-stats" style="text-align:center;margin-top:16px;">
                                    <!-- Final stats -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Progress Indicator -->
                        <div class="import-wizard-progress" style="margin-top:20px;">
                            <div class="progress-steps">
                                <span class="progress-step active" data-step="1">1. Select</span>
                                <span class="progress-step" data-step="2">2. Analyze</span>
                                <span class="progress-step" data-step="3">3. Map</span>
                                <span class="progress-step" data-step="4">4. Preview</span>
                                <span class="progress-step" data-step="5">5. Done</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="justify-content:space-between;">
                        <button class="btn btn-secondary" id="import-wizard-back" style="display:none;">
                            <i data-lucide="arrow-left"></i> Back
                        </button>
                        <div style="display:flex;gap:8px;">
                            <button class="btn btn-secondary" id="import-wizard-cancel">Cancel</button>
                            <button class="btn btn-primary" id="import-wizard-next" disabled>
                                Next <i data-lucide="arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SIPOC Import Modal (v4.1.0) -->
            <div class="modal" id="sipoc-import-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="sipoc-wizard-title">
                <div class="modal-overlay"></div>
                <div class="modal-container" style="max-width:720px;">
                    <div class="modal-header">
                        <h3 id="sipoc-wizard-title"><i data-lucide="git-branch" aria-hidden="true"></i> Nimbus SIPOC Import</h3>
                        <button class="btn btn-ghost" aria-label="Close SIPOC import dialog" onclick="if(window.TWR?.DictFix?.closeSipocModal) TWR.DictFix.closeSipocModal(); else { var m=document.getElementById('sipoc-import-modal'); if(m){m.style.display='none';m.classList.remove('active');} }"><i data-lucide="x" aria-hidden="true"></i></button>
                    </div>
                    <div class="modal-body">
                        <!-- Step 1: Upload -->
                        <div class="sipoc-step" id="sipoc-step-1">
                            <div class="import-dropzone" id="sipoc-dropzone">
                                <i data-lucide="git-branch" style="width:48px;height:48px;color:#D6A84A;"></i>
                                <p><strong>Upload Nimbus SIPOC Export</strong></p>
                                <p class="text-muted">Drag and drop your SIPOC export file here, or click to browse</p>
                                <input type="file" id="sipoc-file-input" accept=".xlsx,.xls" style="display:none;">
                                <label for="sipoc-file-input" class="btn btn-secondary btn-sm" style="margin-top:12px;cursor:pointer;">
                                    <i data-lucide="folder-open"></i> Browse Files
                                </label>
                            </div>
                            <div class="sipoc-upload-info" style="margin-top:12px;padding:12px;background:var(--bg-surface,#f7f7f7);border-radius:8px;">
                                <p style="font-size:13px;color:var(--text-secondary,#666);margin:0;">
                                    <strong>What this imports:</strong> Role hierarchy from the Nimbus process model SIPOC export.
                                    Extracts role names, organizational groups, supervisory relationships, disposition data, and function tags.
                                </p>
                            </div>
                        </div>

                        <!-- Step 2: Preview -->
                        <div class="sipoc-step" id="sipoc-step-2" style="display:none;">
                            <div class="sipoc-preview-loading" id="sipoc-loading" style="text-align:center;padding:40px;">
                                <div class="spinner-border" style="width:40px;height:40px;"></div>
                                <p style="margin-top:12px;">Analyzing SIPOC file...</p>
                            </div>
                            <div id="sipoc-preview-content" style="display:none;">
                                <div class="sipoc-stats-grid" id="sipoc-stats-grid">
                                    <!-- 4 stat cards populated by JS -->
                                </div>
                                <div id="sipoc-fallback-notice">
                                    <!-- Auto-fallback notice if Roles Hierarchy not found -->
                                </div>
                                <div class="sipoc-breakdown" id="sipoc-breakdown" style="margin-top:16px;">
                                    <!-- Disposition / Role Type / Relationship breakdowns -->
                                </div>
                                <div class="sipoc-sample-roles" id="sipoc-sample-roles" style="margin-top:16px;max-height:200px;overflow-y:auto;">
                                    <!-- Sample role list -->
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Options -->
                        <div class="sipoc-step" id="sipoc-step-3" style="display:none;">
                            <h4 style="margin-bottom:12px;"><i data-lucide="settings"></i> Import Options</h4>
                            <p class="text-muted" style="font-size:12px;margin-bottom:12px;">Import will add new roles and update existing ones (upsert). Existing roles not in this SIPOC are preserved.</p>
                            <div class="sipoc-category-select" style="margin-top:8px;">
                                <h5>Function Areas to Import</h5>
                                <p class="text-muted" style="font-size:12px;">Uncheck any function areas you don't want to import</p>
                                <div id="sipoc-org-checkboxes" style="max-height:200px;overflow-y:auto;margin-top:8px;columns:2;column-gap:16px;">
                                    <!-- Populated by JS with checkboxes -->
                                </div>
                                <div style="margin-top:8px;">
                                    <button class="btn btn-ghost btn-xs" onclick="document.querySelectorAll('#sipoc-org-checkboxes input').forEach(c=>c.checked=true);">Select All</button>
                                    <button class="btn btn-ghost btn-xs" onclick="document.querySelectorAll('#sipoc-org-checkboxes input').forEach(c=>c.checked=false);">Deselect All</button>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Progress -->
                        <div class="sipoc-step" id="sipoc-step-4" style="display:none;">
                            <div style="text-align:center;padding:30px;">
                                <div class="spinner-border" style="width:48px;height:48px;border-color:#D6A84A;border-right-color:transparent;"></div>
                                <h4 style="margin-top:16px;">Importing Roles...</h4>
                                <p class="text-muted" id="sipoc-progress-text">Processing role hierarchy data</p>
                                <div class="progress-bar-container" style="margin-top:16px;height:6px;background:#e0e0e0;border-radius:3px;overflow:hidden;">
                                    <div class="progress-bar-fill" id="sipoc-progress-bar" style="height:100%;background:linear-gradient(90deg,#D6A84A,#B8743A);width:0%;transition:width 0.5s;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 5: Complete -->
                        <div class="sipoc-step" id="sipoc-step-5" style="display:none;">
                            <div style="text-align:center;padding:20px;">
                                <div style="width:64px;height:64px;border-radius:50%;background:#10b981;margin:0 auto;display:flex;align-items:center;justify-content:center;">
                                    <i data-lucide="check" style="width:32px;height:32px;color:white;"></i>
                                </div>
                                <h3 style="margin-top:16px;color:#10b981;">Import Complete!</h3>
                                <div id="sipoc-complete-stats" style="margin-top:16px;">
                                    <!-- Final import stats -->
                                </div>
                                <div style="margin-top:20px;display:flex;gap:8px;justify-content:center;">
                                    <button class="btn btn-secondary btn-sm" onclick="if(window.TWR?.DictFix?.closeSipocModal) TWR.DictFix.closeSipocModal(); else { var m=document.getElementById('sipoc-import-modal'); if(m){m.style.display='none';m.classList.remove('active');} } if(window.TWR?.DictFix?.loadDictionary) TWR.DictFix.loadDictionary();">
                                        <i data-lucide="book-open"></i> View Dictionary
                                    </button>
                                    <button class="btn btn-primary btn-sm" id="btn-sipoc-export-hierarchy" style="display:none;">
                                        <i data-lucide="git-branch"></i> Export Inheritance Map
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Step Indicator -->
                        <div class="sipoc-steps-indicator" style="margin-top:20px;">
                            <div class="progress-steps">
                                <span class="progress-step active" data-step="1">1. Upload</span>
                                <span class="progress-step" data-step="2">2. Preview</span>
                                <span class="progress-step" data-step="3">3. Options</span>
                                <span class="progress-step" data-step="4">4. Import</span>
                                <span class="progress-step" data-step="5">5. Done</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="justify-content:space-between;">
                        <button class="btn btn-secondary" id="sipoc-wizard-back" style="display:none;">
                            <i data-lucide="arrow-left"></i> Back
                        </button>
                        <div style="display:flex;gap:8px;">
                            <button class="btn btn-secondary" id="sipoc-wizard-cancel" onclick="if(window.TWR?.DictFix?.closeSipocModal) TWR.DictFix.closeSipocModal(); else { var m=document.getElementById('sipoc-import-modal'); if(m){m.style.display='none';m.classList.remove('active');} }">Cancel</button>
                            <button class="btn btn-primary" id="sipoc-wizard-next" disabled>
                                Next <i data-lucide="arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hierarchy Export Filter Modal (v4.1.0) -->
            <div class="modal" id="hierarchy-export-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="hierarchy-export-title">
                <div class="modal-overlay"></div>
                <div class="modal-container" style="max-width:560px;">
                    <div class="modal-header">
                        <h3 id="hierarchy-export-title"><i data-lucide="git-branch" aria-hidden="true"></i> Export Role Inheritance Map</h3>
                        <button class="btn btn-ghost" aria-label="Close hierarchy export dialog" onclick="var hm=document.getElementById('hierarchy-export-modal'); if(hm){hm.style.display='none';hm.classList.remove('active');}"><i data-lucide="x" aria-hidden="true"></i></button>
                    </div>
                    <div class="modal-body">
                        <p class="text-muted" style="margin-bottom:16px;">Configure which roles to include in the interactive HTML export.</p>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="hier-include-all" checked>
                                <span><strong>Include All Roles</strong> (bypass filters below)</span>
                            </label>
                        </div>

                        <div id="hier-filter-options" style="opacity:0.4;pointer-events:none;">
                            <div class="form-group">
                                <label>Functions</label>
                                <div id="hier-org-checkboxes" style="max-height:250px;overflow-y:auto;border:1px solid var(--border-color,#ddd);border-radius:6px;padding:8px;">
                                    <!-- Populated by JS -->
                                </div>
                                <div style="margin-top:4px;">
                                    <button class="btn btn-ghost btn-xs" onclick="document.querySelectorAll('#hier-org-checkboxes input').forEach(c=>c.checked=true);document.getElementById('hier-org-checkboxes')?.dispatchEvent(new Event('change',{bubbles:true}));">All</button>
                                    <button class="btn btn-ghost btn-xs" onclick="document.querySelectorAll('#hier-org-checkboxes input').forEach(c=>c.checked=false);document.getElementById('hier-org-checkboxes')?.dispatchEvent(new Event('change',{bubbles:true}));">None</button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Disposition</label>
                                <div style="display:flex;gap:12px;flex-wrap:wrap;">
                                    <label class="checkbox-label"><input type="checkbox" class="hier-disp-check" value="Sanctioned" checked> Sanctioned</label>
                                    <label class="checkbox-label"><input type="checkbox" class="hier-disp-check" value="To Be Retired" checked> To Be Retired</label>
                                    <label class="checkbox-label"><input type="checkbox" class="hier-disp-check" value="TBD" checked> TBD</label>
                                </div>
                            </div>

                            <div class="form-group" style="display:flex;gap:16px;">
                                <div>
                                    <label>Baselined</label>
                                    <select id="hier-baselined-filter" class="form-select" style="width:150px;">
                                        <option value="">All</option>
                                        <option value="true">Baselined Only</option>
                                        <option value="false">Non-baselined Only</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="checkbox-label" style="margin-top:24px;">
                                        <input type="checkbox" id="hier-include-tools" checked>
                                        <span>Include Tools</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div id="hier-export-preview" style="margin-top:16px;padding:12px;background:var(--bg-surface,#f7f7f7);border-radius:8px;text-align:center;">
                            <span id="hier-preview-count" style="font-weight:600;">All roles</span> will be included in the export
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="var hm=document.getElementById('hierarchy-export-modal'); if(hm){hm.style.display='none';hm.classList.remove('active');}">Cancel</button>
                        <button class="btn btn-primary" id="btn-confirm-hierarchy-export">
                            <i data-lucide="download"></i> Generate HTML Export
                        </button>
                    </div>
                </div>
            </div>

            <!-- Document Log Tab -->
            <div class="roles-section" id="roles-documents" style="display:none;" role="tabpanel" aria-labelledby="tab-documents">
                <div class="document-log-header">
                    <h4>Documents Contributing to Role Analysis</h4>
                    <div class="document-log-actions">
                        <button class="btn btn-outline btn-sm" onclick="TWR.FunctionTags?.showDocumentTagsModal()" title="Manage Document Tags">
                            <i data-lucide="tags"></i> Manage Tags
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-clear-role-history">
                            <i data-lucide="trash-2"></i> Clear History
                        </button>
                    </div>
                </div>
                <div class="document-log-table">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Document</th>
                                <th>Function</th>
                                <th>Category</th>
                                <th>Analyzed</th>
                                <th>Roles Found</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="document-log-body">
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <p class="document-log-empty" id="document-log-empty" style="display:none;">
                    No documents have been analyzed yet. Scan a document to see role data here.
                </p>
            </div>
            </main><!-- End roles-main -->
        </div>
    </div>
</div>

<!-- Scan History Modal -->
<div class="modal modal-xl" id="modal-scan-history">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="clock"></i> Scan History</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="scan-history-container">
                <div class="scan-history-filters">
                    <input type="text" id="history-search" class="form-input" placeholder="Filter by filename...">
                    <button class="btn btn-secondary" id="btn-refresh-history"><i data-lucide="refresh-cw"></i> Refresh</button>
                </div>
                <div class="scan-history-table">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Document</th>
                                <th>Scan Time</th>
                                <th>Issues</th>
                                <th>Score</th>
                                <th>Grade</th>
                                <th>Stmts</th>
                                <th>Changes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="scan-history-body">
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <p class="scan-history-empty" id="scan-history-empty" style="display:none;">
                    No scan history available. Documents will appear here after you scan them.
                </p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modal-close">Close</button>
        </div>
    </div>
</div>

<!-- Save Profile Modal -->
<div class="modal" id="modal-save-profile" role="dialog" aria-modal="true" aria-labelledby="save-profile-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="save-profile-title"><i data-lucide="bookmark" aria-hidden="true"></i> Save Scan Profile</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close save profile dialog"><i data-lucide="x" aria-hidden="true"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Profile Name</label>
                <input type="text" id="profile-name" class="form-input" placeholder="e.g., Requirements Review, Grammar Focus">
            </div>
            <div class="form-group">
                <label>Description (optional)</label>
                <input type="text" id="profile-description" class="form-input" placeholder="Brief description of this profile">
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="profile-set-default">
                    <span>Set as default profile</span>
                </label>
            </div>
            <div class="profile-preview">
                <p><strong>Current Settings:</strong></p>
                <ul id="profile-settings-preview">
                    <!-- Populated dynamically -->
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close">Cancel</button>
            <button class="btn btn-primary" id="btn-confirm-save-profile"><i data-lucide="save"></i> Save Profile</button>
        </div>
    </div>
</div>

<!-- Diagnostics Export Modal -->
<div class="modal modal-lg" id="modal-diagnostics" role="dialog" aria-modal="true" aria-labelledby="modal-diagnostics-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-diagnostics-title"><i data-lucide="file-text"></i> Export Diagnostics</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="diagnostics-info">
                <!-- v2.9.4.2: Troubleshooting Export - Primary option -->
                <div class="alert alert-success" style="margin-bottom: 16px;">
                    <i data-lucide="bug"></i>
                    <div>
                        <strong>Troubleshooting Export (Recommended)</strong>
                        <p>Export a self-contained diagnostic package with all information needed
                        to identify and resolve issues.</p>
                        <button class="btn btn-success" id="btn-ai-troubleshoot-json" style="margin-top: 8px;">
                            <i data-lucide="download"></i> Export for Troubleshooting
                        </button>
                        <button class="btn btn-ghost btn-sm" id="btn-ai-troubleshoot-txt" style="margin-top: 8px; margin-left: 8px;">
                            Text Format
                        </button>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <i data-lucide="info"></i>
                    <div>
                        <strong>Standard Diagnostic Export</strong>
                        <p>This export contains error logs and system information to help diagnose issues. 
                        <strong>Proprietary content is automatically sanitized</strong> - document text, file paths, 
                        and personal information are redacted or hashed.</p>
                    </div>
                </div>
                
                <div class="diagnostics-summary" id="diagnostics-summary-alt">
                    <div class="diag-stat">
                        <span class="diag-label">Session ID:</span>
                        <span class="diag-value" id="diag-session-id-alt">-</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">Errors Captured:</span>
                        <span class="diag-value" id="diag-error-count-alt">0</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">Warnings:</span>
                        <span class="diag-value" id="diag-warning-count-alt">0</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">Requests Logged:</span>
                        <span class="diag-value" id="diag-request-count-alt">0</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">Console Errors:</span>
                        <span class="diag-value" id="diag-console-count-alt">0</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">User Actions:</span>
                        <span class="diag-value" id="diag-action-count-alt">0</span>
                    </div>
                </div>
                
                <div class="diagnostics-options">
                    <h4>Standard Export Options</h4>
                    <label class="checkbox-label">
                        <input type="checkbox" id="diag-include-system" checked>
                        <span>Include system information (Python version, packages, etc.)</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="diag-include-requests" checked>
                        <span>Include request log (API calls, timing)</span>
                    </label>
                    <div class="form-group" style="margin-top: 12px;">
                        <label>Export Format:</label>
                        <select id="diag-format" class="form-select">
                            <option value="json">JSON (for developers)</option>
                            <option value="txt">Text Report (human readable)</option>
                        </select>
                    </div>
                </div>
                
                <div class="diagnostics-privacy">
                    <h4><i data-lucide="shield"></i> What Gets Sanitized</h4>
                    <ul>
                        <li><strong>File paths:</strong> Middle directories hashed (e.g., C:\Us..._a1b2c3\Documents\...)</li>
                        <li><strong>Document content:</strong> Replaced with [CONTENT:Nchars]</li>
                        <li><strong>Email addresses:</strong> Replaced with [EMAIL]</li>
                        <li><strong>API keys/tokens:</strong> Replaced with [REDACTED]</li>
                        <li><strong>Internal URLs:</strong> Domain hashed, structure preserved</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" id="btn-capture-state" title="Capture current UI state for debugging">
                <i data-lucide="camera"></i> Capture State
            </button>
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-secondary" id="btn-email-diagnostics" title="Open Outlook with diagnostic report">
                <i data-lucide="mail"></i> Email via Outlook
            </button>
            <button class="btn btn-primary" id="btn-export-diagnostics">
                <i data-lucide="download"></i> Export Diagnostics
            </button>
        </div>
    </div>
</div>

<!-- v3.0.111: Statement Forge Fullscreen Modal (Full Parity with Standalone) -->
<div class="modal modal-fullscreen" id="modal-statement-forge" role="dialog" aria-modal="true" aria-labelledby="modal-sf-title">
    <div class="modal-content sf-fullscreen-content">
        <!-- Sidebar -->
        <aside class="sf-sidebar">
            <div class="sf-sidebar-header">
                <div class="sf-logo">
                    <i data-lucide="hammer" style="width:32px;height:32px;color:var(--accent-blue);"></i>
                    <div class="sf-logo-text">
                        <span class="sf-logo-title">Statement Forge</span>
                        <span class="sf-logo-subtitle">v3.0</span>
                    </div>
                </div>
                <button class="btn btn-ghost btn-sm modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
            </div>

            <nav class="sf-sidebar-nav">
                <!-- Document Type Selector -->
                <div class="sf-nav-section">
                    <div class="sf-nav-section-title">DOCUMENT TYPE</div>
                    <div class="sf-doc-type-selector">
                        <label class="sf-radio-card">
                            <input type="radio" name="sfDocType" value="procedures" checked>
                            <div class="sf-radio-card-content">
                                <i data-lucide="file-text"></i>
                                <span>Procedures</span>
                            </div>
                        </label>
                        <label class="sf-radio-card">
                            <input type="radio" name="sfDocType" value="work_instruction">
                            <div class="sf-radio-card-content">
                                <i data-lucide="list-checks"></i>
                                <span>Work Instruction</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Filter by Directive -->
                <div class="sf-nav-section">
                    <div class="sf-nav-section-title">FILTER BY DIRECTIVE</div>
                    <div class="sf-filter-chips">
                        <button class="sf-filter-chip active" data-filter="all"><span class="sf-chip-dot all"></span>All</button>
                        <button class="sf-filter-chip" data-filter="shall"><span class="sf-chip-dot shall"></span>Shall</button>
                        <button class="sf-filter-chip" data-filter="must"><span class="sf-chip-dot must"></span>Must</button>
                        <button class="sf-filter-chip" data-filter="should"><span class="sf-chip-dot should"></span>Should</button>
                        <button class="sf-filter-chip" data-filter="may"><span class="sf-chip-dot may"></span>May</button>
                        <button class="sf-filter-chip" data-filter="will"><span class="sf-chip-dot will"></span>Will</button>
                        <button class="sf-filter-chip" data-filter="process"><span class="sf-chip-dot process"></span>Process</button>
                    </div>
                </div>

                <!-- Statistics Grid -->
                <div class="sf-nav-section">
                    <div class="sf-nav-section-title">STATISTICS</div>
                    <div class="sf-stats-grid">
                        <div class="sf-stat-card">
                            <div class="sf-stat-value" id="sf-stat-total">0</div>
                            <div class="sf-stat-label">Total</div>
                        </div>
                        <div class="sf-stat-card">
                            <div class="sf-stat-value" id="sf-stat-filtered">0</div>
                            <div class="sf-stat-label">Filtered</div>
                        </div>
                        <div class="sf-stat-card">
                            <div class="sf-stat-value" id="sf-stat-sections">0</div>
                            <div class="sf-stat-label">Sections</div>
                        </div>
                        <div class="sf-stat-card">
                            <div class="sf-stat-value" id="sf-stat-selected">0</div>
                            <div class="sf-stat-label">Selected</div>
                        </div>
                    </div>
                </div>

                <!-- Undo History -->
                <div class="sf-nav-section">
                    <div class="sf-nav-section-title">UNDO HISTORY</div>
                    <div class="sf-undo-info">
                        <span id="sf-undo-count">0</span> undo / <span id="sf-redo-count">0</span> redo available
                    </div>
                </div>
            </nav>

            <div class="sf-sidebar-footer">
                <button class="btn btn-ghost btn-sm" id="sf-btn-history" title="Statement History"><i data-lucide="history"></i></button>
                <button class="btn btn-ghost btn-sm" id="sf-btn-help" title="Help (F1)"><i data-lucide="help-circle"></i></button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="sf-main-content">
            <!-- Header with Document Info -->
            <header class="sf-main-header">
                <div class="sf-doc-info">
                    <div class="sf-doc-status" id="sf-doc-status">
                        <span class="sf-status-indicator" id="sf-status-indicator">
                            <i data-lucide="file-x"></i>
                        </span>
                        <span class="sf-status-text" id="sf-status-text">No document</span>
                    </div>
                    <h1 class="sf-doc-title" id="sf-doc-title">No Document Loaded</h1>
                    <p class="sf-doc-subtitle" id="sf-doc-subtitle">Open a document or use current document to begin extraction</p>
                </div>
            </header>

            <!-- Primary Toolbar -->
            <div class="sf-toolbar sf-toolbar-primary">
                <div class="sf-toolbar-group">
                    <label class="btn btn-secondary" for="sf-file-input" title="Open Document (Ctrl+O)">
                        <i data-lucide="folder-open"></i><span>Open</span>
                    </label>
                    <input type="file" id="sf-file-input" accept=".docx,.pdf,.txt,.md" style="display:none;">
                    <button class="btn btn-primary" id="btn-sf-extract" title="Extract Statements">
                        <i data-lucide="zap"></i><span>Extract</span>
                    </button>
                    <div class="sf-export-dropdown">
                        <button class="btn btn-secondary" id="sf-btn-export" disabled title="Export to CSV (Ctrl+S)">
                            <i data-lucide="download"></i><span>Export</span>
                        </button>
                        <div class="sf-dropdown-menu" id="sf-export-menu" style="display:none;">
                            <button class="sf-dropdown-item" data-format="nimbus_csv">CSV (Nimbus Compatible)</button>
                            <button class="sf-dropdown-item" data-format="xlsx">Excel Workbook</button>
                            <button class="sf-dropdown-item" data-format="json">JSON (Full Data)</button>
                            <button class="sf-dropdown-item" data-format="docx">Word Document</button>
                        </div>
                    </div>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost" id="sf-btn-undo" disabled title="Undo (Ctrl+Z)"><i data-lucide="undo-2"></i></button>
                    <button class="btn btn-ghost" id="sf-btn-redo" disabled title="Redo (Ctrl+Y)"><i data-lucide="redo-2"></i></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost" id="sf-btn-expand-all" title="Expand All (Ctrl+E)"><i data-lucide="unfold-vertical"></i><span>Expand</span></button>
                    <button class="btn btn-ghost" id="sf-btn-collapse-all" title="Collapse All (Ctrl+Shift+E)"><i data-lucide="fold-vertical"></i><span>Collapse</span></button>
                </div>
                <div class="sf-toolbar-spacer"></div>
                <div class="sf-search-box">
                    <i data-lucide="search"></i>
                    <input type="text" id="sf-search-input" placeholder="Search statements... (Ctrl+F)">
                    <button class="sf-search-clear" id="sf-search-clear" style="display:none"><i data-lucide="x"></i></button>
                </div>
            </div>

            <!-- Secondary Toolbar -->
            <div class="sf-toolbar sf-toolbar-secondary">
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-add" title="Add Statement (Insert)"><i data-lucide="plus"></i><span>Add</span></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-delete" disabled title="Delete Selected (Delete)"><i data-lucide="trash-2"></i><span>Delete</span></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-merge" disabled title="Merge Selected (Ctrl+M)"><i data-lucide="git-merge"></i><span>Merge</span></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-split" disabled title="Split Statement"><i data-lucide="split"></i><span>Split</span></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-move-up" disabled title="Move Up (Alt+â†‘)"><i data-lucide="chevron-up"></i></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-move-down" disabled title="Move Down (Alt+â†“)"><i data-lucide="chevron-down"></i></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-indent-left" disabled title="Outdent (Alt+â†)"><i data-lucide="arrow-left-to-line"></i></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-indent-right" disabled title="Indent (Alt+â†’)"><i data-lucide="arrow-right-to-line"></i></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-renumber" disabled title="Renumber Statements"><i data-lucide="hash"></i><span>Renumber</span></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-view-source" disabled title="View Source Context (V)"><i data-lucide="eye"></i><span>View Source</span></button>
                </div>
                <div class="sf-toolbar-spacer"></div>
                <div class="sf-selection-info" id="sf-selection-info" style="display:none;">
                    <span id="sf-selection-count">0</span> selected
                </div>
            </div>

            <!-- Content Area with Table -->
            <div class="sf-content-area">
                <div class="sf-table-container">
                    <div class="sf-table-header">
                        <div class="sf-th sf-th-drag"></div>
                        <div class="sf-th sf-th-checkbox"><input type="checkbox" id="sf-select-all" title="Select All (Ctrl+A)"></div>
                        <div class="sf-th sf-th-expand"></div>
                        <div class="sf-th sf-th-number">Number</div>
                        <div class="sf-th sf-th-description">Description</div>
                        <div class="sf-th sf-th-role">Role</div>
                        <div class="sf-th sf-th-directive">Type</div>
                        <div class="sf-th sf-th-level">Lvl</div>
                        <div class="sf-th sf-th-actions"></div>
                    </div>
                    <div class="sf-table-body" id="sf-statements-table">
                        <div class="sf-empty-state" id="sf-empty-state">
                            <div class="sf-empty-icon"><i data-lucide="file-search"></i></div>
                            <h3>No Statements</h3>
                            <p>Open a document and click Extract to begin, or use current document</p>
                            <div class="sf-empty-actions">
                                <label class="btn btn-primary" for="sf-file-input-empty"><i data-lucide="folder-open"></i>Open Document</label>
                                <input type="file" id="sf-file-input-empty" accept=".docx,.pdf,.txt,.md" style="display:none;">
                                <button class="btn btn-secondary" id="sf-btn-use-current" title="Use currently loaded document">
                                    <i data-lucide="file-text"></i>Use Current Document
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shortcuts Bar -->
            <div class="sf-shortcuts-bar">
                <span><kbd>â†‘â†“</kbd> Navigate</span>
                <span><kbd>Space</kbd> Select</span>
                <span><kbd>Enter</kbd> Edit</span>
                <span><kbd>Del</kbd> Delete</span>
                <span><kbd>Alt+â†‘â†“</kbd> Move</span>
                <span><kbd>Alt+â†â†’</kbd> Indent</span>
                <span><kbd>Ctrl+M</kbd> Merge</span>
                <span><kbd>F1</kbd> Help</span>
                <span><kbd>Esc</kbd> Close</span>
            </div>
        </main>

        <!-- Edit Panel (Slides in from right) -->
        <aside class="sf-edit-panel" id="sf-edit-panel">
            <div class="sf-edit-panel-header">
                <h2>Edit Statement</h2>
                <button class="btn btn-ghost" id="sf-btn-close-edit"><i data-lucide="x"></i></button>
            </div>
            <div class="sf-edit-panel-content">
                <div class="form-group">
                    <label>Statement Number</label>
                    <input type="text" id="sf-edit-number" class="form-input" placeholder="e.g., 3.2.1">
                </div>
                <div class="form-group">
                    <label>Title (optional)</label>
                    <input type="text" id="sf-edit-title" class="form-input" placeholder="Section or requirement title">
                </div>
                <div class="form-group">
                    <label>Responsible Role</label>
                    <input type="text" id="sf-edit-role" class="form-input" placeholder="e.g., System Engineer">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="sf-edit-description" class="form-textarea" rows="8" placeholder="The full statement text..."></textarea>
                </div>
                <div class="sf-form-row">
                    <div class="form-group">
                        <label>Hierarchy Level</label>
                        <div class="sf-level-selector">
                            <button class="sf-level-btn" data-level="1" title="Major Section">1</button>
                            <button class="sf-level-btn" data-level="2" title="Sub-section">2</button>
                            <button class="sf-level-btn" data-level="3" title="Topic">3</button>
                            <button class="sf-level-btn" data-level="4" title="Statement">4</button>
                            <button class="sf-level-btn" data-level="5" title="Sub-statement">5</button>
                            <button class="sf-level-btn" data-level="6" title="Detail">6</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Directive Type</label>
                        <select id="sf-edit-directive" class="form-select">
                            <option value="">Process (no directive)</option>
                            <option value="shall">Shall (mandatory)</option>
                            <option value="must">Must (mandatory)</option>
                            <option value="should">Should (recommended)</option>
                            <option value="may">May (optional)</option>
                            <option value="will">Will (intent)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="sf-edit-panel-footer">
                <button class="btn btn-ghost" id="sf-btn-cancel-edit">Cancel</button>
                <button class="btn btn-primary" id="sf-btn-save-edit"><i data-lucide="check"></i>Save Changes</button>
            </div>
        </aside>
    </div>
</div>

<!-- Statement Forge: Add Statement Modal -->
<div class="modal modal-sm" id="modal-sf-add" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="plus"></i> Add New Statement</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Statement Number</label>
                <input type="text" id="sf-add-number" class="form-input" placeholder="e.g., 4.1.1">
            </div>
            <div class="form-group">
                <label>Description *</label>
                <textarea id="sf-add-description" class="form-textarea" rows="4" placeholder="Enter the statement text..."></textarea>
            </div>
            <div class="sf-form-row">
                <div class="form-group">
                    <label>Level</label>
                    <select id="sf-add-level" class="form-select">
                        <option value="1">1 - Major Section</option>
                        <option value="2">2 - Sub-section</option>
                        <option value="3">3 - Topic</option>
                        <option value="4" selected>4 - Statement</option>
                        <option value="5">5 - Sub-statement</option>
                        <option value="6">6 - Detail</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Directive</label>
                    <select id="sf-add-directive" class="form-select">
                        <option value="">Process</option>
                        <option value="shall">Shall</option>
                        <option value="must">Must</option>
                        <option value="should">Should</option>
                        <option value="may">May</option>
                        <option value="will">Will</option>
                    </select>
                </div>
            </div>
            <p class="text-muted" style="font-size:12px;margin-top:8px;">New statement will be added after the selected row, or at the end if none selected.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="sf-btn-add-confirm"><i data-lucide="plus"></i>Add Statement</button>
        </div>
    </div>
</div>

<!-- Statement Forge: Renumber Modal -->
<div class="modal modal-sm" id="modal-sf-renumber" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="hash"></i> Renumber Statements</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Base Number</label>
                <input type="text" id="sf-renumber-base" class="form-input" placeholder="e.g., 1 or 4.1" value="1">
            </div>
            <div class="form-group">
                <label>Numbering Strategy</label>
                <select id="sf-renumber-strategy" class="form-select">
                    <option value="hierarchical">Hierarchical (respects indent levels)</option>
                    <option value="sequential">Sequential (1.1, 1.2, 1.3...)</option>
                    <option value="continue">Continue (for merged documents)</option>
                </select>
                <p class="text-muted" style="font-size:12px;margin-top:4px;" id="sf-strategy-hint">Maintains hierarchy: 1.0 â†’ 1.1 â†’ 1.1.1</p>
            </div>
            <p class="text-muted" style="font-size:12px;">Will renumber <strong id="sf-renumber-count">0</strong> statements. Selected statements will be renumbered, or all visible if none selected.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="sf-btn-renumber-confirm"><i data-lucide="hash"></i>Renumber</button>
        </div>
    </div>
</div>

<!-- Statement Forge: Merge Modal -->
<div class="modal modal-sm" id="modal-sf-merge" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="git-merge"></i> Merge Statements</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <p>Combine <strong id="sf-merge-count">0</strong> selected statements into one.</p>
            <div class="form-group">
                <label>Text Separator</label>
                <select id="sf-merge-separator" class="form-select">
                    <option value="\n\n">Double newline (paragraphs)</option>
                    <option value="\n">Single newline</option>
                    <option value=" ">Space</option>
                    <option value="; ">Semicolon</option>
                </select>
            </div>
            <p class="text-muted" style="font-size:12px;margin-top:8px;">The first selected statement's number, title, and role will be preserved.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="sf-btn-merge-confirm"><i data-lucide="git-merge"></i>Merge Statements</button>
        </div>
    </div>
</div>

<!-- Statement Forge: Split Modal -->
<div class="modal modal-sm" id="modal-sf-split" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="split"></i> Split Statement</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Split By</label>
                <select id="sf-split-by" class="form-select">
                    <option value="\n\n">Double newline (paragraphs)</option>
                    <option value="\n">Single newline</option>
                    <option value=". ">Sentences (period + space)</option>
                    <option value="; ">Semicolon</option>
                </select>
            </div>
            <div id="sf-split-preview" class="sf-split-preview">
                <p class="text-muted">Select a statement to see preview</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="sf-btn-split-confirm"><i data-lucide="split"></i>Split Statement</button>
        </div>
    </div>
</div>

<!-- Statement Forge: Help Modal -->
<div class="modal modal-lg" id="modal-sf-help" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="help-circle"></i> Statement Forge - Help</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body sf-help-content" style="max-height: 75vh; overflow-y: auto;">
            <div class="sf-help-tabs">
                <button class="sf-help-tab-btn active" data-help-tab="overview">Overview</button>
                <button class="sf-help-tab-btn" data-help-tab="howto">How To Use</button>
                <button class="sf-help-tab-btn" data-help-tab="history">Statement History</button>
                <button class="sf-help-tab-btn" data-help-tab="export">Export</button>
                <button class="sf-help-tab-btn" data-help-tab="shortcuts">Shortcuts</button>
                <button class="sf-help-tab-btn" data-help-tab="technical">Technical</button>
            </div>

            <!-- OVERVIEW TAB -->
            <div class="sf-help-tab-content active" id="sf-help-overview">
                <h4>What Is Statement Forge?</h4>
                <p>Statement Forge is AEGIS's statement extraction engine. It automatically identifies and extracts <strong>actionable statements</strong> from your documents: requirements (<em>shall</em>, <em>must</em>), procedures (<em>perform</em>, <em>verify</em>), action items, and specifications. Instead of manually reading through hundreds of pages and copying text, Statement Forge does the heavy lifting in seconds.</p>

                <h4>Who Is It For?</h4>
                <ul>
                    <li><strong>Technical Writers</strong> â€” Extract requirements from contracts and SOWs for compliance matrices</li>
                    <li><strong>Process Engineers</strong> â€” Digitize paper procedures into structured, numbered steps for TIBCO Nimbus</li>
                    <li><strong>Quality Engineers</strong> â€” Pull mandatory requirements from standards (AS9100, ISO, MIL-STD) for audit checklists</li>
                    <li><strong>Program Managers</strong> â€” Identify action items and deliverables buried in meeting minutes and contracts</li>
                </ul>

                <h4>Key Capabilities</h4>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:12px 0;">
                    <div style="padding:12px;border-radius:8px;background:var(--bg-secondary);">
                        <strong style="color:var(--accent-blue);">Smart Extraction</strong>
                        <p style="margin:4px 0 0;font-size:13px;">Recognizes 1,000+ action verbs across requirements, procedures, approvals, and communications domains</p>
                    </div>
                    <div style="padding:12px;border-radius:8px;background:var(--bg-secondary);">
                        <strong style="color:var(--accent-blue);">Role Detection</strong>
                        <p style="margin:4px 0 0;font-size:13px;">Automatically identifies responsible actors: "The System Administrator shall..." = Actor: System Administrator</p>
                    </div>
                    <div style="padding:12px;border-radius:8px;background:var(--bg-secondary);">
                        <strong style="color:var(--accent-blue);">Directive Classification</strong>
                        <p style="margin:4px 0 0;font-size:13px;">Categorizes by obligation: Shall (mandatory), Must (required), Will (commitment), Should (recommended), May (optional)</p>
                    </div>
                    <div style="padding:12px;border-radius:8px;background:var(--bg-secondary);">
                        <strong style="color:var(--accent-blue);">Persistent History</strong>
                        <p style="margin:4px 0 0;font-size:13px;">Every scan auto-extracts and stores statements. View trends, compare scans, and track changes over time.</p>
                    </div>
                </div>

                <h4>Supported File Types</h4>
                <p><strong>PDF</strong> (text-based and OCR), <strong>Word (.docx)</strong>, <strong>Text (.txt)</strong>, and <strong>Markdown (.md)</strong>. Statements are extracted from the full document text after AEGIS parses the file.</p>

                <h4>Automatic Extraction</h4>
                <p style="padding:10px;border-left:3px solid var(--accent-blue);background:var(--bg-secondary);border-radius:0 6px 6px 0;">
                    Statement Forge runs automatically with every document scan. Extracted statements are persisted to the database and appear in the <strong>Stmts</strong> column of the Scan History table. Click any count to open the Statement History viewer.
                </p>
            </div>

            <!-- HOW TO USE TAB -->
            <div class="sf-help-tab-content" id="sf-help-howto">
                <h4>Quick Start Workflow</h4>
                <ol>
                    <li><strong>Load Your Document</strong> â€” Click <em>Open</em> to select a file, or use the document currently loaded from a scan</li>
                    <li><strong>Choose Document Type</strong> â€” Select <em>Procedures</em> (for SOPs, work instructions) or <em>Work Instruction</em> (step-by-step processes). This affects which extraction patterns are prioritized.</li>
                    <li><strong>Click Extract</strong> â€” The engine analyzes the full text and populates the statement table</li>
                    <li><strong>Filter by Directive</strong> â€” Use the sidebar filter chips to focus on specific directive types (Shall, Must, Should, etc.)</li>
                    <li><strong>Review and Edit</strong> â€” Double-click any row to edit its fields inline. Use merge to combine duplicates, split for compound statements.</li>
                    <li><strong>Reorder and Renumber</strong> â€” Drag statements to reorder, then use the Renumber tool for clean sequential numbering</li>
                    <li><strong>Export</strong> â€” Download as TIBCO Nimbus CSV, Excel workbook, JSON, or Word document</li>
                </ol>

                <h4>Editing Statements</h4>
                <table style="width:100%;border-collapse:collapse;font-size:13px;">
                    <tr style="border-bottom:1px solid var(--border-color);">
                        <td style="padding:6px;"><strong>Edit</strong></td>
                        <td style="padding:6px;">Double-click any row or press <kbd>Enter</kbd> to edit statement fields inline</td>
                    </tr>
                    <tr style="border-bottom:1px solid var(--border-color);">
                        <td style="padding:6px;"><strong>Delete</strong></td>
                        <td style="padding:6px;">Select rows and press <kbd>Delete</kbd> to remove false positives</td>
                    </tr>
                    <tr style="border-bottom:1px solid var(--border-color);">
                        <td style="padding:6px;"><strong>Reorder</strong></td>
                        <td style="padding:6px;">Drag the handle or use <kbd>Alt+Up/Down</kbd></td>
                    </tr>
                    <tr style="border-bottom:1px solid var(--border-color);">
                        <td style="padding:6px;"><strong>Change Level</strong></td>
                        <td style="padding:6px;">Use <kbd>Alt+Left/Right</kbd> to indent/outdent statement hierarchy</td>
                    </tr>
                    <tr style="border-bottom:1px solid var(--border-color);">
                        <td style="padding:6px;"><strong>Merge</strong></td>
                        <td style="padding:6px;">Select 2+ related rows and click Merge to combine them</td>
                    </tr>
                    <tr>
                        <td style="padding:6px;"><strong>Split</strong></td>
                        <td style="padding:6px;">Select a compound statement (containing "and") and click Split to separate</td>
                    </tr>
                </table>

                <h4>Document Type Selection</h4>
                <p><strong>Procedures</strong> mode prioritizes hierarchical structure detection (section headers, numbered steps, sub-steps) and looks for procedural verbs like "perform," "verify," "inspect." <strong>Work Instruction</strong> mode focuses on sequential action steps with role assignments and process flow.</p>

                <h4>Role Mapping</h4>
                <p>Click the <i data-lucide="users" style="width:14px;height:14px;vertical-align:middle;"></i> button in the sidebar footer to map extracted statements to detected roles. This cross-references Statement Forge actors with Roles Studio's role dictionary, showing which roles have the most assigned actions.</p>
            </div>

            <!-- STATEMENT HISTORY TAB -->
            <div class="sf-help-tab-content" id="sf-help-history">
                <h4>Statement History</h4>
                <p>Every document scan automatically extracts statements and stores them in the database. The Statement History viewer lets you explore this data across scans.</p>

                <h4>Opening Statement History</h4>
                <ul>
                    <li><strong>From Scan History</strong> â€” Click the blue statement count in the <em>Stmts</em> column, or click the <i data-lucide="file-text" style="width:14px;height:14px;vertical-align:middle;"></i> button in any scan row</li>
                    <li><strong>From Statement Forge</strong> â€” Click the <i data-lucide="history" style="width:14px;height:14px;vertical-align:middle;"></i> button in the sidebar footer</li>
                </ul>

                <h4>Overview Dashboard</h4>
                <p>The overview shows hero statistics (total scans, latest statement count, unique roles, top directive), a trend chart showing statement counts over time, a directive breakdown donut chart, and a scrollable timeline of all scans for this document.</p>

                <h4>Document Viewer</h4>
                <p>Click <strong>View</strong> on any scan in the timeline to open the split-panel document viewer. The left panel shows the original document text with extracted statements highlighted in directive-specific colors. The right panel shows a filterable list of all statements with their details. Click any statement in the list to scroll to its location in the document.</p>

                <h4>Directive Color Coding</h4>
                <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0;">
                    <span style="padding:4px 10px;border-radius:4px;background:rgba(59,130,246,0.15);color:#3b82f6;font-size:12px;font-weight:600;">Shall</span>
                    <span style="padding:4px 10px;border-radius:4px;background:rgba(239,68,68,0.15);color:#ef4444;font-size:12px;font-weight:600;">Must</span>
                    <span style="padding:4px 10px;border-radius:4px;background:rgba(245,158,11,0.15);color:#f59e0b;font-size:12px;font-weight:600;">Will</span>
                    <span style="padding:4px 10px;border-radius:4px;background:rgba(34,197,94,0.15);color:#22c55e;font-size:12px;font-weight:600;">Should</span>
                    <span style="padding:4px 10px;border-radius:4px;background:rgba(168,85,247,0.15);color:#a855f7;font-size:12px;font-weight:600;">May</span>
                </div>

                <h4>Side-by-Side Comparison</h4>
                <p>Click <strong>Compare</strong> between any two scans to see a diff view. Statements are matched using fingerprint-based comparison (first 100 characters + directive type). Added statements appear in green, removed in red, and unchanged in neutral. A summary bar shows the counts for each category.</p>

                <h4>Highlight-to-Create</h4>
                <p>In the Document Viewer, select any text in the document panel to see a creation popup. Statement Forge auto-detects the directive type from your selection and lets you assign a role. Click <strong>Create</strong> to add the new statement to the current scan's extraction set.</p>
            </div>

            <!-- EXPORT TAB -->
            <div class="sf-help-tab-content" id="sf-help-export">
                <h4>Export Formats</h4>

                <div style="display:grid;gap:12px;margin:12px 0;">
                    <div style="display:flex;align-items:start;gap:12px;padding:12px;border-radius:8px;background:var(--bg-secondary);">
                        <i data-lucide="file-spreadsheet" style="width:24px;height:24px;color:var(--accent-blue);flex-shrink:0;margin-top:2px;"></i>
                        <div>
                            <strong>TIBCO Nimbus CSV</strong>
                            <p style="margin:4px 0 0;font-size:13px;">12-column hierarchical format (Level 1-6 with descriptions). UTF-8 with BOM encoding. Role appears on the first line of the description cell, followed by a blank line, then the statement text. This is the production format â€” do not modify the column structure.</p>
                        </div>
                    </div>
                    <div style="display:flex;align-items:start;gap:12px;padding:12px;border-radius:8px;background:var(--bg-secondary);">
                        <i data-lucide="table" style="width:24px;height:24px;color:var(--success);flex-shrink:0;margin-top:2px;"></i>
                        <div>
                            <strong>Excel Workbook (.xlsx)</strong>
                            <p style="margin:4px 0 0;font-size:13px;">Two sheets: "Statements" with the same Level 1-6 structure plus formatting, and "Summary" with source document, export date, total counts, and directive breakdown.</p>
                        </div>
                    </div>
                    <div style="display:flex;align-items:start;gap:12px;padding:12px;border-radius:8px;background:var(--bg-secondary);">
                        <i data-lucide="code" style="width:24px;height:24px;color:var(--warning);flex-shrink:0;margin-top:2px;"></i>
                        <div>
                            <strong>JSON</strong>
                            <p style="margin:4px 0 0;font-size:13px;">Full metadata export: source document, extraction timestamp, statement count, section count, directive counts, and every statement with all fields (number, title, description, level, role, directive, section, is_header, notes).</p>
                        </div>
                    </div>
                    <div style="display:flex;align-items:start;gap:12px;padding:12px;border-radius:8px;background:var(--bg-secondary);">
                        <i data-lucide="file-text" style="width:24px;height:24px;color:var(--error);flex-shrink:0;margin-top:2px;"></i>
                        <div>
                            <strong>Word Document (.docx)</strong>
                            <p style="margin:4px 0 0;font-size:13px;">Formatted report with title page, source info, generation date, and hierarchical statement listing grouped by role. Headings for sections, bold numbering, italic titles, and directive type badges.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SHORTCUTS TAB -->
            <div class="sf-help-tab-content" id="sf-help-shortcuts">
                <h4>Keyboard Shortcuts</h4>
                <div class="sf-shortcuts-grid">
                    <div class="sf-shortcut"><kbd>Ctrl+O</kbd><span>Open Document</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+S</kbd><span>Export</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+Z</kbd><span>Undo</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+Y</kbd><span>Redo</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+A</kbd><span>Select All</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+F</kbd><span>Search</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+M</kbd><span>Merge Selected</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+E</kbd><span>Expand All</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+Shift+E</kbd><span>Collapse All</span></div>
                    <div class="sf-shortcut"><kbd>â†‘ / â†“</kbd><span>Navigate Rows</span></div>
                    <div class="sf-shortcut"><kbd>Space</kbd><span>Toggle Select</span></div>
                    <div class="sf-shortcut"><kbd>Enter</kbd><span>Edit Selected</span></div>
                    <div class="sf-shortcut"><kbd>Delete</kbd><span>Delete Selected</span></div>
                    <div class="sf-shortcut"><kbd>Insert</kbd><span>Add Statement</span></div>
                    <div class="sf-shortcut"><kbd>Alt+â†‘</kbd><span>Move Up</span></div>
                    <div class="sf-shortcut"><kbd>Alt+â†“</kbd><span>Move Down</span></div>
                    <div class="sf-shortcut"><kbd>Alt+â†</kbd><span>Outdent (decrease level)</span></div>
                    <div class="sf-shortcut"><kbd>Alt+â†’</kbd><span>Indent (increase level)</span></div>
                    <div class="sf-shortcut"><kbd>F1</kbd><span>Help</span></div>
                    <div class="sf-shortcut"><kbd>Escape</kbd><span>Close / Cancel</span></div>
                </div>
            </div>

            <!-- TECHNICAL TAB -->
            <div class="sf-help-tab-content" id="sf-help-technical">
                <h4>Architecture</h4>
                <p>Statement Forge consists of three Python modules in the <code>statement_forge/</code> package:</p>
                <ul>
                    <li><strong>extractor.py</strong> â€” Core extraction engine with 1,000+ verb patterns, hierarchical section parsing, role detection, and directive classification</li>
                    <li><strong>export.py</strong> â€” Export formatters for Nimbus CSV, Excel, JSON, and Word with validation</li>
                    <li><strong>routes.py</strong> â€” Flask blueprint with 20+ API endpoints for extraction, editing, history, and comparison</li>
                </ul>

                <h4>Statement Data Model</h4>
                <p>Each statement has these fields stored in the <code>scan_statements</code> table:</p>
                <table style="width:100%;border-collapse:collapse;font-size:12px;">
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;font-weight:600;">statement_number</td><td style="padding:4px;">Reference number (e.g., "3.1.2")</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;font-weight:600;">title</td><td style="padding:4px;">Section or requirement title</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;font-weight:600;">description</td><td style="padding:4px;">Full statement text</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;font-weight:600;">level</td><td style="padding:4px;">Hierarchy depth (1-6)</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;font-weight:600;">role</td><td style="padding:4px;">Responsible actor</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;font-weight:600;">directive</td><td style="padding:4px;">Obligation type (shall/must/will/should/may)</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;font-weight:600;">section</td><td style="padding:4px;">Parent section reference</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;font-weight:600;">is_header</td><td style="padding:4px;">Whether this is a section header (boolean)</td></tr>
                    <tr><td style="padding:4px;font-weight:600;">notes_json</td><td style="padding:4px;">Additional notes as JSON array</td></tr>
                </table>

                <h4>Extraction Pipeline</h4>
                <ol style="font-size:13px;">
                    <li>Document text is split into paragraphs</li>
                    <li>Each paragraph is scanned for directive keywords (shall, must, will, should, may) and process verbs</li>
                    <li>Section headers are detected via numbering patterns (1.0, 2.1.3, etc.) and formatting cues</li>
                    <li>Role/actor is identified from the sentence subject preceding the directive verb</li>
                    <li>Hierarchical levels are assigned based on section numbering depth</li>
                    <li>Statements are deduplicated using fingerprint comparison</li>
                </ol>

                <h4>Persistence</h4>
                <p>Statements are extracted <em>before</em> <code>record_scan()</code> so the summary enters <code>results_json</code>. Individual statements are then bulk-inserted into the <code>scan_statements</code> table, linked to both <code>scan_id</code> and <code>document_id</code>. Cascade delete ensures statements are cleaned up when scans are removed.</p>

                <h4>Comparison Algorithm</h4>
                <p>Cross-scan comparison uses fingerprint-based matching: each statement is fingerprinted as <code>(description[:100], directive)</code>. Statements present in scan B but not scan A are "added"; present in A but not B are "removed"; present in both are "unchanged." This approach handles minor text variations while detecting meaningful changes.</p>

                <h4>API Endpoints</h4>
                <table style="width:100%;border-collapse:collapse;font-size:12px;">
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;"><code>GET /history/&lt;doc_id&gt;</code></td><td style="padding:4px;">Per-scan summaries with directive counts</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;"><code>GET /scan/&lt;scan_id&gt;</code></td><td style="padding:4px;">All statements for a specific scan</td></tr>
                    <tr style="border-bottom:1px solid var(--border-color);"><td style="padding:4px;"><code>GET /trends/&lt;doc_id&gt;</code></td><td style="padding:4px;">Timeline data for charting</td></tr>
                    <tr><td style="padding:4px;"><code>GET /compare/&lt;id1&gt;/&lt;id2&gt;</code></td><td style="padding:4px;">Fingerprint diff between two scans</td></tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- v3.0.41: Role Mapping Results Container (separate modal) -->
<div class="modal modal-md" id="modal-sf-role-mapping" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="users"></i> Role Mapping</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div id="sf-role-mapping-container" class="sf-role-mapping-container">
                <!-- Populated dynamically by displayRoleMapping() -->
            </div>
        </div>
    </div>
</div>

<!-- v2.9.9: Score Breakdown Modal (#47 - Actionable Quality Score) -->
<div class="modal modal-md" id="modal-score-breakdown" role="dialog" aria-modal="true" aria-labelledby="modal-score-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-score-title"><i data-lucide="activity"></i> Document Health Score</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body" style="padding: var(--space-6);">
            <!-- Score Overview -->
            <div class="score-breakdown-header" style="text-align: center; margin-bottom: var(--space-6);">
                <div class="score-large" id="score-breakdown-value" style="font-size: 64px; font-weight: 700; line-height: 1;">--</div>
                <div class="score-grade-large" id="score-breakdown-grade" style="font-size: 24px; font-weight: 600; margin-top: var(--space-2);">Grade: --</div>
            </div>
            
            <!-- Score Components -->
            <div class="score-breakdown-components" style="display: flex; flex-direction: column; gap: var(--space-4);">
                <div class="score-component" data-component="severity">
                    <div class="component-header" style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                        <span class="component-label" style="font-weight: 500;"><i data-lucide="alert-triangle" style="width:16px;height:16px;"></i> Issue Impact</span>
                        <span class="component-value" id="score-comp-severity">--/50</span>
                    </div>
                    <div class="component-bar" style="height: 8px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden;">
                        <div class="component-fill" id="score-bar-severity" style="height: 100%; background: var(--warning); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <p class="component-desc" style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-1);">Based on issue severity (Critical issues have 4x impact)</p>
                </div>
                
                <div class="score-component" data-component="readability">
                    <div class="component-header" style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                        <span class="component-label" style="font-weight: 500;"><i data-lucide="book-open" style="width:16px;height:16px;"></i> Readability</span>
                        <span class="component-value" id="score-comp-readability">--/15</span>
                    </div>
                    <div class="component-bar" style="height: 8px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden;">
                        <div class="component-fill" id="score-bar-readability" style="height: 100%; background: var(--info); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <p class="component-desc" style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-1);">FK Grade 10-16 is ideal for technical documents</p>
                </div>
                
                <div class="score-component" data-component="structure">
                    <div class="component-header" style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                        <span class="component-label" style="font-weight: 500;"><i data-lucide="layout" style="width:16px;height:16px;"></i> Structure</span>
                        <span class="component-value" id="score-comp-structure">--/20</span>
                    </div>
                    <div class="component-bar" style="height: 8px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden;">
                        <div class="component-fill" id="score-bar-structure" style="height: 100%; background: var(--success); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <p class="component-desc" style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-1);">TOC, headings, and section organization</p>
                </div>
                
                <div class="score-component" data-component="completeness">
                    <div class="component-header" style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                        <span class="component-label" style="font-weight: 500;"><i data-lucide="check-square" style="width:16px;height:16px;"></i> Completeness</span>
                        <span class="component-value" id="score-comp-completeness">--/15</span>
                    </div>
                    <div class="component-bar" style="height: 8px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden;">
                        <div class="component-fill" id="score-bar-completeness" style="height: 100%; background: var(--accent); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <p class="component-desc" style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-1);">Tables, figures, and content depth</p>
                </div>
            </div>
            
            <!-- Improvement Suggestions -->
            <div class="score-improvements" style="margin-top: var(--space-6); padding-top: var(--space-4); border-top: 1px solid var(--border-default);">
                <h4 style="font-size: var(--font-size-base); margin-bottom: var(--space-3);"><i data-lucide="lightbulb" style="width:16px;height:16px;"></i> Top Improvements</h4>
                <ul class="improvement-list" id="score-improvements-list" style="list-style: none; padding: 0; display: flex; flex-direction: column; gap: var(--space-2);">
                    <!-- Dynamically populated -->
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" id="btn-score-breakdown-close">Got it</button>
        </div>
    </div>
</div>

<!-- v3.0.45: Keyboard Shortcuts Quick Reference Modal -->
<div class="modal modal-md" id="modal-shortcuts" role="dialog" aria-modal="true" aria-labelledby="shortcuts-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="shortcuts-title"><i data-lucide="keyboard"></i> Keyboard Shortcuts</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body shortcuts-body">
            <div class="shortcuts-grid">
                <div class="shortcuts-section">
                    <h4>File Operations</h4>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>O</kbd><span>Open file</span></div>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>R</kbd><span>Run review</span></div>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>E</kbd><span>Export results</span></div>
                </div>
                <div class="shortcuts-section">
                    <h4>Navigation</h4>
                    <div class="shortcut-item"><kbd>J</kbd><span>Next issue</span></div>
                    <div class="shortcut-item"><kbd>K</kbd><span>Previous issue</span></div>
                    <div class="shortcut-item"><kbd>Enter</kbd><span>Expand/collapse issue</span></div>
                    <div class="shortcut-item"><kbd>Space</kbd><span>Toggle selection</span></div>
                </div>
                <div class="shortcuts-section">
                    <h4>Selection</h4>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>A</kbd><span>Select all issues</span></div>
                    <div class="shortcut-item"><kbd>Esc</kbd><span>Deselect / Close modal</span></div>
                </div>
                <div class="shortcuts-section">
                    <h4>Interface</h4>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>B</kbd><span>Toggle sidebar</span></div>
                    <div class="shortcut-item"><kbd>F1</kbd><span>Open help</span></div>
                    <div class="shortcut-item"><kbd>?</kbd><span>This shortcuts panel</span></div>
                </div>
            </div>
            <div class="shortcuts-footer">
                <p class="text-muted">Tip: Focus on the issues list for J/K navigation</p>
            </div>
        </div>
    </div>
</div>

<!-- v3.0.110: Document Comparison Modal -->
<div class="modal modal-fullscreen" id="modal-doc-compare" role="dialog" aria-modal="true" aria-labelledby="modal-dc-title">
    <div class="modal-content dc-modal-content">
        <!-- Header -->
        <header class="dc-header">
            <div class="dc-header-info">
                <h3 id="modal-dc-title">
                    <i data-lucide="git-compare"></i>
                    <span>Document Comparison</span>
                </h3>
                <div class="dc-doc-selector-wrap">
                    <select class="dc-doc-select" id="dc-doc-select" title="Switch document">
                        <option value="">Select a document...</option>
                    </select>
                </div>
            </div>
            <div class="dc-scan-selectors">
                <span>Compare:</span>
                <select class="dc-scan-select" id="dc-old-scan">
                    <option value="">Select older scan...</option>
                </select>
                <span class="dc-scan-arrow">&rarr;</span>
                <select class="dc-scan-select" id="dc-new-scan">
                    <option value="">Select newer scan...</option>
                </select>
                <button class="btn btn-primary btn-sm" id="dc-btn-compare">Compare</button>
            </div>
            <button class="btn btn-ghost btn-icon" id="dc-btn-close" title="Close (Esc)">
                <i data-lucide="x"></i>
            </button>
        </header>

        <!-- Navigation Bar -->
        <div class="dc-navigation">
            <div class="dc-nav-buttons">
                <button class="dc-nav-btn" id="dc-btn-first" title="First change (Home)" disabled>
                    <i data-lucide="chevrons-up"></i>
                </button>
                <button class="dc-nav-btn" id="dc-btn-prev" title="Previous change (K)" disabled>
                    <i data-lucide="chevron-up"></i>
                </button>
                <span class="dc-nav-counter">
                    <strong id="dc-change-current">0</strong> / <span id="dc-change-total">0</span>
                </span>
                <button class="dc-nav-btn" id="dc-btn-next" title="Next change (J)" disabled>
                    <i data-lucide="chevron-down"></i>
                </button>
                <button class="dc-nav-btn" id="dc-btn-last" title="Last change (End)" disabled>
                    <i data-lucide="chevrons-down"></i>
                </button>
            </div>

            <div class="dc-filter-dropdown">
                <select class="dc-scan-select" id="dc-filter">
                    <option value="all">All Changes</option>
                    <option value="additions">Additions Only</option>
                    <option value="deletions">Deletions Only</option>
                    <option value="modifications">Modifications Only</option>
                    <option value="moves">Moves Only</option>
                </select>
            </div>

            <div class="dc-stats-summary" id="dc-stats">
                <span class="dc-stat dc-stat-added" title="Added">+<span id="dc-stat-added">0</span></span>
                <span class="dc-stat dc-stat-deleted" title="Deleted">&minus;<span id="dc-stat-deleted">0</span></span>
                <span class="dc-stat dc-stat-modified" title="Modified">~<span id="dc-stat-modified">0</span></span>
                <span class="dc-stat dc-stat-moved" title="Moved">&harr;<span id="dc-stat-moved">0</span></span>
            </div>

            <!-- v4.6.1: View mode + Export -->
            <div class="dc-view-controls">
                <button class="dc-view-btn active" id="dc-btn-side-by-side" title="Side-by-side view">
                    <i data-lucide="columns-2"></i>
                </button>
                <button class="dc-view-btn" id="dc-btn-unified" title="Unified/Redline view">
                    <i data-lucide="file-diff"></i>
                </button>
                <button class="dc-view-btn" id="dc-btn-change-index" title="Change index sidebar (C)">
                    <i data-lucide="list-ordered"></i>
                </button>
                <button class="dc-export-btn btn btn-ghost btn-xs" id="dc-btn-export" title="Export comparison">
                    <i data-lucide="download"></i> Export
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="dc-body">
            <!-- Minimap -->
            <div class="dc-minimap" id="dc-minimap"></div>

            <!-- v4.6.1: Change Index Sidebar -->
            <div class="dc-change-index collapsed" id="dc-change-index">
                <div class="dc-ci-header">
                    <h4>Changes</h4>
                    <span class="dc-ci-count" id="dc-ci-count">0</span>
                </div>
                <div class="dc-ci-list" id="dc-ci-list"></div>
            </div>

            <!-- Diff Panels -->
            <div class="dc-diff-panels">
                <!-- v4.6.1: Unified view (hidden by default) -->
                <div class="dc-unified-panel" id="dc-unified-panel" style="display:none">
                    <div class="dc-panel-header">
                        <i data-lucide="file-diff"></i>
                        <span>Unified View (Redline)</span>
                    </div>
                    <div class="dc-panel-content dc-unified-content" id="dc-content-unified"></div>
                </div>
                <div class="dc-panel dc-panel-old">
                    <div class="dc-panel-header">
                        <i data-lucide="clock"></i>
                        <span id="dc-old-label">Original</span>
                    </div>
                    <div class="dc-panel-content" id="dc-content-old"></div>
                </div>

                <div class="dc-panel dc-panel-new">
                    <div class="dc-panel-header">
                        <i data-lucide="clock"></i>
                        <span id="dc-new-label">Current</span>
                    </div>
                    <div class="dc-panel-content" id="dc-content-new"></div>
                </div>
            </div>

            <!-- Issues Panel -->
            <aside class="dc-issues-panel" id="dc-issues-panel">
                <div class="dc-issues-header">
                    <h4>Issues</h4>
                    <button class="btn btn-ghost btn-xs" id="dc-btn-toggle-issues" title="Toggle panel (I)">
                        <i data-lucide="panel-right-close"></i>
                    </button>
                </div>
                <div class="dc-issues-content">
                    <!-- v4.0.2: Enhanced score comparison with clearer labeling -->
                    <div class="dc-score-comparison">
                        <div class="dc-score dc-score-old">
                            <div class="dc-score-value" id="dc-score-old">--</div>
                            <div class="dc-score-label">BEFORE</div>
                        </div>
                        <div class="dc-score-change-container">
                            <div class="dc-score-change" id="dc-score-change">--</div>
                            <div class="dc-score-change-label" id="dc-score-change-label">Change</div>
                        </div>
                        <div class="dc-score dc-score-new">
                            <div class="dc-score-value" id="dc-score-new">--</div>
                            <div class="dc-score-label">AFTER</div>
                        </div>
                    </div>
                    <div class="dc-score-title">Quality Score Comparison</div>

                    <div class="dc-issue-stat fixed">
                        <i data-lucide="check-circle"></i>
                        <span>Fixed:</span>
                        <strong id="dc-issues-fixed">0</strong>
                    </div>
                    <div class="dc-issue-stat new">
                        <i data-lucide="alert-circle"></i>
                        <span>New:</span>
                        <strong id="dc-issues-new">0</strong>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</div>

<!-- v4.6.1: SOW Generator Modal -->
<div class="modal modal-lg" id="modal-sow-generator" role="dialog" aria-modal="true" aria-labelledby="modal-sow-title">
    <div class="modal-content sow-modal-content">
        <header class="sow-modal-header">
            <div class="sow-header-info">
                <h3 id="modal-sow-title"><i data-lucide="scroll-text"></i> SOW Generator</h3>
                <span class="sow-subtitle">Generate a Statement of Work from your analyzed documents</span>
            </div>
            <button class="btn btn-ghost btn-xs" id="sow-btn-close" title="Close">
                <i data-lucide="x"></i>
            </button>
        </header>

        <div class="sow-modal-body">
            <!-- Left: Configuration -->
            <div class="sow-config-panel">
                <div class="sow-config-section">
                    <h4>Project Information</h4>
                    <div class="sow-field">
                        <label for="sow-title">SOW Title</label>
                        <input type="text" id="sow-title" placeholder="Statement of Work" value="Statement of Work">
                    </div>
                    <div class="sow-field-row">
                        <div class="sow-field">
                            <label for="sow-doc-number">Document No.</label>
                            <input type="text" id="sow-doc-number" placeholder="SOW-001">
                        </div>
                        <div class="sow-field">
                            <label for="sow-version">Version</label>
                            <input type="text" id="sow-version" placeholder="1.0" value="1.0">
                        </div>
                    </div>
                    <div class="sow-field-row">
                        <div class="sow-field">
                            <label for="sow-date">Effective Date</label>
                            <input type="date" id="sow-date">
                        </div>
                        <div class="sow-field">
                            <label for="sow-prepared-by">Prepared By</label>
                            <input type="text" id="sow-prepared-by" placeholder="Author name">
                        </div>
                    </div>
                    <div class="sow-field">
                        <label for="sow-organization">Organization</label>
                        <input type="text" id="sow-organization" placeholder="Organization name">
                    </div>
                </div>

                <div class="sow-config-section">
                    <h4>Sections to Include</h4>
                    <div class="sow-toggles">
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-intro" checked><span>Introduction</span></label>
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-scope" checked><span>Scope</span></label>
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-documents" checked><span>Applicable Documents</span></label>
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-requirements" checked><span>Requirements &amp; Deliverables</span></label>
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-wbs" checked><span>Work Breakdown Structure</span></label>
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-roles" checked><span>Roles &amp; Responsibilities</span></label>
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-acceptance" checked><span>Acceptance Criteria</span></label>
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-standards" checked><span>Standards &amp; Compliance</span></label>
                        <label class="sow-toggle"><input type="checkbox" id="sow-sec-assumptions" checked><span>Assumptions &amp; Constraints</span></label>
                    </div>
                </div>

                <div class="sow-config-section">
                    <h4>Custom Text <span class="sow-hint">(optional)</span></h4>
                    <div class="sow-field">
                        <label for="sow-intro-text">Introduction</label>
                        <textarea id="sow-intro-text" rows="2" placeholder="Custom introduction paragraph (leave blank for auto-generated)"></textarea>
                    </div>
                    <div class="sow-field">
                        <label for="sow-scope-text">Scope Description</label>
                        <textarea id="sow-scope-text" rows="2" placeholder="Custom scope description (leave blank for auto-generated)"></textarea>
                    </div>
                </div>

                <div class="sow-config-section">
                    <h4><i data-lucide="upload" style="width:14px;height:14px;vertical-align:middle"></i> Company Template <span class="sow-hint">(optional)</span></h4>
                    <p class="sow-template-desc">Upload a DOCX template with placeholders. AEGIS will populate it with your extracted data.</p>
                    <div class="sow-template-upload" id="sow-template-upload">
                        <input type="file" id="sow-template-file" accept=".docx" style="display:none">
                        <div class="sow-template-dropzone" id="sow-template-dropzone">
                            <i data-lucide="file-up" style="width:24px;height:24px;opacity:0.5"></i>
                            <span>Drop a .docx template here or <a href="#" id="sow-template-browse">browse</a></span>
                        </div>
                        <div class="sow-template-loaded" id="sow-template-loaded" style="display:none">
                            <i data-lucide="file-check" style="width:16px;height:16px;color:var(--success)"></i>
                            <span id="sow-template-name"></span>
                            <button class="btn btn-ghost btn-xs" id="sow-template-remove" title="Remove template"><i data-lucide="x"></i></button>
                        </div>
                    </div>
                    <details class="sow-template-help">
                        <summary>Supported placeholders</summary>
                        <div class="sow-placeholder-list">
                            <code>{{TITLE}}</code> <code>{{DOC_NUMBER}}</code> <code>{{VERSION}}</code> <code>{{DATE}}</code>
                            <code>{{PREPARED_BY}}</code> <code>{{ORGANIZATION}}</code> <code>{{REQUIREMENTS}}</code>
                            <code>{{ROLES}}</code> <code>{{SCOPE}}</code> <code>{{DOCUMENTS}}</code>
                        </div>
                    </details>
                </div>
            </div>

            <!-- Right: Data Summary -->
            <div class="sow-data-panel">
                <div class="sow-data-section">
                    <h4>Available Data</h4>
                    <div class="sow-data-stats" id="sow-data-stats">
                        <div class="sow-data-stat"><span class="sow-ds-num" id="sow-count-docs">0</span><span class="sow-ds-label">Documents</span></div>
                        <div class="sow-data-stat"><span class="sow-ds-num" id="sow-count-stmts">0</span><span class="sow-ds-label">Statements</span></div>
                        <div class="sow-data-stat"><span class="sow-ds-num" id="sow-count-roles">0</span><span class="sow-ds-label">Roles</span></div>
                        <div class="sow-data-stat"><span class="sow-ds-num" id="sow-count-cats">0</span><span class="sow-ds-label">Categories</span></div>
                    </div>
                </div>

                <div class="sow-data-section">
                    <h4>Source Documents</h4>
                    <div class="sow-doc-controls" id="sow-doc-controls" style="display:none;">
                        <button class="sow-doc-ctrl-btn" id="sow-select-all" title="Select all documents">All</button>
                        <button class="sow-doc-ctrl-btn" id="sow-select-none" title="Deselect all documents">None</button>
                        <span class="sow-doc-selected-count" id="sow-selected-count">0 selected</span>
                    </div>
                    <div class="sow-doc-list" id="sow-doc-list">
                        <p class="sow-placeholder">Loading documents...</p>
                    </div>
                </div>

                <div class="sow-data-section">
                    <h4>Statement Breakdown</h4>
                    <div class="sow-directive-chart" id="sow-directive-chart">
                        <div class="sow-dir-bar" data-directive="shall"><span class="sow-dir-label">SHALL</span><div class="sow-dir-fill"></div><span class="sow-dir-count">0</span></div>
                        <div class="sow-dir-bar" data-directive="must"><span class="sow-dir-label">MUST</span><div class="sow-dir-fill"></div><span class="sow-dir-count">0</span></div>
                        <div class="sow-dir-bar" data-directive="will"><span class="sow-dir-label">WILL</span><div class="sow-dir-fill"></div><span class="sow-dir-count">0</span></div>
                        <div class="sow-dir-bar" data-directive="should"><span class="sow-dir-label">SHOULD</span><div class="sow-dir-fill"></div><span class="sow-dir-count">0</span></div>
                        <div class="sow-dir-bar" data-directive="may"><span class="sow-dir-label">MAY</span><div class="sow-dir-fill"></div><span class="sow-dir-count">0</span></div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="sow-modal-footer">
            <button class="btn btn-ghost" id="sow-btn-cancel">Cancel</button>
            <button class="btn btn-primary" id="sow-btn-generate" disabled>
                <i data-lucide="file-output"></i> Generate SOW
            </button>
        </footer>
    </div>
</div>

<!-- Hyperlink Validator Modal (v1.0.0) -->
<div class="modal modal-fullscreen" id="modal-hyperlink-validator" role="dialog" aria-modal="true" aria-labelledby="modal-hv-title">
    <div class="modal-content hv-modal-content">

        <!-- Header -->
        <header class="hv-header">
            <div class="hv-header-info">
                <h3 id="modal-hv-title">
                    <i data-lucide="link-2"></i>
                    <span>Hyperlink Validator</span>
                </h3>
                <span class="hv-subtitle">Standalone URL validation tool</span>
            </div>

            <!-- v5.9.35: Simplified to 2 modes (removed Quick/Format) -->
            <div class="hv-mode-selector">
                <label>Depth:</label>
                <select id="hv-scan-depth">
                    <option value="standard" selected>Standard</option>
                    <option value="thorough">Thorough (DNS+SSL)</option>
                </select>
            </div>

            <!-- v4.6.1: Link History button (opens Link History modal) -->
            <button class="btn btn-ghost" id="hv-btn-link-history" title="View Link History">
                <i data-lucide="history"></i>
                <span>Link History</span>
            </button>

            <button class="btn btn-ghost btn-icon" id="hv-btn-close" title="Close (Esc)">
                <i data-lucide="x"></i>
            </button>
        </header>

        <!-- v5.9.1: Warning when Windows Auth package not installed -->
        <div id="hv-auth-warning" class="hv-auth-warning" style="display:none;">
            <i data-lucide="alert-triangle" style="width:14px;height:14px;flex-shrink:0;"></i>
            <span>Windows Auth unavailable â€” install <code>requests-negotiate-sspi</code> on the target machine for SSO credential pass-through</span>
        </div>

        <!-- Input Section -->
        <div class="hv-input-section">
            <div class="hv-input-tabs">
                <button class="hv-tab active" data-tab="upload">Upload File</button>
                <button class="hv-tab" data-tab="paste">Paste URLs</button>
            </div>

            <div class="hv-tab-content" id="hv-tab-upload">
                <div class="hv-dropzone" id="hv-dropzone">
                    <i data-lucide="upload-cloud"></i>
                    <p>Drop a file here (TXT, CSV, DOCX, or Excel)</p>
                    <input type="file" id="hv-file-input" accept=".txt,.csv,.json,.docx,.xlsx,.xls" hidden>
                    <button class="btn btn-secondary">Browse Files</button>
                    <span class="hv-dropzone-file-types">Supports: .txt, .csv, .docx, .xlsx, .xls</span>
                </div>
            </div>

            <div class="hv-tab-content" id="hv-tab-paste" style="display:none">
                <textarea id="hv-url-input" placeholder="Paste URLs here (one per line)..."></textarea>
                <div class="hv-input-actions">
                    <span class="hv-url-count">0 URLs detected</span>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-sm" id="hv-btn-clear">Clear</button>
                        <button class="btn btn-primary" id="hv-btn-validate">
                            <i data-lucide="play"></i> Validate
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Settings Panel (collapsible) -->
        <div class="hv-settings collapsed" id="hv-settings">
            <button class="hv-settings-toggle" id="hv-settings-toggle">
                <i data-lucide="settings"></i> Advanced Settings
                <i data-lucide="chevron-down"></i>
            </button>
            <div class="hv-settings-content">
                <div class="hv-settings-row">
                    <label>Timeout (seconds): <input type="number" id="hv-timeout" value="10" min="1" max="60"></label>
                    <label>Max Retries: <input type="number" id="hv-retries" value="3" min="0" max="10"></label>
                    <label><input type="checkbox" id="hv-windows-auth" checked> Use Windows SSO</label>
                    <label><input type="checkbox" id="hv-follow-redirects" checked> Follow Redirects</label>
                </div>

                <!-- Exclusions Section -->
                <div class="hv-exclusions-section">
                    <div class="hv-exclusions-header">
                        <strong>URL Exclusions</strong> <span class="hv-exclusion-count">(0)</span>
                        <button class="btn btn-secondary btn-xs" id="hv-btn-add-exclusion">+ Add Rule</button>
                    </div>
                    <p class="hv-exclusions-help">Excluded URLs will be treated as OK (green) in reports.</p>
                    <div class="hv-exclusions-list" id="hv-exclusions-list">
                        <!-- Exclusion rules will be dynamically added here -->
                    </div>
                </div>

                <!-- Add Exclusion Modal -->
                <div class="hv-exclusion-form" id="hv-exclusion-form" style="display:none;">
                    <input type="text" id="hv-exclusion-pattern" placeholder="Pattern (e.g., twitter.com, *.internal.*)">
                    <select id="hv-exclusion-type">
                        <option value="contains">Contains</option>
                        <option value="exact">Exact Match</option>
                        <option value="prefix">Starts With</option>
                        <option value="suffix">Ends With</option>
                        <option value="regex">Regex</option>
                    </select>
                    <input type="text" id="hv-exclusion-reason" placeholder="Reason (optional)">
                    <label><input type="checkbox" id="hv-exclusion-valid" checked> Treat as Valid (show green)</label>
                    <div class="hv-exclusion-form-actions">
                        <button class="btn btn-secondary btn-sm" id="hv-btn-cancel-exclusion">Cancel</button>
                        <button class="btn btn-primary btn-sm" id="hv-btn-save-exclusion">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Section - 3D Animated -->
        <div class="hv-progress" id="hv-progress" style="display:none">
            <!-- Glowing orb accents -->
            <div class="hv-progress-orb hv-progress-orb-1"></div>
            <div class="hv-progress-orb hv-progress-orb-2"></div>
            <div class="hv-progress-orb hv-progress-orb-3"></div>

            <!-- Progress bar with particles -->
            <div class="hv-progress-bar">
                <div class="hv-progress-fill" id="hv-progress-fill">
                    <div class="hv-progress-shine"></div>
                </div>
                <!-- Floating particles -->
                <div class="hv-progress-particles">
                    <div class="hv-progress-particle orb" style="left: 10%; animation-delay: 0s;"></div>
                    <div class="hv-progress-particle orb" style="left: 25%; animation-delay: 0.5s;"></div>
                    <div class="hv-progress-particle orb" style="left: 40%; animation-delay: 1s;"></div>
                    <div class="hv-progress-particle orb" style="left: 55%; animation-delay: 1.5s;"></div>
                    <div class="hv-progress-particle orb" style="left: 70%; animation-delay: 2s;"></div>
                    <div class="hv-progress-particle orb" style="left: 85%; animation-delay: 0.3s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 15%; animation-delay: 0.2s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 35%; animation-delay: 0.7s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 50%; animation-delay: 1.2s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 65%; animation-delay: 0.4s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 80%; animation-delay: 0.9s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 95%; animation-delay: 1.6s;"></div>
                </div>
                <!-- Horizontal streaks -->
                <div class="hv-progress-streak" style="top: 20%; animation-delay: 0s;"></div>
                <div class="hv-progress-streak" style="top: 50%; animation-delay: 1s;"></div>
                <div class="hv-progress-streak" style="top: 80%; animation-delay: 2s;"></div>
            </div>

            <div class="hv-progress-info">
                <span id="hv-progress-text">Validating...</span>
                <span id="hv-progress-stats">0 / 0 URLs</span>
                <span id="hv-progress-eta"></span>
            </div>
            <button class="btn btn-secondary btn-sm" id="hv-btn-cancel">Cancel</button>
        </div>

        <!-- Results Section -->
        <div class="hv-results" id="hv-results">
            <!-- Enhanced Visual Stats Cards -->
            <div class="hv-stats-grid" id="hv-stats-grid">
                <!-- Stat cards will be rendered by HyperlinkVisualization.createStatCards() -->
                <div class="hv-stat-card stat-working" data-filter="working" role="button" tabindex="0" title="Click to filter Working links">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="check-circle"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-working">0</div>
                    <div class="hv-stat-card-label">Working</div>
                </div>
                <div class="hv-stat-card stat-broken" data-filter="broken" role="button" tabindex="0" title="Click to filter Broken links">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="x-circle"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-broken">0</div>
                    <div class="hv-stat-card-label">Broken</div>
                </div>
                <div class="hv-stat-card stat-redirect" data-filter="redirect" role="button" tabindex="0" title="Click to filter Redirects">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="arrow-right-circle"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-redirect">0</div>
                    <div class="hv-stat-card-label">Redirects</div>
                </div>
                <div class="hv-stat-card stat-timeout" data-filter="timeout" role="button" tabindex="0" title="Click to filter Timeout links">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="clock"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-timeout">0</div>
                    <div class="hv-stat-card-label">Timeout</div>
                </div>
                <div class="hv-stat-card stat-blocked" data-filter="blocked" role="button" tabindex="0" title="Click to filter Blocked links">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="shield-off"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-blocked">0</div>
                    <div class="hv-stat-card-label">Blocked</div>
                </div>
                <div class="hv-stat-card stat-auth" data-filter="auth_required" role="button" tabindex="0" title="Click to filter Auth Required links">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="lock"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-auth">0</div>
                    <div class="hv-stat-card-label">Auth Required</div>
                </div>
                <div class="hv-stat-card stat-unknown" data-filter="issues" role="button" tabindex="0" title="Click to filter Other issues">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="help-circle"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-unknown">0</div>
                    <div class="hv-stat-card-label">Other</div>
                </div>
            </div>

            <!-- Visual Analytics Charts -->
            <div class="hv-chart-section" id="hv-chart-section" style="display: none;">
                <div class="hv-chart-card">
                    <div class="hv-chart-title">
                        <i data-lucide="pie-chart"></i>
                        Status Distribution
                    </div>
                    <div id="hv-donut-chart"></div>
                </div>
                <div class="hv-chart-card">
                    <div id="hv-response-histogram"></div>
                </div>
            </div>

            <!-- 3D Domain Health Carousel (v3.0.125) -->
            <div id="hv-domain-carousel-section" style="display: none; margin: 0 1rem 1rem;">
                <div id="hv-domain-carousel"></div>
            </div>

            <!-- Domain Health Heatmap (alternate view) -->
            <div class="hv-chart-card" id="hv-domain-heatmap-section" style="display: none; margin: 0 1rem 1rem;">
                <div id="hv-domain-heatmap"></div>
            </div>

            <!-- Headless Browser Rescan Button (for blocked/timeout/auth URLs) -->
            <div id="hv-rescan-section" style="display: none; padding: 0 1rem 1rem;">
                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px;">
                    <i data-lucide="globe" style="color: #8b5cf6; flex-shrink: 0;"></i>
                    <div style="flex: 1;">
                        <strong style="color: var(--text-primary);">Deep Validation Available</strong>
                        <p style="margin: 0.25rem 0 0; font-size: 0.875rem; color: var(--text-secondary);">
                            <span id="hv-blocked-count">0</span> URLs need deeper validation (blocked, timeout, or auth-wall). Use headless Chromium browser to re-check.
                        </p>
                    </div>
                    <button class="hv-rescan-btn" id="hv-btn-rescan">
                        <i data-lucide="scan-search"></i>
                        Deep Validate
                    </button>
                </div>
            </div>

            <!-- Extended Metrics (Thorough Mode) -->
            <div class="hv-extended-metrics" id="hv-extended-metrics" style="display:none;">
                <div class="hv-metric-group">
                    <strong>Thorough Scan Results:</strong>
                    <span><span id="hv-count-ssl-warnings">0</span> SSL Warnings</span>
                    <span><span id="hv-count-soft-404">0</span> Soft 404s</span>
                    <span><span id="hv-count-suspicious">0</span> Suspicious</span>
                </div>
                <div class="hv-metric-group">
                    <strong>Response Times:</strong>
                    <span>Avg: <span id="hv-avg-time">0</span>ms</span>
                    <span>Min: <span id="hv-min-time">0</span>ms</span>
                    <span>Max: <span id="hv-max-time">0</span>ms</span>
                </div>
            </div>

            <!-- Filter & Export -->
            <div class="hv-toolbar">
                <div class="hv-filter">
                    <select id="hv-filter-status">
                        <option value="all">All Statuses</option>
                        <option value="working">Working Only</option>
                        <option value="broken">Broken Only</option>
                        <option value="redirect">Redirects Only</option>
                        <option value="timeout">Timeout Only</option>
                        <option value="blocked">Blocked Only</option>
                        <option value="auth_required">Auth Required Only</option>
                        <option value="issues">All Issues</option>
                    </select>
                    <select id="hv-filter-domain">
                        <option value="all">All Domains</option>
                    </select>
                    <input type="text" id="hv-filter-search" placeholder="Search URLs...">
                </div>
                <div class="hv-export-btns">
                    <button class="btn btn-secondary btn-sm" id="hv-btn-export-csv">
                        <i data-lucide="file-text"></i> CSV
                    </button>
                    <button class="btn btn-secondary btn-sm" id="hv-btn-export-json">
                        <i data-lucide="braces"></i> JSON
                    </button>
                    <button class="btn btn-secondary btn-sm" id="hv-btn-export-html">
                        <i data-lucide="file-code"></i> HTML Report
                    </button>
                    <span class="hv-export-divider"></span>
                    <button class="btn btn-primary btn-sm" id="hv-btn-export-highlighted" title="Export original file with broken links highlighted" disabled>
                        <i data-lucide="highlighter"></i> Export Highlighted
                    </button>
                    <span class="hv-export-divider"></span>
                    <button class="btn btn-secondary btn-sm" id="hv-btn-show-history" title="Show validation history">
                        <i data-lucide="history"></i> History
                    </button>
                </div>
            </div>

            <!-- Results Table -->
            <div class="hv-table-wrapper">
                <table class="hv-table" id="hv-results-table">
                    <thead>
                        <tr>
                            <th class="hv-col-status" data-sort="status">Status</th>
                            <th class="hv-col-url" data-sort="url">URL</th>
                            <th class="hv-col-code" data-sort="status_code">Code</th>
                            <th class="hv-col-message">Message</th>
                            <th class="hv-col-time" data-sort="response_time_ms">Time</th>
                            <th class="hv-col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="hv-results-body"></tbody>
                </table>
            </div>
        </div>

        <!-- History Panel (sidebar) -->
        <aside class="hv-history-panel" id="hv-history-panel">
            <div class="hv-history-header">
                <h4>Validation History</h4>
                <button class="btn btn-ghost btn-xs" id="hv-btn-toggle-history">
                    <i data-lucide="panel-right-close"></i>
                </button>
            </div>
            <div class="hv-history-list" id="hv-history-list"></div>
        </aside>

    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Metrics & Analytics Command Center (v4.6.1)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal modal-fullscreen" id="modal-metrics-analytics" role="dialog" aria-modal="true" aria-labelledby="modal-ma-title">
    <div class="ma-modal-content">
        <!-- Header -->
        <header class="ma-header">
            <div class="ma-header-left">
                <h3 id="modal-ma-title"><i data-lucide="bar-chart-3"></i> Metrics &amp; Analytics</h3>
                <span class="ma-last-updated" id="ma-last-updated"></span>
            </div>
            <div class="ma-header-right">
                <button class="btn btn-ghost btn-sm" id="ma-btn-refresh" title="Refresh data">
                    <i data-lucide="refresh-cw"></i>
                </button>
                <button class="btn btn-ghost btn-icon" id="ma-btn-close" title="Close (Esc)">
                    <i data-lucide="x"></i>
                </button>
            </div>
        </header>

        <!-- Tab Bar -->
        <nav class="ma-tab-bar" role="tablist">
            <button class="ma-tab active" data-tab="overview" role="tab" aria-selected="true" aria-controls="ma-tab-overview" id="ma-tab-btn-overview">
                <i data-lucide="layout-dashboard" aria-hidden="true"></i> Overview
            </button>
            <button class="ma-tab" data-tab="quality" role="tab" aria-selected="false" aria-controls="ma-tab-quality" id="ma-tab-btn-quality">
                <i data-lucide="shield-check" aria-hidden="true"></i> Quality
            </button>
            <button class="ma-tab" data-tab="statements" role="tab" aria-selected="false" aria-controls="ma-tab-statements" id="ma-tab-btn-statements">
                <i data-lucide="list-checks" aria-hidden="true"></i> Statements
            </button>
            <button class="ma-tab" data-tab="roles" role="tab" aria-selected="false" aria-controls="ma-tab-roles" id="ma-tab-btn-roles">
                <i data-lucide="users" aria-hidden="true"></i> Roles
            </button>
            <button class="ma-tab" data-tab="documents" role="tab" aria-selected="false" aria-controls="ma-tab-documents" id="ma-tab-btn-documents">
                <i data-lucide="file-stack" aria-hidden="true"></i> Documents
            </button>
        </nav>

        <!-- Content Area -->
        <div class="ma-content" id="ma-content">

            <!-- Overview Tab -->
            <div class="ma-tab-content active" id="ma-tab-overview" role="tabpanel" aria-labelledby="ma-tab-btn-overview">
                <!-- Hero Stats -->
                <div class="ma-hero-stats" id="ma-overview-hero">
                    <div class="ma-stat-card" data-metric="documents">
                        <div class="ma-stat-top">
                            <span class="ma-stat-label">Documents</span>
                            <svg class="ma-sparkline" data-spark="documents" width="60" height="24"></svg>
                        </div>
                        <div class="ma-stat-value" data-countup="0">0</div>
                        <div class="ma-stat-sub">analyzed</div>
                    </div>
                    <div class="ma-stat-card" data-metric="statements">
                        <div class="ma-stat-top">
                            <span class="ma-stat-label">Statements</span>
                            <svg class="ma-sparkline" data-spark="statements" width="60" height="24"></svg>
                        </div>
                        <div class="ma-stat-value" data-countup="0">0</div>
                        <div class="ma-stat-sub">extracted</div>
                    </div>
                    <div class="ma-stat-card" data-metric="roles">
                        <div class="ma-stat-top">
                            <span class="ma-stat-label">Roles</span>
                            <svg class="ma-sparkline" data-spark="roles" width="60" height="24"></svg>
                        </div>
                        <div class="ma-stat-value" data-countup="0">0</div>
                        <div class="ma-stat-sub">in dictionary</div>
                    </div>
                    <div class="ma-stat-card" data-metric="avgscore">
                        <div class="ma-stat-top">
                            <span class="ma-stat-label">Avg Score</span>
                            <svg class="ma-sparkline" data-spark="avgscore" width="60" height="24"></svg>
                        </div>
                        <div class="ma-stat-value" data-countup="0">0</div>
                        <div class="ma-stat-sub">out of 100</div>
                    </div>
                </div>

                <!-- Primary Charts Row -->
                <div class="ma-chart-grid ma-grid-60-40">
                    <div class="ma-chart-box">
                        <div class="ma-chart-header">
                            <h4>Score Trend</h4>
                            <span class="ma-chart-subtitle">Last 50 scans</span>
                        </div>
                        <div class="ma-chart-body">
                            <canvas id="ma-chart-score-trend"></canvas>
                        </div>
                    </div>
                    <div class="ma-chart-box">
                        <div class="ma-chart-header">
                            <h4>Grade Distribution</h4>
                        </div>
                        <div class="ma-chart-body ma-chart-doughnut-wrap">
                            <canvas id="ma-chart-grade-dist"></canvas>
                            <div class="ma-doughnut-center" id="ma-grade-center-text"></div>
                        </div>
                    </div>
                </div>

                <!-- Activity Heatmap -->
                <div class="ma-chart-box ma-chart-full">
                    <div class="ma-chart-header">
                        <h4>Scan Activity</h4>
                        <span class="ma-chart-subtitle">Last 12 months</span>
                    </div>
                    <div class="ma-chart-body ma-heatmap-body" id="ma-heatmap-container"></div>
                </div>

                <!-- Quick Stats Grid -->
                <div class="ma-mini-stats" id="ma-overview-mini">
                    <div class="ma-mini-card">
                        <i data-lucide="text"></i>
                        <span class="ma-mini-value" id="ma-mini-words">0</span>
                        <span class="ma-mini-label">Total Words</span>
                    </div>
                    <div class="ma-mini-card">
                        <i data-lucide="file-text"></i>
                        <span class="ma-mini-value" id="ma-mini-avgwords">0</span>
                        <span class="ma-mini-label">Avg Words/Doc</span>
                    </div>
                    <div class="ma-mini-card">
                        <i data-lucide="alert-triangle"></i>
                        <span class="ma-mini-value" id="ma-mini-issues">0</span>
                        <span class="ma-mini-label">Issues Found</span>
                    </div>
                    <div class="ma-mini-card">
                        <i data-lucide="user-check"></i>
                        <span class="ma-mini-value" id="ma-mini-adjudicated">0</span>
                        <span class="ma-mini-label">Roles Adjudicated</span>
                    </div>
                    <div class="ma-mini-card">
                        <i data-lucide="package"></i>
                        <span class="ma-mini-value" id="ma-mini-deliverables">0</span>
                        <span class="ma-mini-label">Deliverables</span>
                    </div>
                    <div class="ma-mini-card">
                        <i data-lucide="scan"></i>
                        <span class="ma-mini-value" id="ma-mini-scans">0</span>
                        <span class="ma-mini-label">Total Scans</span>
                    </div>
                </div>
            </div>

            <!-- Quality Tab -->
            <div class="ma-tab-content" id="ma-tab-quality" role="tabpanel" aria-labelledby="ma-tab-btn-quality">
                <div class="ma-hero-stats" id="ma-quality-hero"></div>
                <div class="ma-chart-grid ma-grid-60-40">
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Score Distribution</h4></div>
                        <div class="ma-chart-body"><canvas id="ma-chart-score-dist"></canvas></div>
                    </div>
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Issue Categories</h4></div>
                        <div class="ma-chart-body"><canvas id="ma-chart-issue-cats"></canvas></div>
                    </div>
                </div>
                <div class="ma-chart-box ma-chart-full">
                    <div class="ma-chart-header"><h4>Top 10 Issues</h4></div>
                    <div class="ma-table-wrap" id="ma-quality-issues-table"></div>
                </div>
                <div class="ma-chart-box ma-chart-full">
                    <div class="ma-chart-header"><h4>Document Scores</h4><span class="ma-chart-subtitle">Click a row to drill down</span></div>
                    <div class="ma-table-wrap" id="ma-quality-docs-table"></div>
                </div>
                <!-- Drill-down panel (hidden by default) -->
                <div class="ma-drilldown" id="ma-quality-drilldown"></div>
            </div>

            <!-- Statements Tab -->
            <div class="ma-tab-content" id="ma-tab-statements" role="tabpanel" aria-labelledby="ma-tab-btn-statements">
                <div class="ma-hero-stats" id="ma-statements-hero"></div>
                <div class="ma-chart-grid ma-grid-50-50">
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Directive Breakdown</h4></div>
                        <div class="ma-chart-body ma-chart-doughnut-wrap">
                            <canvas id="ma-chart-directive-dist"></canvas>
                            <div class="ma-doughnut-center" id="ma-directive-center-text"></div>
                        </div>
                    </div>
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Statement Level Distribution</h4></div>
                        <div class="ma-chart-body"><canvas id="ma-chart-level-dist"></canvas></div>
                    </div>
                </div>
                <div class="ma-chart-grid ma-grid-60-40">
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Statements by Document</h4><span class="ma-chart-subtitle">Top 15</span></div>
                        <div class="ma-chart-body"><canvas id="ma-chart-stmts-by-doc"></canvas></div>
                    </div>
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Role Assignment</h4><span class="ma-chart-subtitle">Top 10 roles</span></div>
                        <div class="ma-chart-body"><canvas id="ma-chart-role-assign"></canvas></div>
                    </div>
                </div>
                <div class="ma-drilldown" id="ma-statements-drilldown"></div>
            </div>

            <!-- Roles Tab -->
            <div class="ma-tab-content" id="ma-tab-roles" role="tabpanel" aria-labelledby="ma-tab-btn-roles">
                <div class="ma-hero-stats" id="ma-roles-hero"></div>
                <div class="ma-chart-grid ma-grid-50-50">
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Adjudication Status</h4></div>
                        <div class="ma-chart-body ma-chart-doughnut-wrap">
                            <canvas id="ma-chart-adj-status"></canvas>
                            <div class="ma-doughnut-center" id="ma-adj-center-text"></div>
                        </div>
                    </div>
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Roles by Category</h4></div>
                        <div class="ma-chart-body"><canvas id="ma-chart-role-cats"></canvas></div>
                    </div>
                </div>
                <div class="ma-chart-box ma-chart-full">
                    <div class="ma-chart-header"><h4>Function Coverage</h4></div>
                    <div class="ma-chart-body ma-bubble-wrap" id="ma-func-bubble-container"></div>
                </div>
                <div class="ma-chart-box ma-chart-full">
                    <div class="ma-chart-header"><h4>Top Roles</h4><span class="ma-chart-subtitle">Click a row to see documents</span></div>
                    <div class="ma-table-wrap" id="ma-roles-top-table"></div>
                </div>
                <div class="ma-chart-box ma-chart-full">
                    <div class="ma-chart-header"><h4>Relationship Types</h4></div>
                    <div class="ma-chart-body" style="max-height:220px"><canvas id="ma-chart-rel-types"></canvas></div>
                </div>
                <div class="ma-drilldown" id="ma-roles-drilldown"></div>
            </div>

            <!-- Documents Tab -->
            <div class="ma-tab-content" id="ma-tab-documents" role="tabpanel" aria-labelledby="ma-tab-btn-documents">
                <div class="ma-hero-stats" id="ma-documents-hero"></div>
                <div class="ma-chart-grid ma-grid-3col">
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>Word Count Distribution</h4></div>
                        <div class="ma-chart-body"><canvas id="ma-chart-word-dist"></canvas></div>
                    </div>
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>By Category Type</h4></div>
                        <div class="ma-chart-body ma-chart-doughnut-wrap">
                            <canvas id="ma-chart-doc-cats"></canvas>
                        </div>
                    </div>
                    <div class="ma-chart-box">
                        <div class="ma-chart-header"><h4>By Function</h4></div>
                        <div class="ma-chart-body"><canvas id="ma-chart-doc-funcs"></canvas></div>
                    </div>
                </div>
                <div class="ma-chart-box ma-chart-full">
                    <div class="ma-chart-header">
                        <h4>Document Portfolio</h4>
                        <span class="ma-chart-subtitle">Click column headers to sort Â· Click rows to drill down</span>
                    </div>
                    <div class="ma-table-wrap" id="ma-docs-portfolio-table"></div>
                </div>
                <div class="ma-drilldown" id="ma-documents-drilldown"></div>
            </div>

            <!-- Loading Overlay -->
            <div class="ma-loading" id="ma-loading">
                <div class="ma-skeleton-row">
                    <div class="ma-skeleton ma-skeleton-card"></div>
                    <div class="ma-skeleton ma-skeleton-card"></div>
                    <div class="ma-skeleton ma-skeleton-card"></div>
                    <div class="ma-skeleton ma-skeleton-card"></div>
                </div>
                <div class="ma-skeleton-row">
                    <div class="ma-skeleton ma-skeleton-chart-lg"></div>
                    <div class="ma-skeleton ma-skeleton-chart-sm"></div>
                </div>
                <div class="ma-skeleton-row">
                    <div class="ma-skeleton ma-skeleton-table"></div>
                </div>
            </div>

            <!-- Empty State -->
            <div class="ma-empty" id="ma-empty">
                <i data-lucide="bar-chart-3"></i>
                <h4>No Data Available</h4>
                <p>Scan some documents to start seeing metrics and analytics.</p>
            </div>
        </div>
    </div>
</div>

<!-- TWR Module Files (v3.0.46) - Load before app.js for modular architecture -->
<script src="/static/js/ui/storage.js"></script>
<script src="/static/js/utils/dom.js"></script>
<script src="/static/js/ui/state.js"></script>
<script src="/static/js/api/client.js"></script>
<script src="/static/js/ui/modals.js"></script>
<script src="/static/js/ui/events.js"></script>
<script src="/static/js/ui/renderers.js"></script>
<script src="/static/js/adjudication-lookup.js"></script>
<script src="/static/js/statement-review-lookup.js"></script>
<script src="/static/js/features/roles.js"></script>
<script src="/static/js/features/triage.js"></script>
<script src="/static/js/features/families.js"></script>

<!-- Help system -->
<script src="/static/js/help-docs.js"></script>
<script src="/static/js/help-content.js"></script>

<!-- Main application -->
<script src="/static/js/app.js"></script>
<!-- Fix modules (v3.0.52 - v3.0.68) -->
<script src="/static/js/update-functions.js"></script>
<script src="/static/js/button-fixes.js"></script>
<script src="/static/js/run-state-fixes.js"></script>
<script src="/static/js/history-fixes.js"></script>
<script src="/static/js/roles-dictionary-fix.js"></script>
<script src="/static/js/roles-tabs-fix.js"></script>
<!-- roles-export-fix.js REMOVED: v5.9.1 â€” was hijacking dropdown toggle with capture-phase handler; roles-tabs-fix.js handles all exports -->
<script src="/static/js/function-tags.js"></script>

<!-- v5.4.0: Feature modules deferred for faster initial paint -->
<!-- Fix Assistant v2 Modules (v3.0.97) -->
<script src="/static/js/features/document-viewer.js" defer></script>
<script src="/static/js/features/minimap.js" defer></script>
<script src="/static/js/features/fix-assistant-state.js" defer></script>
<script src="/static/js/features/learner-client.js" defer></script>
<script src="/static/js/features/a11y-manager.js" defer></script>
<script src="/static/js/features/sound-effects.js" defer></script>
<script src="/static/js/features/preview-modes.js" defer></script>
<script src="/static/js/features/report-client.js" defer></script>

<!-- Diagnostic Console Capture (v3.0.114) -->
<script src="/static/js/features/console-capture.js" defer></script>

<!-- Document Comparison Module (v3.0.110) -->
<script src="/static/js/features/doc-compare-state.js" defer></script>
<script src="/static/js/features/doc-compare.js" defer></script>
<!-- SOW Generator Module (v4.6.1) -->
<script src="/static/js/features/sow-generator.js" defer></script>
<!-- Portfolio Module (v3.0.114) -->
<script src="/static/js/features/portfolio.js" defer></script>
<!-- Hyperlink Validator Module (v3.0.125) -->
<script src="/static/js/features/hyperlink-validator-state.js" defer></script>
<script src="/static/js/features/hv-cinematic-progress.js" defer></script>
<script src="/static/js/features/hyperlink-validator.js" defer></script>
<script src="/static/js/features/hyperlink-visualizations.js" defer></script>
<!-- Link History Module (v1.0.0) -->
<script src="/static/js/features/link-history.js" defer></script>
<!-- Graph Export Module (v1.0.0) - ENH-003 -->
<script src="/static/js/features/graph-export.js" defer></script>
<!-- Role Source Viewer Module (v3.2.2) -->
<script src="/static/js/features/role-source-viewer.js" defer></script>
<!-- Data Explorer Module (v4.8.4) -->
<script src="/static/js/features/data-explorer.js" defer></script>
<!-- Frontend Logger Module (v1.0.0) -->
<script src="/static/js/features/frontend-logger.js" defer></script>
<!-- Statement Review Mode (v1.0.0) -->
<script src="/static/js/features/statement-review-mode.js" defer></script>
<!-- Cinematic Progress Animation (v1.0.0) -->
<script src="/static/js/features/cinematic-progress.js" defer></script>
<!-- Molten Progress Bar (v1.0.0) -->
<script src="/static/js/features/molten-progress.js" defer></script>
<!-- Style Guide Presets (v3.4.0) -->
<script src="/static/js/features/style-presets.js" defer></script>
<!-- Statement History Viewer (v1.0.0) -->
<script src="/static/js/features/statement-history.js" defer></script>
<!-- PDF.js Viewer (v4.4.0) -->
<script src="/static/js/features/pdf-viewer.js" defer></script>
<!-- Scan Progress Dashboard (v4.5.0) -->
<script src="/static/js/features/scan-progress-dashboard.js" defer></script>
<!-- Metrics & Analytics Command Center (v4.6.1) -->
<script src="/static/js/features/metrics-analytics.js" defer></script>
<!-- Mass Statement Review (v4.9.5) -->
<script src="/static/js/features/mass-statement-review.js" defer></script>
<!-- Statement Source Viewer (v1.0.0) -->
<script src="/static/js/features/statement-source-viewer.js" defer></script>
<!-- Demo Simulator (v1.0.0) - Mock data injection for Live Demo playback -->
<script src="/static/js/features/demo-simulator.js" defer></script>
<!-- Guide System (v1.0.0) - Must load BEFORE landing-page.js so AEGISGuide is available -->
<script src="/static/js/features/guide-system.js"></script>
<!-- Landing Page (v4.5.1) - Must load before DOMContentLoaded for landing animations -->
<script src="/static/js/features/landing-page.js"></script>
</body>
</html>
